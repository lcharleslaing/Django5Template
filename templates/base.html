<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Django Starter Template{% endblock %}</title>
    {% load tailwind_tags %}
    {% tailwind_css %}
    <style>
        /* Custom styles for search modal */
        .search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            backdrop-filter: blur(4px);
        }
        .search-modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 10vh;
        }
        .search-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .search-input-wrapper {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .search-results {
            overflow-y: auto;
            max-height: 60vh;
        }
        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background-color 0.15s;
        }
        .search-result-item:hover {
            background-color: #f9fafb;
        }
        .search-result-item.active {
            background-color: #eff6ff;
        }
        @media (prefers-color-scheme: dark) {
            [data-theme="dark"] .search-container {
                background: #1f2937;
            }
            [data-theme="dark"] .search-input-wrapper {
                border-bottom-color: #374151;
            }
            [data-theme="dark"] .search-result-item {
                border-bottom-color: #374151;
            }
            [data-theme="dark"] .search-result-item:hover {
                background-color: #374151;
            }
            [data-theme="dark"] .search-result-item.active {
                background-color: #1e3a8a;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-base-100">
    <!-- Header/Navbar -->
    <header>
        <nav class="navbar bg-base-200 shadow">
            <div class="container mx-auto flex justify-between items-center w-full">
                <a href="/" class="btn btn-ghost normal-case text-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
</svg>

                </a>
                <div class="flex items-center gap-2">
                    {% if user.is_authenticated %}
                        <!-- Search Button -->
                        <button onclick="openSearch()" class="btn btn-ghost btn-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <kbd class="kbd kbd-xs ml-1">Ctrl+K</kbd>
                        </button>
                        <span class="hidden sm:inline">Welcome, <span class="font-semibold">{{ user.username }}</span></span>
                        <form method="post" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-error btn-sm">Logout</button>
                        </form>
                    {% else %}
                        <a href="{% url 'login' %}" class="btn btn-primary btn-sm">Login</a>
                        <a href="{% url 'register' %}" class="btn btn-secondary btn-sm">Register</a>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto p-4 w-full">
        {% if messages %}
            <div class="space-y-2 mb-4">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} shadow-lg">
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer footer-center p-4 bg-base-300 text-base-content">
        <div>
            <p>&copy; {{ year|default:2024 }} Django Starter Template. </p>
        </div>
    </footer>

    <!-- Search Modal -->
    <div id="searchModal" class="search-modal">
        <div class="search-container">
            <div class="search-input-wrapper">
                <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="flex-1 outline-none text-lg" 
                        placeholder="Search for anything..."
                        autocomplete="off"
                    >
                    <kbd class="kbd kbd-sm">ESC</kbd>
                </div>
            </div>
            <div id="searchResults" class="search-results">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <!-- Search JavaScript -->
    <script>
        // Global search functionality
        const searchModal = document.getElementById('searchModal');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        let selectedIndex = -1;
        let searchTimeout = null;

        // Open search modal with Ctrl+K or Cmd+K
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                openSearch();
            }
            if (e.key === 'Escape' && searchModal.classList.contains('active')) {
                closeSearch();
            }
        });

        // Click outside to close
        searchModal.addEventListener('click', (e) => {
            if (e.target === searchModal) {
                closeSearch();
            }
        });

        function openSearch() {
            searchModal.classList.add('active');
            searchInput.focus();
            searchInput.value = '';
            searchResults.innerHTML = '';
            selectedIndex = -1;
        }

        function closeSearch() {
            searchModal.classList.remove('active');
            searchInput.value = '';
            searchResults.innerHTML = '';
        }

        // Search input handling
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                searchResults.innerHTML = '';
                return;
            }
            
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        });

        // Keyboard navigation
        searchInput.addEventListener('keydown', (e) => {
            const items = searchResults.querySelectorAll('.search-result-item');
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                updateSelection(items);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedIndex = Math.max(selectedIndex - 1, 0);
                updateSelection(items);
            } else if (e.key === 'Enter' && selectedIndex >= 0 && items[selectedIndex]) {
                e.preventDefault();
                const url = items[selectedIndex].dataset.url;
                if (url) {
                    window.location.href = url;
                }
            }
        });

        function updateSelection(items) {
            items.forEach((item, index) => {
                if (index === selectedIndex) {
                    item.classList.add('active');
                    item.scrollIntoView({ block: 'nearest' });
                } else {
                    item.classList.remove('active');
                }
            });
        }

        async function performSearch(query) {
            try {
                const response = await fetch(`/search/quick/?q=${encodeURIComponent(query)}`, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                const data = await response.json();
                displayResults(data.results);
            } catch (error) {
                console.error('Search error:', error);
                searchResults.innerHTML = '<div class="p-4 text-center text-gray-500">Error performing search</div>';
            }
        }

        function displayResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="p-4 text-center text-gray-500">No results found</div>';
                return;
            }
            
            selectedIndex = -1;
            searchResults.innerHTML = results.map((result, index) => {
                const iconMap = {
                    'document': `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>`,
                    'photograph': `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>`,
                    'light-bulb': `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>`,
                    'user': `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>`
                };
                
                const icon = iconMap[result.icon] || iconMap['document'];
                
                return `
                    <div class="search-result-item" data-url="${result.url}">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                ${icon}
                            </svg>
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-gray-900 truncate">${result.title}</div>
                                <div class="text-sm text-gray-500 truncate">${result.subtitle}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add click handlers
            searchResults.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', () => {
                    window.location.href = item.dataset.url;
                });
            });
        }
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
