# Django Project Snapshot

## Project Structure
```
Django5Template/
  requirements.txt
  SETUP_MAC.md
  snap.py
  DASHBOARD_README.md
  manage.py
  core/
    asgi.py
    __init__.py
    settings.py
    urls.py
    wsgi.py
  images/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      images/
        image_list.html
        image_detail.html
        image_upload.html
        image_delete.html
  suno_prompt_builder/
    models.py
    __init__.py
    apps.py
    README.md
    suno_api_stub.py
    admin.py
    urls.py
    views.py
    management/
      __init__.py
      commands/
        __init__.py
        seed_prompts.py
    static/
      suno_prompt_builder/
        js/
          copy_prompt.js
    templates/
      suno_prompt_builder/
        prompt_builder.html
  subscriptions/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      subscriptions/
        subscription_list.html
        subscription_confirm_delete.html
        subscription_form.html
        subscription_detail.html
        subscription_dashboard.html
  search/
    models.py
    __init__.py
    apps.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      search/
        results.html
        partials/
          result_list.html
  theme/
    __init__.py
    apps.py
    static_src/
      tailwind.config.js
      postcss.config.js
      src/
        styles.css
        dashboard.css
    static/
      css/
        dist/
          styles.css
    templates/
      base.html
  prompts/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      prompts/
        prompt_list.html
        my_prompts.html
        tag_detail.html
        category_detail.html
        prompt_detail.html
        prompt_list_simple.html
        test.html
        collections.html
        collection_detail.html
  files/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      files/
        file_detail.html
        file_upload.html
        file_delete.html
        file_list.html
  surveys/
    models.py
    __init__.py
    apps.py
    README.md
    forms.py
    context.py
    admin.py
    urls.py
    views.py
    tests/
      test_surveys_smoke.py
      __init__.py
      test_wiring.py
    management/
      __init__.py
      commands/
        seed_balanced_honesty.py
        __init__.py
    templates/
      surveys/
        response_complete.html
        survey_detail.html
        action_note.html
        survey_response.html
        results_index.html
        my_invites.html
        survey_list.html
        admin/
          survey_invites.html
          survey_form.html
          survey_list.html
        partials/
          privacy_explainer.html
        reports/
          survey_reports.html
  templates/
    base.html
    registration/
      login.html
  userprofile/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    management/
      __init__.py
      commands/
        __init__.py
        create_user_profiles.py
    templates/
      userprofile/
        profile_edit.html
        profile_view.html
        profile_list.html
        password_change.html
  main/
    models.py
    __init__.py
    apps.py
    admin.py
    tests.py
    urls.py
    views.py
    management/
      __init__.py
      commands/
        populate_sample_data.py
        cleanup_test_data.py
        __init__.py
        create_dashboard_sample_data.py
        create_sample_data.py
        verify_search_links.py
    templates/
      main/
        home.html
        dashboard.html
```

## Project-Level Files
### manage.py
```python
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

```

### core/settings.py
```python
"""
Django settings for core project.

Generated by 'django-admin startproject' using Django 5.2.4.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-5b(t4uzirw5=or^lw1@o2o4f964+8#&4f!*^z(1!klewa_4s!x'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ["localhost", "127.0.0.1", "0.0.0.0", "192.168.3.147", "192.168.1.*", "192.168.0.*", "10.0.0.*"]


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.humanize',
    'tailwind',
    'theme',
    'main',
    'files',
    'images',
    'userprofile',
    'prompts',
    'suno_prompt_builder',
    'subscriptions',
    'search',  # Added
    'surveys',  # Added
]

# Temporarily disabled browser reload to debug process issues
# if DEBUG:
#     # Add django_browser_reload only in DEBUG mode
#     INSTALLED_APPS += ['django_browser_reload']

# NPM_BIN_PATH = r"C:\Program Files\nodejs\npm.cmd"  # Windows path
# For Mac/Linux, npm should be in PATH by default

# Added: Registers the theme app for Tailwind
TAILWIND_APP_NAME = 'theme'

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',  # Added for static file serving
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

# Temporarily disabled browser reload middleware to debug process issues
# if DEBUG:
#     # Add django_browser_reload middleware only in DEBUG mode
#     MIDDLEWARE += [
#         "django_browser_reload.middleware.BrowserReloadMiddleware",
#     ]

ROOT_URLCONF = 'core.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        # Added project-level templates directory for global templates (e.g., base.html)
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'surveys.context.surveys_context',
            ],
        },
    },
]

WSGI_APPLICATION = 'core.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Added: Serve Tailwind CSS and other static assets from theme/static during development
STATICFILES_DIRS = [
    BASE_DIR / 'theme' / 'static',
]

# Added: Directory where collectstatic will gather static files for production
STATIC_ROOT = BASE_DIR / 'staticfiles'

# Added: WhiteNoise storage for compressed static files
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'

# Media files (user uploaded files)
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# Added: Authentication redirects for login/logout flows
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/login/'
LOGIN_URL = '/login/'

# Email backend for development: prints emails to the console.
# Use an SMTP backend in production for real email delivery.
EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

# Feature flags
SURVEYS_ENABLED = True

```

### core/urls.py
```python
from django.contrib import admin
from django.urls import path, include
from django.contrib.auth import views as auth_views
from django.conf import settings
from main.views import register, home

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', home, name='home'),
    # File and Image management
    path('files/', include('files.urls')),
    path('images/', include('images.urls')),
    # User Profile management
    path('profile/', include('userprofile.urls')),
    # Prompt management
    path('prompts/', include('prompts.urls')),
    # Suno Prompt Builder
    path('suno-prompt-builder/', include('suno_prompt_builder.urls')),
    # Subscription management
    path('subscriptions/', include('subscriptions.urls')),
    # Search functionality
    path('search/', include('search.urls')),
    # Surveys functionality
    path('surveys/', include(('surveys.urls', 'surveys'), namespace='surveys')),
    # Registration page
    path('register/', register, name='register'),  # User registration
    # Login page using Django's built-in view
    path('login/', auth_views.LoginView.as_view(template_name='registration/login.html'), name='login'),  # User login
    # Logout page using Django's built-in view
    path('logout/', auth_views.LogoutView.as_view(template_name='registration/logged_out.html'), name='logout'),  # User logout
    # Password reset views
    path('password-reset/', auth_views.PasswordResetView.as_view(template_name='registration/password_reset_form.html'), name='password_reset'),  # Request password reset
    path('password-reset/done/', auth_views.PasswordResetDoneView.as_view(template_name='registration/password_reset_done.html'), name='password_reset_done'),  # Password reset email sent
    path('password-reset/confirm/<uidb64>/<token>/', auth_views.PasswordResetConfirmView.as_view(template_name='registration/password_reset_confirm.html'), name='password_reset_confirm'),  # Password reset link
    path('password-reset/complete/', auth_views.PasswordResetCompleteView.as_view(template_name='registration/password_reset_complete.html'), name='password_reset_complete'),  # Password reset complete
]

# Static and Media files
from django.conf.urls.static import static
from django.views.static import serve

# Serve static files from STATIC_ROOT (production-ready)
urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)

# Media files (for development)
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

```

### core/wsgi.py
```python
"""
WSGI config for core project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')

application = get_wsgi_application()

```

### core/asgi.py
```python
"""
ASGI config for core project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')

application = get_asgi_application()

```

### requirements.txt
```python
asgiref
Django
django-tailwind
python-dotenv
sqlparse
tzdata
Pillow
requests
whitenoise
qrcode[pil]
```

## App: surveys
### surveys/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.core.validators import MinValueValidator, MaxValueValidator
from django.utils import timezone
from django.urls import reverse
import json


class Survey(models.Model):
    STATUS_CHOICES = [
        ('DRAFT', 'Draft'),
        ('PUBLISHED', 'Published'),
        ('CLOSED', 'Closed'),
        ('ARCHIVED', 'Archived'),
    ]
    
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    publish_start = models.DateTimeField()
    publish_end = models.DateTimeField()
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='DRAFT')
    created_by = models.ForeignKey(User, on_delete=models.CASCADE, related_name='created_surveys')
    k_threshold = models.IntegerField(default=5, validators=[MinValueValidator(1)])
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        ordering = ['-created_at']
    
    def __str__(self):
        return self.title
    
    def get_absolute_url(self):
        return reverse('surveys:survey_detail', kwargs={'pk': self.pk})
    
    @property
    def is_active(self):
        now = timezone.now()
        return (self.status == 'PUBLISHED' and 
                self.publish_start <= now <= self.publish_end)
    
    @property
    def response_count(self):
        return self.responses.count()
    
    @property
    def sections_count(self):
        return self.sections.count()


class Section(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='sections')
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    order = models.IntegerField(default=0)
    
    class Meta:
        ordering = ['order']
        unique_together = ['survey', 'order']
    
    def __str__(self):
        return f"{self.survey.title} - {self.title}"
    
    def get_absolute_url(self):
        return reverse('surveys:section_detail', kwargs={'pk': self.pk})


class Question(models.Model):
    QUESTION_TYPES = [
        ('LIKERT', 'Likert Scale'),
        ('MULTI', 'Multiple Choice'),
        ('SINGLE', 'Single Choice'),
        ('MATRIX', 'Matrix Question'),
        ('SHORT_TEXT', 'Short Text'),
        ('LONG_TEXT', 'Long Text'),
        ('NPS', 'Net Promoter Score'),
        ('RANK', 'Ranking'),
        ('DATE', 'Date'),
        ('NUMBER', 'Number'),
    ]
    
    ANONYMITY_MODES = [
        ('ANONYMOUS', 'Anonymous'),
        ('ESCROW', 'Private (Escrow)'),
        ('SIGNED', 'Signed'),
    ]
    
    section = models.ForeignKey(Section, on_delete=models.CASCADE, related_name='questions')
    type = models.CharField(max_length=20, choices=QUESTION_TYPES)
    prompt = models.TextField()
    help_text = models.TextField(blank=True)
    required = models.BooleanField(default=True)
    options_json = models.JSONField(default=dict, blank=True)  # For choices, matrix options, etc.
    scale_min = models.IntegerField(default=1, validators=[MinValueValidator(0)])
    scale_max = models.IntegerField(default=5, validators=[MaxValueValidator(10)])
    order = models.IntegerField(default=0)
    logic_json = models.JSONField(default=dict, blank=True)  # For conditional logic
    anonymity_mode = models.CharField(max_length=20, choices=ANONYMITY_MODES, default='ESCROW')
    
    class Meta:
        ordering = ['order']
        unique_together = ['section', 'order']
    
    def __str__(self):
        return f"{self.section.title} - {self.prompt[:50]}..."
    
    def get_absolute_url(self):
        return reverse('surveys:question_detail', kwargs={'pk': self.pk})
    
    @property
    def options(self):
        """Get options as a list, handling both list and dict formats"""
        if isinstance(self.options_json, list):
            return self.options_json
        elif isinstance(self.options_json, dict):
            return self.options_json.get('choices', [])
        return []
    
    @property
    def is_scale_question(self):
        """Check if this is a scale-based question (Likert, NPS, Number)"""
        return self.type in ['LIKERT', 'NPS', 'NUMBER']

    @property
    def scale_values(self):
        """List of integer options for scale questions."""
        try:
            start = int(self.scale_min)
            end = int(self.scale_max)
            if end < start:
                start, end = end, start
            return list(range(start, end + 1))
        except Exception:
            return []


class Response(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='responses')
    identity_user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='survey_responses')
    submitted_at = models.DateTimeField(auto_now_add=True)
    cohort_json = models.JSONField(default=dict, blank=True)  # For demographic/cohort data
    meta_json = models.JSONField(default=dict, blank=True)  # For additional metadata
    
    class Meta:
        ordering = ['-submitted_at']
        unique_together = ['survey', 'identity_user']  # One response per user per survey
    
    def __str__(self):
        user_id = self.identity_user.username if self.identity_user else 'Anonymous'
        return f"{self.survey.title} - {user_id} - {self.submitted_at.strftime('%Y-%m-%d %H:%M')}"
    
    def get_absolute_url(self):
        return reverse('surveys:response_detail', kwargs={'pk': self.pk})
    
    @property
    def is_anonymous(self):
        """Check if this response is completely anonymous"""
        return self.identity_user is None
    
    @property
    def answers_count(self):
        return self.answers.count()


class Answer(models.Model):
    MODERATION_STATUS = [
        ('OK', 'OK'),
        ('FLAGGED', 'Flagged for Review'),
        ('REDACTED', 'Redacted'),
    ]
    
    response = models.ForeignKey(Response, on_delete=models.CASCADE, related_name='answers')
    question = models.ForeignKey(Question, on_delete=models.CASCADE, related_name='answers')
    value_text = models.TextField(blank=True)
    value_number = models.FloatField(null=True, blank=True)
    value_json = models.JSONField(default=dict, blank=True)  # For complex answers (matrix, ranking, etc.)
    is_signed = models.BooleanField(default=False)
    signed_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='signed_answers')
    followup_opt_in = models.BooleanField(default=False)
    preferred_contact = models.TextField(blank=True)
    moderation_status = models.CharField(max_length=20, choices=MODERATION_STATUS, default='OK')
    flags_json = models.JSONField(default=dict, blank=True)  # For moderation flags
    
    class Meta:
        unique_together = ['response', 'question']
    
    def __str__(self):
        return f"{self.question.prompt[:30]}... - {self.response}"
    
    def get_absolute_url(self):
        return reverse('surveys:answer_detail', kwargs={'pk': self.pk})
    
    @property
    def display_value(self):
        """Get the display value based on question type"""
        if self.question.type in ['SHORT_TEXT', 'LONG_TEXT']:
            return self.value_text
        elif self.question.type in ['LIKERT', 'NPS', 'NUMBER']:
            return self.value_number
        elif self.question.type in ['MULTI', 'SINGLE', 'RANK']:
            return self.options.get('selected', [])
        elif self.question.type == 'DATE':
            return self.value_json.get('date')
        elif self.question.type == 'MATRIX':
            return self.value_json.get('matrix_data', {})
        return "N/A"
    
    @property
    def is_anonymous_answer(self):
        """Check if this answer should be treated as anonymous in reports"""
        if self.question.anonymity_mode == 'ANONYMOUS':
            return True
        elif self.question.anonymity_mode == 'ESCROW':
            return not self.followup_opt_in
        return False


class Invite(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='invites')
    email = models.EmailField(null=True, blank=True)  # Optional for anonymous surveys
    token = models.CharField(max_length=100, unique=True)
    used_at = models.DateTimeField(null=True, blank=True)
    expires_at = models.DateTimeField()
    meta_json = models.JSONField(default=dict, blank=True)  # For additional invite metadata
    
    class Meta:
        ordering = ['-expires_at']
    
    def __str__(self):
        email = self.email or 'Anonymous'
        return f"{self.survey.title} - {email} - {self.token[:8]}..."
    
    def get_absolute_url(self):
        return reverse('surveys:invite_detail', kwargs={'pk': self.pk})
    
    @property
    def is_expired(self):
        return timezone.now() > self.expires_at
    
    @property
    def is_used(self):
        return self.used_at is not None
    
    @property
    def is_valid(self):
        return not self.is_expired and not self.is_used


class ReportSnapshot(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='report_snapshots')
    computed_at = models.DateTimeField(auto_now_add=True)
    aggregates_json = models.JSONField(default=dict)  # For storing computed aggregates
    
    class Meta:
        ordering = ['-computed_at']
    
    def __str__(self):
        return f"{self.survey.title} - {self.computed_at.strftime('%Y-%m-%d %H:%M')}"
    
    def get_absolute_url(self):
        return reverse('surveys:report_snapshot_detail', kwargs={'pk': self.pk})
    
    @property
    def response_rate(self):
        """Calculate response rate as percentage"""
        total_invites = self.survey.invites.count()
        if total_invites == 0:
            return 0
        return (self.survey.response_count / total_invites) * 100
    
    @property
    def enps_score(self):
        """Calculate eNPS score from NPS questions"""
        nps_answers = Answer.objects.filter(
            question__type='NPS',
            response__survey=self.survey
        ).values_list('value_number', flat=True)
        
        if not nps_answers:
            return 0
        
        promoters = sum(1 for score in nps_answers if score >= 9)
        detractors = sum(1 for score in nps_answers if score <= 6)
        total = len(nps_answers)
        
        if total == 0:
            return 0
        
        return ((promoters - detractors) / total) * 100

```

### surveys/views.py
```python
from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required, user_passes_test
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.contrib import messages
from django.http import JsonResponse, HttpResponse
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView
from django.urls import reverse_lazy, reverse
from django.db.models import Q, Count, Avg, Min, Max
from django.utils import timezone
from django.core.paginator import Paginator
from django.template.loader import render_to_string
from django.utils.decorators import method_decorator
from django.views.decorators.csrf import csrf_exempt
from django.views.decorators.http import require_http_methods
import json
import uuid
from datetime import timedelta

from .models import Survey, Section, Question, Response, Answer, Invite, ReportSnapshot
from .forms import (
    SurveyForm, SectionForm, QuestionForm, ResponseForm, AnswerForm,
    InviteForm, BulkInviteForm, SurveyReportForm
)


def is_survey_admin(user):
    """Check if user has admin permissions for surveys"""
    return user.is_staff or user.has_perm('surveys.change_survey')


def is_survey_creator(user):
    """Check if user can create surveys"""
    return user.is_staff or user.has_perm('surveys.add_survey')


def is_survey_analyst(user):
    """Check if user can view survey reports"""
    return user.is_staff or user.has_perm('surveys.view_response')


def index(request):
    return redirect('surveys:list')


def my_invites(request):
    invites = []
    if request.user.is_authenticated:
        now = timezone.now()
        invites = Invite.objects.filter(email__iexact=request.user.email, used_at__isnull=True, expires_at__gt=now)
    return render(request, 'surveys/my_invites.html', {
        'invites': invites,
        'page_title': 'My Survey Invites',
    })


def results_index(request):
    surveys = Survey.objects.filter(status='PUBLISHED')
    return render(request, 'surveys/results_index.html', {
        'surveys': surveys,
        'page_title': 'Survey Results',
    })


def export_report(request, pk, format):
    # Placeholder: return HTTP response; later implement CSV/XLSX/PDF
    return HttpResponse(f"Export for survey {pk} as {format}")


def action_note(request, pk):
    # Placeholder page for manager action notes
    survey = get_object_or_404(Survey, pk=pk)
    return render(request, 'surveys/action_note.html', {
        'survey': survey,
        'page_title': 'Post-Survey Action Note',
    })


# Public Views
def survey_list(request):
    """Public view of published surveys"""
    surveys = Survey.objects.filter(
        status='PUBLISHED',
        publish_start__lte=timezone.now(),
        publish_end__gte=timezone.now()
    ).order_by('-publish_start')
    
    context = {
        'surveys': surveys,
        'page_title': 'Available Surveys'
    }
    return render(request, 'surveys/survey_list.html', context)


def survey_detail(request, pk):
    """Public view of survey details"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if not survey.is_active:
        messages.error(request, 'This survey is not currently active.')
        return redirect('surveys:survey_list')
    
    context = {
        'survey': survey,
        'page_title': survey.title
    }
    return render(request, 'surveys/survey_detail.html', context)


def survey_response(request, survey_pk, token=None):
    """Handle survey response submission"""
    survey = get_object_or_404(Survey, pk=survey_pk)
    
    if not survey.is_active:
        messages.error(request, 'This survey is not currently active.')
        return redirect('surveys:survey_list')
    
    # Check if user already responded
    if request.user.is_authenticated:
        existing_response = Response.objects.filter(
            survey=survey,
            identity_user=request.user
        ).first()
        if existing_response:
            messages.info(request, 'You have already completed this survey.')
            return redirect('surveys:response_detail', pk=existing_response.pk)
    
    # Handle token-based access
    invite = None
    if token:
        invite = get_object_or_404(Invite, token=token, survey=survey)
        if not invite.is_valid:
            messages.error(request, 'This invite link has expired or been used.')
            return redirect('surveys:survey_list')
    
    if request.method == 'POST':
        # Process survey response
        try:
            # Create or get response
            if request.user.is_authenticated:
                response, created = Response.objects.get_or_create(
                    survey=survey,
                    identity_user=request.user
                )
            else:
                # For anonymous responses, create without user
                response = Response.objects.create(survey=survey)
            
            # Process answers
            for section in survey.sections.all():
                for question in section.questions.all():
                    field_name = f'question_{question.pk}'
                    if field_name in request.POST:
                        value = request.POST[field_name]
                        
                        # Create answer based on question type
                        answer = Answer.objects.create(
                            response=response,
                            question=question
                        )
                        
                        if question.type in ['SHORT_TEXT', 'LONG_TEXT']:
                            answer.value_text = value
                            # Handle anonymity-specific fields
                            if question.anonymity_mode == 'ESCROW':
                                answer.followup_opt_in = request.POST.get(f'{field_name}_followup', False)
                                answer.preferred_contact = request.POST.get(f'{field_name}_contact', '')
                            if question.anonymity_mode in ['ESCROW', 'SIGNED']:
                                answer.is_signed = request.POST.get(f'{field_name}_signed', False)
                                if answer.is_signed and request.user.is_authenticated:
                                    answer.signed_by = request.user
                        
                        elif question.type in ['LIKERT', 'NPS', 'NUMBER']:
                            answer.value_number = float(value)
                        
                        elif question.type in ['MULTI', 'SINGLE', 'RANK']:
                            if question.type == 'MULTI':
                                # Handle multiple values
                                values = request.POST.getlist(field_name)
                                answer.value_json = {'selected': values}
                            else:
                                answer.value_json = {'selected': [value]}
                        
                        elif question.type == 'DATE':
                            answer.value_json = {'date': value}
                        
                        answer.save()
            
            # Mark invite as used if applicable
            if invite:
                invite.used_at = timezone.now()
                invite.save()
            
            messages.success(request, 'Thank you for completing the survey!')
            return redirect('surveys:response_complete', pk=response.pk)
            
        except Exception as e:
            messages.error(request, f'Error saving response: {str(e)}')
    
    # Get first question for initial display
    first_section = survey.sections.first()
    first_question = first_section.questions.first() if first_section else None
    
    context = {
        'survey': survey,
        'first_question': first_question,
        'invite': invite,
        'page_title': f'Complete: {survey.title}'
    }
    return render(request, 'surveys/survey_response.html', context)


def response_complete(request, pk):
    """Show completion message after survey response"""
    response = get_object_or_404(Response, pk=pk)
    
    context = {
        'response': response,
        'page_title': 'Survey Complete'
    }
    return render(request, 'surveys/response_complete.html', context)


# Admin Views
@login_required
@user_passes_test(is_survey_admin)
def survey_admin_list(request):
    """Admin view of all surveys"""
    surveys = Survey.objects.all().order_by('-created_at')
    
    context = {
        'surveys': surveys,
        'page_title': 'Survey Administration'
    }
    return render(request, 'surveys/admin/survey_list.html', context)


@login_required
@user_passes_test(is_survey_creator)
def survey_create(request):
    """Create new survey"""
    if request.method == 'POST':
        form = SurveyForm(request.POST)
        if form.is_valid():
            survey = form.save(commit=False)
            survey.created_by = request.user
            survey.save()
            messages.success(request, 'Survey created successfully!')
            return redirect('surveys:survey_edit', pk=survey.pk)
    else:
        form = SurveyForm()
    
    context = {
        'form': form,
        'page_title': 'Create New Survey'
    }
    return render(request, 'surveys/admin/survey_form.html', context)


@login_required
@user_passes_test(is_survey_creator)
def survey_edit(request, pk):
    """Edit existing survey"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        form = SurveyForm(request.POST, instance=survey)
        if form.is_valid():
            form.save()
            messages.success(request, 'Survey updated successfully!')
            return redirect('surveys:survey_admin_list')
    else:
        form = SurveyForm(instance=survey)
    
    context = {
        'form': form,
        'survey': survey,
        'page_title': f'Edit: {survey.title}'
    }
    return render(request, 'surveys/admin/survey_form.html', context)


@login_required
@user_passes_test(is_survey_admin)
def survey_publish(request, pk):
    """Publish or unpublish a survey"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        action = request.POST.get('action')
        if action == 'publish':
            survey.status = 'PUBLISHED'
            survey.save()
            messages.success(request, 'Survey published successfully!')
        elif action == 'unpublish':
            survey.status = 'DRAFT'
            survey.save()
            messages.success(request, 'Survey unpublished successfully!')
        elif action == 'close':
            survey.status = 'CLOSED'
            survey.save()
            messages.success(request, 'Survey closed successfully!')
    
    return redirect('surveys:survey_admin_list')


@login_required
@user_passes_test(is_survey_admin)
def survey_invites(request, pk):
    """Manage survey invites"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        form = BulkInviteForm(request.POST)
        if form.is_valid():
            # Process bulk invites
            invite_type = form.cleaned_data['invite_type']
            expires_in_days = form.cleaned_data['expires_in_days']
            expires_at = timezone.now() + timedelta(days=expires_in_days)
            
            if invite_type == 'all_users':
                users = User.objects.filter(is_active=True)
                for user in users:
                    token = str(uuid.uuid4())
                    Invite.objects.create(
                        survey=survey,
                        email=user.email,
                        token=token,
                        expires_at=expires_at
                    )
                messages.success(request, f'Invites sent to {users.count()} users.')
            
            elif invite_type == 'manual_list':
                email_list = form.cleaned_data['email_list']
                emails = [email.strip() for email in email_list.split('\n') if email.strip()]
                for email in emails:
                    token = str(uuid.uuid4())
                    Invite.objects.create(
                        survey=survey,
                        email=email,
                        token=token,
                        expires_at=expires_at
                    )
                messages.success(request, f'Invites sent to {len(emails)} email addresses.')
            
            return redirect('surveys:survey_invites', pk=survey.pk)
    else:
        form = BulkInviteForm()
    
    invites = survey.invites.all().order_by('-expires_at')
    
    context = {
        'survey': survey,
        'form': form,
        'invites': invites,
        'page_title': f'Manage Invites: {survey.title}'
    }
    return render(request, 'surveys/admin/survey_invites.html', context)


# Reporting Views
@login_required
@user_passes_test(is_survey_analyst)
def survey_reports(request, pk):
    """View survey reports and analytics"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        form = SurveyReportForm(request.POST)
        if form.is_valid():
            # Generate report based on form data
            report_data = generate_survey_report(survey, form.cleaned_data)
            context = {
                'survey': survey,
                'report_data': report_data,
                'form': form,
                'page_title': f'Reports: {survey.title}'
            }
            return render(request, 'surveys/reports/survey_report.html', context)
    else:
        form = SurveyReportForm()
    
    # Basic stats
    total_responses = survey.response_count
    response_rate = 0
    if survey.invites.count() > 0:
        response_rate = (total_responses / survey.invites.count()) * 100
    
    context = {
        'survey': survey,
        'form': form,
        'total_responses': total_responses,
        'response_rate': response_rate,
        'page_title': f'Reports: {survey.title}'
    }
    return render(request, 'surveys/reports/survey_reports.html', context)


def generate_survey_report(survey, options):
    """Generate survey report data based on options"""
    report_data = {
        'summary': {},
        'questions': [],
        'cohorts': {},
        'sentiment': {}
    }
    
    # Get responses based on date filters
    responses = survey.responses.all()
    if options.get('date_from'):
        responses = responses.filter(submitted_at__gte=options['date_from'])
    if options.get('date_to'):
        responses = responses.filter(submitted_at__lte=options['date_to'])
    
    # Summary statistics
    report_data['summary'] = {
        'total_responses': responses.count(),
        'response_rate': (responses.count() / survey.invites.count() * 100) if survey.invites.count() > 0 else 0,
        'date_range': {
            'from': options.get('date_from'),
            'to': options.get('date_to')
        }
    }
    
    # Question-level analysis
    for section in survey.sections.all():
        for question in section.questions.all():
            question_data = {
                'question': question,
                'answers': [],
                'stats': {}
            }
            
            answers = Answer.objects.filter(
                question=question,
                response__in=responses
            )
            
            if question.type in ['LIKERT', 'NPS', 'NUMBER']:
                numeric_answers = [a.value_number for a in answers if a.value_number is not None]
                if numeric_answers:
                    question_data['stats'] = {
                        'count': len(numeric_answers),
                        'mean': sum(numeric_answers) / len(numeric_answers),
                        'median': sorted(numeric_answers)[len(numeric_answers) // 2],
                        'min': min(numeric_answers),
                        'max': max(numeric_answers)
                    }
            
            elif question.type in ['MULTI', 'SINGLE']:
                choice_counts = {}
                for answer in answers:
                    selected = answer.value_json.get('selected', [])
                    for choice in selected:
                        choice_counts[choice] = choice_counts.get(choice, 0) + 1
                question_data['stats'] = choice_counts
            
            question_data['answers'] = list(answers)
            report_data['questions'].append(question_data)
    
    return report_data


# HTMX Views for dynamic updates
@require_http_methods(["POST"])
@csrf_exempt
def reorder_sections(request, survey_pk):
    """HTMX endpoint for reordering sections"""
    if not request.user.is_authenticated or not is_survey_admin(request.user):
        return JsonResponse({'error': 'Unauthorized'}, status=403)
    
    try:
        data = json.loads(request.body)
        section_orders = data.get('section_orders', [])
        
        for item in section_orders:
            section_id = item.get('id')
            new_order = item.get('order')
            if section_id and new_order is not None:
                Section.objects.filter(id=section_id).update(order=new_order)
        
        return JsonResponse({'success': True})
    except Exception as e:
        return JsonResponse({'error': str(e)}, status=400)


@require_http_methods(["POST"])
@csrf_exempt
def reorder_questions(request, section_pk):
    """HTMX endpoint for reordering questions"""
    if not request.user.is_authenticated or not is_survey_admin(request.user):
        return JsonResponse({'error': 'Unauthorized'}, status=403)
    
    try:
        data = json.loads(request.body)
        question_orders = data.get('question_orders', [])
        
        for item in question_orders:
            question_id = item.get('id')
            new_order = item.get('order')
            if question_id and new_order is not None:
                Question.objects.filter(id=question_id).update(order=new_order)
        
        return JsonResponse({'success': True})
    except Exception as e:
        return JsonResponse({'error': str(e)}, status=400)


# API Views for mobile/JS consumption
def survey_api_detail(request, pk):
    """API endpoint for survey details"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if not survey.is_active:
        return JsonResponse({'error': 'Survey not active'}, status=400)
    
    data = {
        'id': survey.pk,
        'title': survey.title,
        'description': survey.description,
        'sections': []
    }
    
    for section in survey.sections.all():
        section_data = {
            'id': section.pk,
            'title': section.title,
            'description': section.description,
            'order': section.order,
            'questions': []
        }
        
        for question in section.questions.all():
            question_data = {
                'id': question.pk,
                'type': question.type,
                'prompt': question.prompt,
                'help_text': question.help_text,
                'required': question.required,
                'anonymity_mode': question.anonymity_mode,
                'order': question.order
            }
            
            if question.is_scale_question:
                question_data.update({
                    'scale_min': question.scale_min,
                    'scale_max': question.scale_max
                })
            
            if question.options:
                question_data['options'] = question.options
            
            section_data['questions'].append(question_data)
        
        data['sections'].append(section_data)
    
    return JsonResponse(data)

```

### surveys/urls.py
```python
from django.urls import path
from . import views

app_name = 'surveys'

urlpatterns = [
    # Index and lists
    path('', views.index, name='index'),
    path('list/', views.survey_list, name='list'),
    path('invites/', views.my_invites, name='my_invites'),

    # Public survey views
    path('<int:pk>/', views.survey_detail, name='detail'),
    path('<int:survey_pk>/take/', views.survey_response, name='take'),
    path('<int:survey_pk>/take/<str:token>/', views.survey_response, name='take_with_token'),
    path('response/<int:pk>/complete/', views.response_complete, name='response_complete'),

    # Results and exports
    path('results/', views.results_index, name='results'),
    path('<int:pk>/export/<str:format>/', views.export_report, name='export'),
    path('<int:pk>/action-note/', views.action_note, name='action_note'),

    # Admin / Builder
    path('admin/', views.survey_admin_list, name='survey_admin_list'),
    path('admin/create/', views.survey_create, name='builder'),
    path('admin/<int:pk>/edit/', views.survey_edit, name='survey_edit'),
    path('admin/<int:pk>/publish/', views.survey_publish, name='publish'),
    path('admin/<int:pk>/invites/', views.survey_invites, name='survey_invites'),
    path('admin/<int:pk>/reports/', views.survey_reports, name='survey_reports'),

    # HTMX endpoints for dynamic updates
    path('admin/<int:survey_pk>/reorder-sections/', views.reorder_sections, name='reorder_sections'),
    path('admin/<int:section_pk>/reorder-questions/', views.reorder_questions, name='reorder_questions'),

    # API endpoints
    path('api/<int:pk>/', views.survey_api_detail, name='survey_api_detail'),
]

```

### surveys/forms.py
```python
from django import forms
from django.contrib.auth.models import User
from django.core.exceptions import ValidationError
from django.utils import timezone
from .models import Survey, Section, Question, Response, Answer, Invite


class SurveyForm(forms.ModelForm):
    class Meta:
        model = Survey
        fields = ['title', 'description', 'publish_start', 'publish_end', 'k_threshold']
        widgets = {
            'publish_start': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
            'publish_end': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
            'description': forms.Textarea(attrs={'rows': 4}),
        }
    
    def clean(self):
        cleaned_data = super().clean()
        publish_start = cleaned_data.get('publish_start')
        publish_end = cleaned_data.get('publish_end')
        
        if publish_start and publish_end:
            if publish_start >= publish_end:
                raise ValidationError("Publish end date must be after publish start date.")
            
            if publish_start < timezone.now():
                raise ValidationError("Publish start date cannot be in the past.")
        
        return cleaned_data


class SectionForm(forms.ModelForm):
    class Meta:
        model = Section
        fields = ['title', 'description', 'order']
        widgets = {
            'description': forms.Textarea(attrs={'rows': 3}),
        }


class QuestionForm(forms.ModelForm):
    class Meta:
        model = Question
        fields = [
            'type', 'prompt', 'help_text', 'required', 'anonymity_mode',
            'options_json', 'scale_min', 'scale_max', 'order', 'logic_json'
        ]
        widgets = {
            'prompt': forms.Textarea(attrs={'rows': 3}),
            'help_text': forms.Textarea(attrs={'rows': 2}),
            'options_json': forms.Textarea(attrs={'rows': 4, 'placeholder': 'Enter JSON format options'}),
            'logic_json': forms.Textarea(attrs={'rows': 3, 'placeholder': 'Enter JSON format logic'}),
        }
    
    def clean(self):
        cleaned_data = super().clean()
        question_type = cleaned_data.get('type')
        scale_min = cleaned_data.get('scale_min')
        scale_max = cleaned_data.get('scale_max')
        options_json = cleaned_data.get('options_json')
        
        # Validate scale for scale-based questions
        if question_type in ['LIKERT', 'NPS', 'NUMBER']:
            if scale_min is None or scale_max is None:
                raise ValidationError("Scale min and max are required for scale-based questions.")
            if scale_min >= scale_max:
                raise ValidationError("Scale max must be greater than scale min.")
            if scale_max - scale_min > 10:
                raise ValidationError("Scale range cannot exceed 10 points.")
        
        # Validate options for choice-based questions
        if question_type in ['MULTI', 'SINGLE', 'RANK']:
            if not options_json or not isinstance(options_json, dict):
                raise ValidationError("Options are required for choice-based questions.")
            choices = options_json.get('choices', [])
            if not choices or len(choices) < 2:
                raise ValidationError("At least 2 choices are required for choice-based questions.")
        
        return cleaned_data


class ResponseForm(forms.ModelForm):
    class Meta:
        model = Response
        fields = ['cohort_json', 'meta_json']
        widgets = {
            'cohort_json': forms.Textarea(attrs={'rows': 3, 'placeholder': 'Enter JSON format cohort data'}),
            'meta_json': forms.Textarea(attrs={'rows': 3, 'placeholder': 'Enter JSON format metadata'}),
        }


class AnswerForm(forms.Form):
    """Dynamic form for answering questions based on question type"""
    
    def __init__(self, question, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.question = question
        self._build_fields()
    
    def _build_fields(self):
        """Build form fields based on question type"""
        question = self.question
        
        if question.type == 'LIKERT':
            choices = [(i, str(i)) for i in range(question.scale_min, question.scale_max + 1)]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.RadioSelect,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'NPS':
            choices = [(i, str(i)) for i in range(0, 11)]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.RadioSelect,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'MULTI':
            choices = [(opt, opt) for opt in question.options]
            self.fields['value'] = forms.MultipleChoiceField(
                choices=choices,
                widget=forms.CheckboxSelectMultiple,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'SINGLE':
            choices = [(opt, opt) for opt in question.options]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.RadioSelect,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'SHORT_TEXT':
            self.fields['value'] = forms.CharField(
                max_length=500,
                widget=forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'LONG_TEXT':
            self.fields['value'] = forms.CharField(
                widget=forms.Textarea(attrs={'rows': 4, 'class': 'textarea textarea-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'NUMBER':
            self.fields['value'] = forms.IntegerField(
                min_value=question.scale_min,
                max_value=question.scale_max,
                widget=forms.NumberInput(attrs={'class': 'input input-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'DATE':
            self.fields['value'] = forms.DateField(
                widget=forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'RANK':
            choices = [(opt, opt) for opt in question.options]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.Select(attrs={'class': 'select select-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        # Add anonymity-specific fields for text questions
        if question.type in ['SHORT_TEXT', 'LONG_TEXT']:
            if question.anonymity_mode == 'ESCROW':
                self.fields['followup_opt_in'] = forms.BooleanField(
                    required=False,
                    initial=True,
                    label="I'm open to follow-up questions about this answer"
                )
                self.fields['preferred_contact'] = forms.CharField(
                    max_length=200,
                    required=False,
                    widget=forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
                    label="Preferred contact method (optional)"
                )
            
            if question.anonymity_mode in ['ESCROW', 'SIGNED']:
                self.fields['is_signed'] = forms.BooleanField(
                    required=False,
                    initial=(question.anonymity_mode == 'SIGNED'),
                    label="Sign this answer with my name"
                )
    
    def clean_value(self):
        """Clean and validate the answer value"""
        value = self.cleaned_data.get('value')
        question = self.question
        
        if question.required and not value:
            raise ValidationError("This question is required.")
        
        # Type-specific validation
        if question.type == 'NUMBER':
            if value < question.scale_min or value > question.scale_max:
                raise ValidationError(f"Value must be between {question.scale_min} and {question.scale_max}.")
        
        return value


class InviteForm(forms.ModelForm):
    class Meta:
        model = Invite
        fields = ['email', 'expires_at']
        widgets = {
            'expires_at': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
        }
    
    def clean_expires_at(self):
        expires_at = self.cleaned_data.get('expires_at')
        if expires_at and expires_at <= timezone.now():
            raise ValidationError("Expiration date must be in the future.")
        return expires_at


class BulkInviteForm(forms.Form):
    """Form for bulk inviting users to surveys"""
    SURVEY_CHOICES = []
    USER_CHOICES = []
    
    survey = forms.ModelChoiceField(
        queryset=Survey.objects.filter(status='PUBLISHED'),
        empty_label="Select a survey",
        widget=forms.Select(attrs={'class': 'select select-bordered w-full'})
    )
    
    invite_type = forms.ChoiceField(
        choices=[
            ('all_users', 'All Users'),
            ('by_group', 'By Group'),
            ('manual_list', 'Manual Email List'),
        ],
        widget=forms.RadioSelect
    )
    
    # For manual email list
    email_list = forms.CharField(
        widget=forms.Textarea(attrs={
            'rows': 5,
            'placeholder': 'Enter email addresses, one per line',
            'class': 'textarea textarea-bordered w-full'
        }),
        required=False,
        help_text="Enter email addresses, one per line"
    )
    
    # For group selection
    groups = forms.ModelMultipleChoiceField(
        queryset=User.objects.none(),  # Will be populated in __init__
        required=False,
        widget=forms.CheckboxSelectMultiple
    )
    
    expires_in_days = forms.IntegerField(
        min_value=1,
        max_value=30,
        initial=7,
        widget=forms.NumberInput(attrs={'class': 'input input-bordered w-full'}),
        help_text="Invite expires in X days"
    )
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        # Populate user choices for group selection
        self.fields['groups'].queryset = User.objects.filter(is_active=True)
    
    def clean(self):
        cleaned_data = super().clean()
        invite_type = cleaned_data.get('invite_type')
        
        if invite_type == 'manual_list':
            email_list = cleaned_data.get('email_list', '').strip()
            if not email_list:
                raise ValidationError("Email list is required for manual invites.")
            
            # Validate email format
            emails = [email.strip() for email in email_list.split('\n') if email.strip()]
            for email in emails:
                if not forms.EmailField().clean(email):
                    raise ValidationError(f"Invalid email format: {email}")
        
        elif invite_type == 'by_group':
            groups = cleaned_data.get('groups')
            if not groups:
                raise ValidationError("Please select at least one group for group-based invites.")
        
        return cleaned_data


class SurveyReportForm(forms.Form):
    """Form for generating survey reports"""
    REPORT_TYPES = [
        ('summary', 'Summary Report'),
        ('detailed', 'Detailed Report'),
        ('cohort', 'Cohort Analysis'),
        ('sentiment', 'Sentiment Analysis'),
    ]
    
    EXPORT_FORMATS = [
        ('html', 'HTML'),
        ('csv', 'CSV'),
        ('xlsx', 'Excel'),
        ('pdf', 'PDF'),
    ]
    
    report_type = forms.ChoiceField(
        choices=REPORT_TYPES,
        widget=forms.RadioSelect,
        initial='summary'
    )
    
    export_format = forms.ChoiceField(
        choices=EXPORT_FORMATS,
        widget=forms.Select(attrs={'class': 'select select-bordered w-full'}),
        initial='html'
    )
    
    include_anonymous = forms.BooleanField(
        required=False,
        initial=True,
        label="Include anonymous responses in aggregates"
    )
    
    min_cohort_size = forms.IntegerField(
        min_value=1,
        initial=5,
        widget=forms.NumberInput(attrs={'class': 'input input-bordered w-full'}),
        help_text="Minimum cohort size for detailed breakdowns (k-anonymity)"
    )
    
    date_from = forms.DateField(
        required=False,
        widget=forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
        help_text="Filter responses from this date (optional)"
    )
    
    date_to = forms.DateField(
        required=False,
        widget=forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
        help_text="Filter responses until this date (optional)"
    )

```

### surveys/admin.py
```python
from django.contrib import admin
from django.utils.html import format_html
from django.urls import reverse
from django.utils.safestring import mark_safe
from .models import Survey, Section, Question, Response, Answer, Invite, ReportSnapshot


class QuestionInline(admin.TabularInline):
    model = Question
    extra = 1
    fields = ['type', 'prompt', 'anonymity_mode', 'required', 'order']
    ordering = ['order']


class SectionInline(admin.TabularInline):
    model = Section
    extra = 1
    fields = ['title', 'description', 'order']
    ordering = ['order']


@admin.register(Survey)
class SurveyAdmin(admin.ModelAdmin):
    list_display = ['title', 'status', 'created_by', 'publish_start', 'publish_end', 'response_count', 'is_active_display']
    list_filter = ['status', 'created_by', 'publish_start', 'publish_end']
    search_fields = ['title', 'description', 'created_by__username']
    readonly_fields = ['created_at', 'updated_at', 'response_count', 'sections_count']
    inlines = [SectionInline]
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('title', 'description', 'created_by')
        }),
        ('Publishing', {
            'fields': ('status', 'publish_start', 'publish_end', 'k_threshold')
        }),
        ('Metadata', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def is_active_display(self, obj):
        if obj.is_active:
            return format_html('<span style="color: green;">✓ Active</span>')
        else:
            return format_html('<span style="color: red;">✗ Inactive</span>')
    is_active_display.short_description = 'Status'
    
    def response_count(self, obj):
        return obj.response_count
    response_count.short_description = 'Responses'


@admin.register(Section)
class SectionAdmin(admin.ModelAdmin):
    list_display = ['title', 'survey', 'order', 'questions_count']
    list_filter = ['survey']
    search_fields = ['title', 'survey__title']
    ordering = ['survey', 'order']
    inlines = [QuestionInline]
    
    def questions_count(self, obj):
        return obj.questions.count()
    questions_count.short_description = 'Questions'


@admin.register(Question)
class QuestionAdmin(admin.ModelAdmin):
    list_display = ['prompt_short', 'section', 'type', 'anonymity_mode', 'required', 'order']
    list_filter = ['type', 'anonymity_mode', 'required', 'section__survey']
    search_fields = ['prompt', 'section__title', 'section__survey__title']
    ordering = ['section', 'order']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('section', 'type', 'prompt', 'help_text', 'required', 'order')
        }),
        ('Anonymity & Logic', {
            'fields': ('anonymity_mode', 'logic_json')
        }),
        ('Options & Scales', {
            'fields': ('options_json', 'scale_min', 'scale_max'),
            'classes': ('collapse',)
        }),
    )
    
    def prompt_short(self, obj):
        return obj.prompt[:50] + "..." if len(obj.prompt) > 50 else obj.prompt
    prompt_short.short_description = 'Prompt'


class AnswerInline(admin.TabularInline):
    model = Answer
    extra = 0
    readonly_fields = ['question', 'display_value', 'is_signed', 'moderation_status']
    fields = ['question', 'display_value', 'is_signed', 'moderation_status']
    
    def display_value(self, obj):
        return obj.display_value
    display_value.short_description = 'Value'


@admin.register(Response)
class ResponseAdmin(admin.ModelAdmin):
    list_display = ['survey', 'identity_display', 'submitted_at', 'answers_count', 'is_anonymous_display']
    list_filter = ['survey', 'submitted_at', 'survey__status']
    search_fields = ['survey__title', 'identity_user__username', 'identity_user__email']
    readonly_fields = ['submitted_at', 'answers_count']
    inlines = [AnswerInline]
    
    fieldsets = (
        ('Response Information', {
            'fields': ('survey', 'identity_user', 'submitted_at')
        }),
        ('Metadata', {
            'fields': ('cohort_json', 'meta_json'),
            'classes': ('collapse',)
        }),
    )
    
    def identity_display(self, obj):
        if obj.identity_user:
            return obj.identity_user.username
        return 'Anonymous'
    identity_display.short_description = 'Respondent'
    
    def is_anonymous_display(self, obj):
        if obj.is_anonymous:
            return format_html('<span style="color: orange;">Anonymous</span>')
        else:
            return format_html('<span style="color: blue;">Identified</span>')
    is_anonymous_display.short_description = 'Anonymity'
    
    def answers_count(self, obj):
        return obj.answers_count
    answers_count.short_description = 'Answers'


@admin.register(Answer)
class AnswerAdmin(admin.ModelAdmin):
    list_display = ['question_short', 'response', 'display_value', 'question_anonymity_mode', 'moderation_status']
    list_filter = ['question__type', 'question__anonymity_mode', 'moderation_status', 'is_signed']
    search_fields = ['question__prompt', 'response__survey__title', 'value_text']
    readonly_fields = ['response', 'question', 'display_value']
    
    fieldsets = (
        ('Answer Information', {
            'fields': ('response', 'question', 'display_value')
        }),
        ('Values', {
            'fields': ('value_text', 'value_number', 'value_json'),
            'classes': ('collapse',)
        }),
        ('Metadata', {
            'fields': ('is_signed', 'signed_by', 'followup_opt_in', 'preferred_contact')
        }),
        ('Moderation', {
            'fields': ('moderation_status', 'flags_json'),
            'classes': ('collapse',)
        }),
    )
    
    def question_short(self, obj):
        return obj.question.prompt[:50] + "..." if len(obj.question.prompt) > 50 else obj.question.prompt
    question_short.short_description = 'Question'
    
    def question_anonymity_mode(self, obj):
        return obj.question.anonymity_mode
    question_anonymity_mode.short_description = 'Anonymity Mode'
    
    def display_value(self, obj):
        return obj.display_value
    display_value.short_description = 'Value'


@admin.register(Invite)
class InviteAdmin(admin.ModelAdmin):
    list_display = ['survey', 'email_display', 'token_short', 'expires_at', 'status_display']
    list_filter = ['survey', 'expires_at', 'used_at']
    search_fields = ['survey__title', 'email', 'token']
    readonly_fields = ['token', 'status_display']
    
    fieldsets = (
        ('Invite Information', {
            'fields': ('survey', 'email', 'token', 'expires_at')
        }),
        ('Usage', {
            'fields': ('used_at', 'meta_json'),
            'classes': ('collapse',)
        }),
    )
    
    def email_display(self, obj):
        return obj.email or 'Anonymous'
    email_display.short_description = 'Email'
    
    def token_short(self, obj):
        return obj.token[:8] + "..."
    token_short.short_description = 'Token'
    
    def status_display(self, obj):
        if obj.is_expired:
            return format_html('<span style="color: red;">Expired</span>')
        elif obj.is_used:
            return format_html('<span style="color: orange;">Used</span>')
        else:
            return format_html('<span style="color: green;">Valid</span>')
    status_display.short_description = 'Status'


@admin.register(ReportSnapshot)
class ReportSnapshotAdmin(admin.ModelAdmin):
    list_display = ['survey', 'computed_at', 'response_rate', 'enps_score']
    list_filter = ['survey', 'computed_at']
    search_fields = ['survey__title']
    readonly_fields = ['computed_at', 'response_rate', 'enps_score']
    
    fieldsets = (
        ('Snapshot Information', {
            'fields': ('survey', 'computed_at')
        }),
        ('Aggregates', {
            'fields': ('aggregates_json',),
            'classes': ('collapse',)
        }),
    )
    
    def response_rate(self, obj):
        return f"{obj.response_rate:.1f}%"
    response_rate.short_description = 'Response Rate'
    
    def enps_score(self, obj):
        return f"{obj.enps_score:.1f}"
    enps_score.short_description = 'eNPS Score'

```

### surveys/apps.py
```python
from django.apps import AppConfig


class SurveysConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'surveys'
    verbose_name = 'Surveys & Feedback'

```

### Templates in surveys
### surveys/templates/surveys/response_complete.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <div class="text-center">
        <!-- Success Icon -->
        <div class="mb-6">
            <div class="w-24 h-24 bg-success rounded-full flex items-center justify-center mx-auto">
                <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
        </div>
        
        <!-- Success Message -->
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Survey Complete!</h1>
        <p class="text-lg text-gray-600 mb-6">
            Thank you for taking the time to complete 
            <span class="font-semibold">{{ response.survey.title }}</span>.
        </p>
        
        <!-- Response Details -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body text-center">
                <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Your Response</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                    <div class="stat bg-gray-50 rounded-lg">
                        <div class="stat-title text-sm">Questions Answered</div>
                        <div class="stat-value text-primary text-2xl">{{ response.answers.count }}</div>
                    </div>
                    
                    <div class="stat bg-gray-50 rounded-lg">
                        <div class="stat-title text-sm">Submitted</div>
                        <div class="stat-value text-info text-2xl">{{ response.submitted_at|date:"M j" }}</div>
                        <div class="stat-desc text-xs">{{ response.submitted_at|date:"g:i A" }}</div>
                    </div>
                </div>
                
                {% if response.identity_user %}
                    <p class="text-sm text-gray-600">
                        Response ID: <span class="font-mono">{{ response.pk }}</span>
                    </p>
                {% else %}
                    <p class="text-sm text-gray-600">
                        <span class="badge badge-warning">Anonymous Response</span>
                    </p>
                {% endif %}
            </div>
        </div>
        
        <!-- Anonymity Information -->
        <div class="card bg-blue-50 border border-blue-200 mb-8">
            <div class="card-body text-center">
                <h3 class="font-semibold text-blue-800 mb-2">Your Privacy is Protected</h3>
                <p class="text-blue-700 text-sm">
                    {% if response.identity_user %}
                        Your responses are stored securely and will only be used for improving our organization.
                        {% if response.answers.filter.is_signed=True %}
                            Some of your answers were signed and may be attributed to you in reports.
                        {% else %}
                            Your responses are private and will be aggregated with others for analysis.
                        {% endif %}
                    {% else %}
                        This was an anonymous survey. Your responses cannot be traced back to you.
                    {% endif %}
                </p>
            </div>
        </div>
        
        <!-- Next Steps -->
        <div class="card bg-gray-50 border border-gray-200 mb-8">
            <div class="card-body text-center">
                <h3 class="font-semibold text-gray-800 mb-2">What Happens Next?</h3>
                <div class="space-y-2 text-sm text-gray-600">
                    <p>• Your responses will be analyzed along with others</p>
                    <p>• Reports will be generated for organizational improvement</p>
                    <p>• If you opted in for follow-up, you may be contacted</p>
                    <p>• Results will be shared with the team when available</p>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="space-y-4">
            <a href="{% url 'surveys:survey_list' %}" class="btn btn-primary btn-lg">
                View Other Surveys
            </a>
            
            <div class="flex justify-center gap-4">
                <a href="{% url 'home' %}" class="btn btn-outline">
                    ← Back to Home
                </a>
                
                {% if user.is_staff %}
                    <a href="{% url 'surveys:survey_reports' response.survey.pk %}" class="btn btn-outline btn-secondary">
                        View Reports
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

### surveys/templates/surveys/survey_detail.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Survey Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">{{ survey.title }}</h1>
        {% if survey.description %}
            <p class="text-lg text-gray-600 mb-6">{{ survey.description }}</p>
        {% endif %}
        
        <!-- Status Badge -->
        {% if survey.is_active %}
            <div class="badge badge-success badge-lg mb-4">Active Survey</div>
        {% else %}
            <div class="badge badge-warning badge-lg mb-4">Survey Not Active</div>
        {% endif %}
        
        <!-- Survey Info -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="stat bg-white shadow-lg rounded-lg">
                <div class="stat-figure text-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="stat-title text-sm">Sections</div>
                <div class="stat-value text-primary text-2xl">{{ survey.sections.count }}</div>
            </div>
            
            <div class="stat bg-white shadow-lg rounded-lg">
                <div class="stat-figure text-info">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="stat-title text-sm">Questions</div>
                <div class="stat-value text-info text-2xl">{{ survey.sections.all|length }}</div>
            </div>
            
            <div class="stat bg-white shadow-lg rounded-lg">
                <div class="stat-figure text-success">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <div class="stat-title text-sm">Responses</div>
                <div class="stat-value text-success text-2xl">{{ survey.response_count }}</div>
            </div>
        </div>
        
        <!-- Availability -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 class="font-semibold text-gray-800 mb-2">Survey Availability</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="font-medium">Start Date:</span>
                    <span class="text-gray-600">{{ survey.publish_start|date:"F j, Y \a\t g:i A" }}</span>
                </div>
                <div>
                    <span class="font-medium">End Date:</span>
                    <span class="text-gray-600">{{ survey.publish_end|date:"F j, Y \a\t g:i A" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Survey Preview -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Survey Preview</h2>
            
            {% if survey.sections.all %}
                <div class="space-y-6">
                    {% for section in survey.sections.all %}
                        <div class="border-l-4 border-primary pl-4">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">
                                {{ section.title }}
                            </h3>
                            
                            {% if section.description %}
                                <p class="text-gray-600 mb-4">{{ section.description }}</p>
                            {% endif %}
                            
                            {% if section.questions.all %}
                                <div class="space-y-3">
                                    {% for question in section.questions.all %}
                                        <div class="bg-gray-50 rounded-lg p-3">
                                            <div class="flex items-start justify-between mb-2">
                                                <h4 class="font-medium text-gray-700">
                                                    {{ question.prompt }}
                                                </h4>
                                                <span class="badge badge-sm 
                                                    {% if question.anonymity_mode == 'ANONYMOUS' %}badge-warning
                                                    {% elif question.anonymity_mode == 'ESCROW' %}badge-info
                                                    {% else %}badge-success{% endif %}">
                                                    {% if question.anonymity_mode == 'ANONYMOUS' %}
                                                        Anonymous
                                                    {% elif question.anonymity_mode == 'ESCROW' %}
                                                        Private
                                                    {% else %}
                                                        Signed
                                                    {% endif %}
                                                </span>
                                            </div>
                                            
                                            <div class="text-sm text-gray-500">
                                                <span class="font-medium">Type:</span> 
                                                {% if question.type == 'LIKERT' %}Likert Scale ({{ question.scale_min }}-{{ question.scale_max }})
                                                {% elif question.type == 'NPS' %}Net Promoter Score (0-10)
                                                {% elif question.type == 'MULTI' %}Multiple Choice
                                                {% elif question.type == 'SINGLE' %}Single Choice
                                                {% elif question.type == 'SHORT_TEXT' %}Short Text
                                                {% elif question.type == 'LONG_TEXT' %}Long Text
                                                {% elif question.type == 'NUMBER' %}Number ({{ question.scale_min }}-{{ question.scale_max }})
                                                {% elif question.type == 'DATE' %}Date
                                                {% elif question.type == 'RANK' %}Ranking
                                                {% else %}{{ question.type }}{% endif %}
                                                
                                                {% if question.required %}
                                                    <span class="text-red-500 ml-2">* Required</span>
                                                {% endif %}
                                            </div>
                                            
                                            {% if question.help_text %}
                                                <p class="text-sm text-gray-600 mt-2 italic">{{ question.help_text }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-gray-500 italic">No questions in this section yet.</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">📝</div>
                    <p class="text-gray-600">This survey doesn't have any sections or questions yet.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="text-center space-y-4">
        {% if survey.is_active %}
            <a href="{% url 'surveys:take' survey.pk %}" 
               class="btn btn-primary btn-lg">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Take Survey Now
            </a>
        {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <p class="text-yellow-800">
                    This survey is not currently active. Please check back during the published dates.
                </p>
            </div>
        {% endif %}
        
        <div class="flex justify-center gap-4">
            <a href="{% url 'surveys:list' %}" class="btn btn-outline">
                ← Back to Surveys
            </a>
            
            {% if user.is_staff %}
                <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-outline btn-primary">
                    Edit Survey
                </a>
                <a href="{% url 'surveys:survey_reports' survey.pk %}" class="btn btn-outline btn-secondary">
                    View Reports
                </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

```

### surveys/templates/surveys/action_note.html
```python
{% extends 'base.html' %}
{% block title %}{{ page_title }}{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
  <h1 class="text-2xl font-bold mb-4">Post-Survey Action Note</h1>
  <p class="opacity-70 mb-6">Document next steps for {{ survey.title }}.</p>
  <form method="post" class="space-y-4">
    {% csrf_token %}
    <div class="form-control">
      <label class="label"><span class="label-text">Keep</span></label>
      <textarea class="textarea textarea-bordered" rows="2" name="keep"></textarea>
    </div>
    <div class="form-control">
      <label class="label"><span class="label-text">Stop</span></label>
      <textarea class="textarea textarea-bordered" rows="2" name="stop"></textarea>
    </div>
    <div class="form-control">
      <label class="label"><span class="label-text">Start</span></label>
      <textarea class="textarea textarea-bordered" rows="2" name="start"></textarea>
    </div>
    <div class="card-actions justify-end">
      <button class="btn btn-primary">Save</button>
    </div>
  </form>
  <div class="mt-6">
    <a class="btn btn-ghost" href="{% url 'surveys:survey_reports' survey.pk %}">Back to reports</a>
  </div>
{% endblock %}


```

### surveys/templates/surveys/survey_response.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<style>
    .anonymity-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
    }
    .anonymity-anonymous { background-color: #fef3c7; color: #92400e; }
    .anonymity-escrow { background-color: #dbeafe; color: #1e40af; }
    .anonymity-signed { background-color: #dcfce7; color: #166534; }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-4xl">
    <!-- Survey Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ survey.title }}</h1>
        {% if survey.description %}
            <p class="text-gray-600 mb-4">{{ survey.description }}</p>
        {% endif %}
        
        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
            <div class="bg-primary h-2 rounded-full transition-all duration-300" 
                 style="width: 0%" id="progress-bar"></div>
        </div>
        <p class="text-sm text-gray-500">
            <span id="current-question">1</span> of <span id="total-questions">{{ survey.sections.count }}</span> questions
        </p>
    </div>

    <!-- Survey Form -->
    <form method="post" id="survey-form" class="space-y-8">
        {% csrf_token %}
        
        {% for section in survey.sections.all %}
            <div class="section" data-section="{{ forloop.counter }}">
                <div class="card bg-white shadow-lg">
                    <div class="card-body">
                        <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">
                            {{ section.title }}
                        </h2>
                        
                        {% if section.description %}
                            <p class="text-gray-600 mb-6">{{ section.description }}</p>
                        {% endif %}
                        
                        {% for question in section.questions.all %}
                            <div class="question-container mb-8" data-question="{{ forloop.counter }}">
                                <div class="border-l-4 border-primary pl-4">
                                    <!-- Question Header -->
                                    <div class="flex items-start justify-between mb-3">
                                        <h3 class="text-lg font-medium text-gray-800">
                                            {{ question.prompt }}
                                        </h3>
                                        <span class="anonymity-badge anonymity-{{ question.anonymity_mode|lower }}">
                                            {% if question.anonymity_mode == 'ANONYMOUS' %}
                                                Anonymous
                                            {% elif question.anonymity_mode == 'ESCROW' %}
                                                Private
                                            {% else %}
                                                Signed
                                            {% endif %}
                                        </span>
                                    </div>
                                    
                                    {% if question.help_text %}
                                        <p class="text-sm text-gray-600 mb-4">{{ question.help_text }}</p>
                                    {% endif %}
                                    
                                    <!-- Question Input -->
                                    <div class="question-input">
                                        {% if question.type == 'LIKERT' %}
                                            <div class="flex flex-wrap gap-3">
                                                {% for i in question.scale_values %}
                                                    <label class="flex flex-col items-center">
                                                        <input type="radio" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ i }}"
                                                               class="radio radio-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="text-sm mt-1">{{ i }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        
                                        {% elif question.type == 'NPS' %}
                                            <div class="grid grid-cols-11 gap-1">
                                                {% for i in question.scale_values %}
                                                    <label class="flex flex-col items-center">
                                                        <input type="radio" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ i }}"
                                                               class="radio radio-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="text-xs mt-1">{{ i }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                                <span>Not likely</span>
                                                <span>Very likely</span>
                                            </div>
                                        
                                        {% elif question.type == 'MULTI' %}
                                            <div class="space-y-2">
                                                {% for option in question.options %}
                                                    <label class="flex items-center">
                                                        <input type="checkbox" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ option }}"
                                                               class="checkbox checkbox-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="ml-2">{{ option }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        
                                        {% elif question.type == 'SINGLE' %}
                                            <div class="space-y-2">
                                                {% for option in question.options %}
                                                    <label class="flex items-center">
                                                        <input type="radio" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ option }}"
                                                               class="radio radio-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="ml-2">{{ option }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        
                                        {% elif question.type == 'SHORT_TEXT' %}
                                            <input type="text" 
                                                   name="question_{{ question.pk }}"
                                                   class="input input-bordered w-full"
                                                   maxlength="500"
                                                   {% if question.required %}required{% endif %}
                                                   placeholder="Enter your answer...">
                                        
                                        {% elif question.type == 'LONG_TEXT' %}
                                            <textarea name="question_{{ question.pk }}"
                                                      class="textarea textarea-bordered w-full"
                                                      rows="4"
                                                      {% if question.required %}required{% endif %}
                                                      placeholder="Enter your answer..."></textarea>
                                        
                                        {% elif question.type == 'NUMBER' %}
                                            <input type="number" 
                                                   name="question_{{ question.pk }}"
                                                   class="input input-bordered w-full"
                                                   min="{{ question.scale_min }}"
                                                   max="{{ question.scale_max }}"
                                                   {% if question.required %}required{% endif %}
                                                   placeholder="Enter a number between {{ question.scale_min }} and {{ question.scale_max }}">
                                        
                                        {% elif question.type == 'DATE' %}
                                            <input type="date" 
                                                   name="question_{{ question.pk }}"
                                                   class="input input-bordered w-full"
                                                   {% if question.required %}required{% endif %}>
                                        
                                        {% elif question.type == 'RANK' %}
                                            <select name="question_{{ question.pk }}"
                                                    class="select select-bordered w-full"
                                                    {% if question.required %}required{% endif %}>
                                                <option value="">Select an option</option>
                                                {% for option in question.options %}
                                                    <option value="{{ option }}">{{ option }}</option>
                                                {% endfor %}
                                            </select>
                                        {% endif %}
                                        
                                        <!-- Anonymity-specific fields for text questions -->
                                        {% if question.type == 'SHORT_TEXT' or question.type == 'LONG_TEXT' %}
                                            {% if question.anonymity_mode == 'ESCROW' %}
                                                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                                                    <label class="flex items-center mb-3">
                                                        <input type="checkbox" 
                                                               name="question_{{ question.pk }}_followup"
                                                               class="checkbox checkbox-primary"
                                                               checked>
                                                        <span class="ml-2 text-sm">I'm open to follow-up questions about this answer</span>
                                                    </label>
                                                    <input type="text" 
                                                           name="question_{{ question.pk }}_contact"
                                                           class="input input-bordered w-full text-sm"
                                                           placeholder="Preferred contact method (optional)">
                                                </div>
                                            {% endif %}
                                            
                                            {% if question.anonymity_mode in 'ESCROW,SIGNED' %}
                                                <div class="mt-4 p-4 bg-green-50 rounded-lg">
                                                    <label class="flex items-center">
                                                        <input type="checkbox" 
                                                               name="question_{{ question.pk }}_signed"
                                                               class="checkbox checkbox-primary"
                                                               {% if question.anonymity_mode == 'SIGNED' %}checked{% endif %}>
                                                        <span class="ml-2 text-sm">Sign this answer with my name</span>
                                                    </label>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% endfor %}
        
        <!-- Final Comment Section -->
        <div class="card bg-white shadow-lg">
            <div class="card-body">
                                <h3 class="text-lg font-medium text-gray-800 mb-4">Additional Comments (Optional)</h3>
                                <textarea name="final_comment"
                                          class="textarea textarea-bordered w-full"
                                          rows="3"
                                          placeholder="Any additional thoughts or feedback..."></textarea>
                                
                                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                                    <label class="flex items-center mb-3">
                                        <input type="checkbox" 
                                               name="final_comment_signed"
                                               class="checkbox checkbox-primary">
                                        <span class="ml-2 text-sm">Sign this comment with my name</span>
                                    </label>
                                </div>
                            </div>
                        </div>
        
        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" class="btn btn-primary btn-lg">
                Submit Survey
            </button>
        </div>
    </form>
</div>

<script>
// Progress tracking
document.addEventListener('DOMContentLoaded', function() {
    const totalQuestions = {{ survey.sections.count }};
    const progressBar = document.getElementById('progress-bar');
    const currentQuestionSpan = document.getElementById('current-question');
    
    // Update progress as user scrolls
    function updateProgress() {
        const scrollTop = window.pageYOffset;
        const docHeight = document.body.offsetHeight - window.innerHeight;
        const scrollPercent = scrollTop / docHeight;
        const progress = Math.min(scrollPercent * totalQuestions, totalQuestions);
        
        progressBar.style.width = (progress / totalQuestions * 100) + '%';
        currentQuestionSpan.textContent = Math.max(1, Math.ceil(progress));
    }
    
    window.addEventListener('scroll', updateProgress);
    updateProgress();
    
    // Form validation
    const form = document.getElementById('survey-form');
    form.addEventListener('submit', function(e) {
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value) {
                isValid = false;
                field.classList.add('input-error');
            } else {
                field.classList.remove('input-error');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            alert('Please complete all required questions before submitting.');
        }
    });
});
</script>
{% endblock %}

```

### surveys/templates/surveys/results_index.html
```python
{% extends 'base.html' %}
{% block title %}{{ page_title }}{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">Survey Results</h1>
  {% if surveys %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for s in surveys %}
    <div class="card bg-white shadow">
      <div class="card-body">
        <h2 class="card-title">{{ s.title }}</h2>
        <a href="{% url 'surveys:survey_reports' s.pk %}" class="btn btn-outline btn-sm">Open</a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="opacity-70">No results available.</div>
  {% endif %}
</div>
{% endblock %}


```

### surveys/templates/surveys/my_invites.html
```python
{% extends 'base.html' %}
{% load humanize %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">My Survey Invites</h1>
        <a href="{% url 'surveys:list' %}" class="btn btn-ghost">Browse Surveys</a>
    </div>

    {% include 'surveys/partials/privacy_explainer.html' %}

    {% if invites %}
    <div class="space-y-4">
        {% for invite in invites %}
        <div class="card bg-white shadow">
            <div class="card-body">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="card-title">{{ invite.survey.title }}</h2>
                        <p class="text-sm opacity-70">Expires {{ invite.expires_at|naturaltime }}</p>
                    </div>
                    <div class="card-actions">
                        <a href="{% url 'surveys:take_with_token' invite.survey_id invite.token %}" class="btn btn-primary">Start</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 opacity-70">No pending invites.</div>
    {% endif %}
</div>
{% endblock %}



```

### surveys/templates/surveys/survey_list.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">Available Surveys</h1>
        <p class="text-lg text-gray-600">Share your feedback and help us improve</p>
    </div>

    {% if surveys %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for survey in surveys %}
                <div class="card bg-white shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div class="card-body">
                        <h2 class="card-title text-xl font-semibold text-gray-800">
                            {{ survey.title }}
                        </h2>
                        
                        {% if survey.description %}
                            <p class="text-gray-600 mb-4">{{ survey.description|truncatewords:20 }}</p>
                        {% endif %}
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            <div class="badge badge-primary">
                                {{ survey.sections_count }} section{{ survey.sections_count|pluralize }}
                            </div>
                            <div class="badge badge-secondary">
                                {{ survey.response_count }} response{{ survey.response_count|pluralize }}
                            </div>
                            {% if survey.is_active %}
                                <div class="badge badge-success">Active</div>
                            {% else %}
                                <div class="badge badge-warning">Inactive</div>
                            {% endif %}
                        </div>
                        
                        <div class="text-sm text-gray-500 mb-4">
                            <p><strong>Available:</strong> {{ survey.publish_start|date:"M j, Y" }} - {{ survey.publish_end|date:"M j, Y" }}</p>
                        </div>
                        
                        <div class="card-actions justify-end">
                            <a href="{% url 'surveys:detail' survey.pk %}" 
                               class="btn btn-primary">
                                View Details
                            </a>
                            {% if survey.is_active %}
                                <a href="{% url 'surveys:take' survey.pk %}" 
                                   class="btn btn-outline btn-primary">
                                    Take Survey
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📝</div>
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">No Surveys Available</h2>
            <p class="text-gray-600 mb-6">There are currently no active surveys to complete.</p>
            {% if user.is_staff %}
                <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-primary">
                    Manage Surveys
                </a>
            {% endif %}
        </div>
    {% endif %}
    
    {% if user.is_staff %}
        <div class="text-center mt-8">
            <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline btn-primary">
                Survey Administration
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

```

### surveys/templates/surveys/admin/survey_invites.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Manage Invites: {{ survey.title }}</h1>
        <p class="text-gray-600 mt-2">Send invitations and track survey participation</p>
    </div>

    <!-- Survey Status -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Survey Status</h2>
                    <div class="flex items-center gap-4 text-sm">
                        <span class="badge {% if survey.status == 'PUBLISHED' %}badge-success{% elif survey.status == 'DRAFT' %}badge-warning{% else %}badge-error{% endif %}">
                            {{ survey.status }}
                        </span>
                        <span class="text-gray-600">
                            Published: {{ survey.publish_start|date:"M j, Y" }} - {{ survey.publish_end|date:"M j, Y" }}
                        </span>
                    </div>
                </div>
                
                <div class="text-right">
                    <div class="text-2xl font-bold text-primary">{{ survey.response_count }}</div>
                    <div class="text-sm text-gray-500">Total Responses</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Invite Form -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Send Bulk Invitations</h2>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Invite Type</span>
                        </label>
                        <div class="space-y-3">
                            {% for choice in form.invite_type.field.choices %}
                                <label class="flex items-center">
                                    <input type="radio" name="{{ form.invite_type.name }}" 
                                           value="{{ choice.0 }}" 
                                           class="radio radio-primary"
                                           {% if choice.0 == form.invite_type.value %}checked{% endif %}>
                                    <span class="ml-2">{{ choice.1 }}</span>
                                </label>
                            {% endfor %}
                        </div>
                        {% if form.invite_type.errors %}
                            <div class="text-error text-sm mt-1">{{ form.invite_type.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Invite Expiration</span>
                        </label>
                        {{ form.expires_in_days }}
                        <label class="label">
                            <span class="label-text-alt">{{ form.expires_in_days.help_text }}</span>
                        </label>
                        {% if form.expires_in_days.errors %}
                            <div class="text-error text-sm mt-1">{{ form.expires_in_days.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Manual Email List -->
                <div id="manual-email-section" class="hidden">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Email Addresses</span>
                        </label>
                        {{ form.email_list }}
                        <label class="label">
                            <span class="label-text-alt">{{ form.email_list.help_text }}</span>
                        </label>
                        {% if form.email_list.errors %}
                            <div class="text-error text-sm mt-1">{{ form.email_list.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Group Selection -->
                <div id="group-selection-section" class="hidden">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Select Users</span>
                        </label>
                        {{ form.groups }}
                        {% if form.groups.errors %}
                            <div class="text-error text-sm mt-1">{{ form.groups.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                        Send Invitations
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Existing Invites -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Existing Invitations</h2>
            
            {% if invites %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Token</th>
                                <th>Status</th>
                                <th>Expires</th>
                                <th>Used</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for invite in invites %}
                                <tr>
                                    <td>
                                        {% if invite.email %}
                                            {{ invite.email }}
                                        {% else %}
                                            <span class="text-gray-500 italic">Anonymous</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <code class="text-xs bg-gray-100 px-2 py-1 rounded">
                                            {{ invite.token|slice:":8" }}...
                                        </code>
                                    </td>
                                    <td>
                                        {% if invite.is_expired %}
                                            <span class="badge badge-error">Expired</span>
                                        {% elif invite.is_used %}
                                            <span class="badge badge-warning">Used</span>
                                        {% else %}
                                            <span class="badge badge-success">Valid</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="text-sm">
                                            <div>{{ invite.expires_at|date:"M j, Y" }}</div>
                                            <div class="text-gray-500">{{ invite.expires_at|date:"g:i A" }}</div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if invite.used_at %}
                                            <div class="text-sm">
                                                <div>{{ invite.used_at|date:"M j, Y" }}</div>
                                                <div class="text-gray-500">{{ invite.used_at|date:"g:i A" }}</div>
                                            </div>
                                        {% else %}
                                            <span class="text-gray-500">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="flex gap-2">
                                            {% if not invite.is_used and not invite.is_expired %}
                                                <button class="btn btn-xs btn-outline" 
                                                        onclick="copyInviteLink('{{ invite.token }}')">
                                                    Copy Link
                                                </button>
                                                <button class="btn btn-xs btn-error" 
                                                        onclick="deleteInvite({{ invite.pk }})">
                                                    Delete
                                                </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Invite Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                    <div class="stat bg-gray-50 rounded-lg">
                        <div class="stat-title text-sm">Total Invites</div>
                        <div class="stat-value text-primary text-2xl">{{ invites.count }}</div>
                    </div>
                    
                    <div class="stat bg-green-50 rounded-lg">
                        <div class="stat-title text-sm">Valid</div>
                        <div class="stat-value text-success text-2xl">{{ invites|length|add:"0" }}</div>
                    </div>
                    
                    <div class="stat bg-yellow-50 rounded-lg">
                        <div class="stat-title text-sm">Used</div>
                        <div class="stat-value text-warning text-2xl">{{ invites|length|add:"0" }}</div>
                    </div>
                    
                    <div class="stat bg-red-50 rounded-lg">
                        <div class="stat-title text-sm">Expired</div>
                        <div class="stat-value text-error text-2xl">{{ invites|length|add:"0" }}</div>
                    </div>
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">📧</div>
                    <p class="text-gray-600">No invitations have been sent yet.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex justify-between items-center">
        <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline">
            ← Back to Surveys
        </a>
        
        <div class="flex gap-4">
            <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-outline btn-primary">
                Edit Survey
            </a>
            <a href="{% url 'surveys:survey_reports' survey.pk %}" class="btn btn-outline btn-secondary">
                View Reports
            </a>
        </div>
    </div>
</div>

<script>
// Show/hide sections based on invite type selection
document.addEventListener('DOMContentLoaded', function() {
    const inviteTypeRadios = document.querySelectorAll('input[name="invite_type"]');
    const manualEmailSection = document.getElementById('manual-email-section');
    const groupSelectionSection = document.getElementById('group-selection-section');
    
    function updateSections() {
        const selectedType = document.querySelector('input[name="invite_type"]:checked').value;
        
        manualEmailSection.classList.add('hidden');
        groupSelectionSection.classList.add('hidden');
        
        if (selectedType === 'manual_list') {
            manualEmailSection.classList.remove('hidden');
        } else if (selectedType === 'by_group') {
            groupSelectionSection.classList.remove('hidden');
        }
    }
    
    inviteTypeRadios.forEach(radio => {
        radio.addEventListener('change', updateSections);
    });
    
    // Initialize on page load
    updateSections();
});

function copyInviteLink(token) {
    const baseUrl = window.location.origin;
    const inviteUrl = `${baseUrl}/surveys/${surveyId}/response/${token}/`;
    
    navigator.clipboard.writeText(inviteUrl).then(function() {
        // Show success message
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('btn-success');
        button.classList.remove('btn-outline');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline');
        }, 2000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        alert('Failed to copy invite link. Please copy manually.');
    });
}

function deleteInvite(inviteId) {
    if (confirm('Are you sure you want to delete this invitation?')) {
        // This would typically be a POST request to delete the invite
        // For now, we'll just show a message
        alert('Invite deletion would be implemented here.');
    }
}

// Get survey ID from URL for the copy function
const surveyId = window.location.pathname.split('/')[2];
</script>
{% endblock %}

```

### surveys/templates/surveys/admin/survey_form.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<style>
    .drag-handle {
        cursor: move;
        color: #6b7280;
    }
    .drag-handle:hover {
        color: #374151;
    }
    .section-card, .question-card {
        transition: all 0.2s ease;
    }
    .section-card:hover, .question-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">{{ page_title }}</h1>
        <p class="text-gray-600 mt-2">Configure your survey settings and structure</p>
    </div>

    <form method="post" id="survey-form">
        {% csrf_token %}
        
        <!-- Survey Basic Info -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body">
                <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Survey Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Survey Title *</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <div class="text-error text-sm mt-1">{{ form.title.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">K-Anonymity Threshold *</span>
                        </label>
                        {{ form.k_threshold }}
                        <label class="label">
                            <span class="label-text-alt">Minimum cohort size for detailed reports</span>
                        </label>
                        {% if form.k_threshold.errors %}
                            <div class="text-error text-sm mt-1">{{ form.k_threshold.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-control mt-4">
                    <label class="label">
                        <span class="label-text font-medium">Description</span>
                    </label>
                    {{ form.description }}
                    {% if form.description.errors %}
                        <div class="text-error text-sm mt-1">{{ form.description.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Publish Start Date *</span>
                        </label>
                        {{ form.publish_start }}
                        {% if form.publish_start.errors %}
                            <div class="text-error text-sm mt-1">{{ form.publish_start.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Publish End Date *</span>
                        </label>
                        {{ form.publish_end }}
                        {% if form.publish_end.errors %}
                            <div class="text-error text-sm mt-1">{{ form.publish_end.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sections Management -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="card-title text-xl font-semibold text-gray-800">Survey Sections</h2>
                    <button type="button" class="btn btn-primary" onclick="addSection()">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Section
                    </button>
                </div>
                
                <div id="sections-container" class="space-y-4">
                    {% if survey %}
                        {% for section in survey.sections.all %}
                            <div class="section-card card bg-gray-50 border-2 border-dashed border-gray-300" data-section-id="{{ section.pk }}">
                                <div class="card-body">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <span class="drag-handle text-2xl">⋮⋮</span>
                                            <h3 class="text-lg font-medium">Section {{ forloop.counter }}</h3>
                                        </div>
                                        <button type="button" class="btn btn-sm btn-error" onclick="removeSection(this)">
                                            Remove
                                        </button>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text">Section Title</span>
                                            </label>
                                            <input type="text" name="section_{{ section.pk }}_title" 
                                                   value="{{ section.title }}" 
                                                   class="input input-bordered w-full" required>
                                        </div>
                                        
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text">Order</span>
                                            </label>
                                            <input type="number" name="section_{{ section.pk }}_order" 
                                                   value="{{ section.order }}" 
                                                   class="input input-bordered w-full" min="0" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-control mt-4">
                                        <label class="label">
                                            <span class="label-text">Description</span>
                                        </label>
                                        <textarea name="section_{{ section.pk }}_description" 
                                                  class="textarea textarea-bordered w-full" 
                                                  rows="2">{{ section.description }}</textarea>
                                    </div>
                                    
                                    <!-- Questions in this section -->
                                    <div class="mt-6">
                                        <div class="flex justify-between items-center mb-4">
                                            <h4 class="font-medium text-gray-700">Questions</h4>
                                            <button type="button" class="btn btn-sm btn-outline" onclick="addQuestion(this)">
                                                Add Question
                                            </button>
                                        </div>
                                        
                                        <div class="questions-container space-y-3">
                                            {% for question in section.questions.all %}
                                                <div class="question-card card bg-white border border-gray-200" data-question-id="{{ question.pk }}">
                                                    <div class="card-body p-4">
                                                        <div class="flex items-center justify-between mb-3">
                                                            <div class="flex items-center gap-3">
                                                                <span class="drag-handle text-xl">⋮⋮</span>
                                                                <span class="text-sm font-medium">Question {{ forloop.counter }}</span>
                                                            </div>
                                                            <button type="button" class="btn btn-xs btn-error" onclick="removeQuestion(this)">
                                                                Remove
                                                            </button>
                                                        </div>
                                                        
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Question Type</span>
                                                                </label>
                                                                <select name="question_{{ question.pk }}_type" class="select select-bordered w-full" required>
                                                                    <option value="LIKERT" {% if question.type == 'LIKERT' %}selected{% endif %}>Likert Scale</option>
                                                                    <option value="MULTI" {% if question.type == 'MULTI' %}selected{% endif %}>Multiple Choice</option>
                                                                    <option value="SINGLE" {% if question.type == 'SINGLE' %}selected{% endif %}>Single Choice</option>
                                                                    <option value="SHORT_TEXT" {% if question.type == 'SHORT_TEXT' %}selected{% endif %}>Short Text</option>
                                                                    <option value="LONG_TEXT" {% if question.type == 'LONG_TEXT' %}selected{% endif %}>Long Text</option>
                                                                    <option value="NPS" {% if question.type == 'NPS' %}selected{% endif %}>Net Promoter Score</option>
                                                                    <option value="NUMBER" {% if question.type == 'NUMBER' %}selected{% endif %}>Number</option>
                                                                    <option value="DATE" {% if question.type == 'DATE' %}selected{% endif %}>Date</option>
                                                                    <option value="RANK" {% if question.type == 'RANK' %}selected{% endif %}>Ranking</option>
                                                                </select>
                                                            </div>
                                                            
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Anonymity Mode</span>
                                                                </label>
                                                                <select name="question_{{ question.pk }}_anonymity" class="select select-bordered w-full" required>
                                                                    <option value="ANONYMOUS" {% if question.anonymity_mode == 'ANONYMOUS' %}selected{% endif %}>Anonymous</option>
                                                                    <option value="ESCROW" {% if question.anonymity_mode == 'ESCROW' %}selected{% endif %}>Private (Escrow)</option>
                                                                    <option value="SIGNED" {% if question.anonymity_mode == 'SIGNED' %}selected{% endif %}>Signed</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="form-control mt-4">
                                                            <label class="label">
                                                                <span class="label-text">Question Prompt *</span>
                                                            </label>
                                                            <textarea name="question_{{ question.pk }}_prompt" 
                                                                      class="textarea textarea-bordered w-full" 
                                                                      rows="2" required>{{ question.prompt }}</textarea>
                                                        </div>
                                                        
                                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Order</span>
                                                                </label>
                                                                <input type="number" name="question_{{ question.pk }}_order" 
                                                                       value="{{ question.order }}" 
                                                                       class="input input-bordered w-full" min="0" required>
                                                            </div>
                                                            
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Required</span>
                                                                </label>
                                                                <label class="label cursor-pointer">
                                                                    <input type="checkbox" name="question_{{ question.pk }}_required" 
                                                                           class="checkbox checkbox-primary" 
                                                                           {% if question.required %}checked{% endif %}>
                                                                    <span class="label-text ml-2">Required</span>
                                                                </label>
                                                            </div>
                                                            
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Help Text</span>
                                                                </label>
                                                                <input type="text" name="question_{{ question.pk }}_help" 
                                                                       value="{{ question.help_text }}" 
                                                                       class="input input-bordered w-full">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-between items-center">
            <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                {% if survey %}Update Survey{% else %}Create Survey{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
let sectionCounter = 0;
let questionCounter = 0;

function addSection() {
    sectionCounter++;
    const container = document.getElementById('sections-container');
    const sectionHtml = `
        <div class="section-card card bg-gray-50 border-2 border-dashed border-gray-300" data-section-id="new_${sectionCounter}">
            <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <span class="drag-handle text-2xl">⋮⋮</span>
                        <h3 class="text-lg font-medium">New Section</h3>
                    </div>
                    <button type="button" class="btn btn-sm btn-error" onclick="removeSection(this)">
                        Remove
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Section Title</span>
                        </label>
                        <input type="text" name="new_section_${sectionCounter}_title" 
                               class="input input-bordered w-full" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Order</span>
                        </label>
                        <input type="number" name="new_section_${sectionCounter}_order" 
                               value="${sectionCounter}" 
                               class="input input-bordered w-full" min="0" required>
                    </div>
                </div>
                
                <div class="form-control mt-4">
                    <label class="label">
                        <span class="label-text">Description</span>
                    </label>
                    <textarea name="new_section_${sectionCounter}_description" 
                              class="textarea textarea-bordered w-full" 
                              rows="2"></textarea>
                </div>
                
                <div class="mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-medium text-gray-700">Questions</h4>
                        <button type="button" class="btn btn-sm btn-outline" onclick="addQuestion(this)">
                            Add Question
                        </button>
                    </div>
                    
                    <div class="questions-container space-y-3">
                        <!-- Questions will be added here -->
                    </div>
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', sectionHtml);
}

function removeSection(button) {
    if (confirm('Are you sure you want to remove this section? All questions will be deleted.')) {
        button.closest('.section-card').remove();
    }
}

function addQuestion(button) {
    questionCounter++;
    const questionsContainer = button.closest('.card-body').querySelector('.questions-container');
    const questionHtml = `
        <div class="question-card card bg-white border border-gray-200" data-question-id="new_${questionCounter}">
            <div class="card-body p-4">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <span class="drag-handle text-xl">⋮⋮</span>
                        <span class="text-sm font-medium">New Question</span>
                    </div>
                    <button type="button" class="btn btn-xs btn-error" onclick="removeQuestion(this)">
                        Remove
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Question Type</span>
                        </label>
                        <select name="new_question_${questionCounter}_type" class="select select-bordered w-full" required>
                            <option value="LIKERT">Likert Scale</option>
                            <option value="MULTI">Multiple Choice</option>
                            <option value="SINGLE">Single Choice</option>
                            <option value="SHORT_TEXT">Short Text</option>
                            <option value="LONG_TEXT">Long Text</option>
                            <option value="NPS">Net Promoter Score</option>
                            <option value="NUMBER">Number</option>
                            <option value="DATE">Date</option>
                            <option value="RANK">Ranking</option>
                        </select>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Anonymity Mode</span>
                        </label>
                        <select name="new_question_${questionCounter}_anonymity" class="select select-bordered w-full" required>
                            <option value="ANONYMOUS">Anonymous</option>
                            <option value="ESCROW" selected>Private (Escrow)</option>
                            <option value="SIGNED">Signed</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-control mt-4">
                    <label class="label">
                        <span class="label-text">Question Prompt *</span>
                    </label>
                    <textarea name="new_question_${questionCounter}_prompt" 
                              class="textarea textarea-bordered w-full" 
                              rows="2" required placeholder="Enter your question here..."></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Order</span>
                        </label>
                        <input type="number" name="new_question_${questionCounter}_order" 
                               value="${questionCounter}" 
                               class="input input-bordered w-full" min="0" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Required</span>
                        </label>
                        <label class="label cursor-pointer">
                            <input type="checkbox" name="new_question_${questionCounter}_required" 
                                   class="checkbox checkbox-primary" checked>
                            <span class="label-text ml-2">Required</span>
                        </label>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Help Text</span>
                        </label>
                        <input type="text" name="new_question_${questionCounter}_help" 
                               class="input input-bordered w-full" placeholder="Optional help text">
                    </div>
                </div>
            </div>
        </div>
    `;
    questionsContainer.insertAdjacentHTML('beforeend', questionHtml);
}

function removeQuestion(button) {
    if (confirm('Are you sure you want to remove this question?')) {
        button.closest('.question-card').remove();
    }
}

// Initialize drag and drop functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add drag and drop for sections and questions
    // This would integrate with HTMX for server-side reordering
});
</script>
{% endblock %}

```

### surveys/templates/surveys/admin/survey_list.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">Survey Administration</h1>
            <p class="text-gray-600 mt-2">Create and manage company surveys</p>
        </div>
        <a href="{% url 'surveys:builder' %}" class="btn btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Create Survey
        </a>
    </div>

    {% if surveys %}
        <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Created By</th>
                        <th>Publish Dates</th>
                        <th>Responses</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for survey in surveys %}
                        <tr>
                            <td>
                                <div>
                                    <div class="font-semibold">{{ survey.title }}</div>
                                    {% if survey.description %}
                                        <div class="text-sm text-gray-500">{{ survey.description|truncatewords:10 }}</div>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if survey.status == 'DRAFT' %}
                                    <span class="badge badge-warning">Draft</span>
                                {% elif survey.status == 'PUBLISHED' %}
                                    {% if survey.is_active %}
                                        <span class="badge badge-success">Active</span>
                                    {% else %}
                                        <span class="badge badge-info">Published</span>
                                    {% endif %}
                                {% elif survey.status == 'CLOSED' %}
                                    <span class="badge badge-error">Closed</span>
                                {% else %}
                                    <span class="badge badge-neutral">Archived</span>
                                {% endif %}
                            </td>
                            <td>{{ survey.created_by.username }}</td>
                            <td>
                                <div class="text-sm">
                                    <div><strong>Start:</strong> {{ survey.publish_start|date:"M j, Y" }}</div>
                                    <div><strong>End:</strong> {{ survey.publish_end|date:"M j, Y" }}</div>
                                </div>
                            </td>
                            <td>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-primary">{{ survey.response_count }}</div>
                                    <div class="text-sm text-gray-500">responses</div>
                                </div>
                            </td>
                            <td>
                                <div class="flex flex-col gap-2">
                                    <a href="{% url 'surveys:survey_edit' survey.pk %}" 
                                       class="btn btn-sm btn-outline">
                                        Edit
                                    </a>
                                    
                                    <form method="post" action="{% url 'surveys:publish' survey.pk %}" 
                                          class="inline">
                                        {% csrf_token %}
                                        {% if survey.status == 'DRAFT' %}
                                            <button type="submit" name="action" value="publish" 
                                                    class="btn btn-sm btn-success">
                                                Publish
                                            </button>
                                        {% elif survey.status == 'PUBLISHED' %}
                                            <button type="submit" name="action" value="unpublish" 
                                                    class="btn btn-sm btn-warning">
                                                Unpublish
                                            </button>
                                            <button type="submit" name="action" value="close" 
                                                    class="btn btn-sm btn-error">
                                                Close
                                            </button>
                                        {% endif %}
                                    </form>
                                    
                                    <a href="{% url 'surveys:survey_invites' survey.pk %}" 
                                       class="btn btn-sm btn-outline btn-info">
                                        Invites
                                    </a>
                                    
                                    <a href="{% url 'surveys:survey_reports' survey.pk %}" 
                                       class="btn btn-sm btn-outline btn-secondary">
                                        Reports
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📊</div>
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">No Surveys Created Yet</h2>
            <p class="text-gray-600 mb-6">Get started by creating your first survey to collect feedback from your team.</p>
            <a href="{% url 'surveys:survey_create' %}" class="btn btn-primary btn-lg">
                Create Your First Survey
            </a>
        </div>
    {% endif %}
    
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-8">
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-primary">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Surveys</div>
            <div class="stat-value text-primary">{{ surveys.count }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-success">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Active Surveys</div>
            <div class="stat-value text-success">{{ surveys|length|add:"0" }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-info">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Responses</div>
            <div class="stat-value text-info">{{ surveys|length|add:"0" }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-warning">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Draft Surveys</div>
            <div class="stat-value text-warning">{{ surveys|length|add:"0" }}</div>
        </div>
    </div>
</div>
{% endblock %}

```

### surveys/templates/surveys/partials/privacy_explainer.html
```python
<div class="alert alert-info shadow mb-6">
  <div>
    <span class="font-semibold">Privacy & Anonymity</span>
    <div class="text-sm opacity-80 mt-2">
      <p class="mb-1"><span class="badge badge-warning mr-2">Anonymous</span> Never stores identity.</p>
      <p class="mb-1"><span class="badge badge-info mr-2">Private</span> Identity held privately (escrow); follow-up optional.</p>
      <p class="mb-1"><span class="badge badge-success mr-2">Signed</span> Name shown with answer.</p>
      <p class="mt-2">Reports hide small cohorts to protect privacy (k-anonymity threshold).</p>
      <p class="mt-1">We value candor and have a strict non-retaliation policy.</p>
    </div>
  </div>
</div>


```

### surveys/templates/surveys/reports/survey_reports.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Survey Reports: {{ survey.title }}</h1>
        <p class="text-gray-600 mt-2">Analyze responses and generate insights</p>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-primary">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Responses</div>
            <div class="stat-value text-primary">{{ total_responses }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-success">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
            </div>
            <div class="stat-title">Response Rate</div>
            <div class="stat-value text-success">{{ response_rate|floatformat:1 }}%</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-info">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Sections</div>
            <div class="stat-value text-info">{{ survey.sections.count }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-warning">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Questions</div>
            <div class="stat-value text-warning">{{ survey.sections.all|length }}</div>
        </div>
    </div>

    <!-- Report Generation Form -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Generate Report</h2>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Report Type</span>
                        </label>
                        <div class="space-y-2">
                            {% for choice in form.report_type.field.choices %}
                                <label class="flex items-center">
                                    <input type="radio" name="{{ form.report_type.name }}" 
                                           value="{{ choice.0 }}" 
                                           class="radio radio-primary"
                                           {% if choice.0 == form.report_type.value %}checked{% endif %}>
                                    <span class="ml-2">{{ choice.1 }}</span>
                                </label>
                            {% endfor %}
                        </div>
                        {% if form.report_type.errors %}
                            <div class="text-error text-sm mt-1">{{ form.report_type.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Export Format</span>
                        </label>
                        {{ form.export_format }}
                        {% if form.export_format.errors %}
                            <div class="text-error text-sm mt-1">{{ form.export_format.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Date Range (Optional)</span>
                        </label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="label">
                                    <span class="label-text text-sm">From</span>
                                </label>
                                {{ form.date_from }}
                            </div>
                            <div>
                                <label class="label">
                                    <span class="label-text text-sm">To</span>
                                </label>
                                {{ form.date_to }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Options</span>
                        </label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                {{ form.include_anonymous }}
                                <span class="ml-2 text-sm">{{ form.include_anonymous.label }}</span>
                            </label>
                        </div>
                        
                        <div class="mt-4">
                            <label class="label">
                                <span class="label-text text-sm">{{ form.min_cohort_size.help_text }}</span>
                            </label>
                            {{ form.min_cohort_size }}
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Generate Report
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Recent Responses -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Recent Responses</h2>
            
            {% if survey.responses.all %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>Respondent</th>
                                <th>Submitted</th>
                                <th>Answers</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for response in survey.responses.all|slice:":10" %}
                                <tr>
                                    <td>
                                        {% if response.identity_user %}
                                            <div class="flex items-center gap-3">
                                                <div class="avatar placeholder">
                                                    <div class="bg-neutral text-neutral-content rounded-full w-8">
                                                        <span class="text-xs">{{ response.identity_user.username|slice:":2"|upper }}</span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="font-medium">{{ response.identity_user.username }}</div>
                                                    <div class="text-sm text-gray-500">{{ response.identity_user.email }}</div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <span class="text-gray-500 italic">Anonymous</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ response.submitted_at|date:"M j, Y H:i" }}</td>
                                    <td>{{ response.answers.count }} answers</td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-outline">View Details</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if survey.responses.count > 10 %}
                    <div class="text-center mt-4">
                        <a href="#" class="btn btn-outline">View All {{ survey.responses.count }} Responses</a>
                    </div>
                {% endif %}
            {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">📝</div>
                    <p class="text-gray-600">No responses yet for this survey.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex justify-between items-center">
        <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline">
            ← Back to Surveys
        </a>
        
        <div class="flex gap-4">
            <a href="{% url 'surveys:survey_invites' survey.pk %}" class="btn btn-outline btn-info">
                Manage Invites
            </a>
            <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-outline btn-primary">
                Edit Survey
            </a>
        </div>
    </div>
</div>
{% endblock %}

```

