# Django Project Snapshot

## Project Structure
```
Django5Template/
  requirements.txt
  SETUP_MAC.md
  snap.py
  DASHBOARD_README.md
  manage.py
  core/
    asgi.py
    __init__.py
    settings.py
    urls.py
    wsgi.py
  images/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      images/
        image_list.html
        image_detail.html
        image_upload.html
        image_delete.html
  suno_prompt_builder/
    models.py
    __init__.py
    apps.py
    README.md
    suno_api_stub.py
    admin.py
    urls.py
    views.py
    management/
      __init__.py
      commands/
        __init__.py
        seed_prompts.py
    static/
      suno_prompt_builder/
        js/
          copy_prompt.js
    templates/
      suno_prompt_builder/
        prompt_builder.html
  subscriptions/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      subscriptions/
        subscription_list.html
        subscription_confirm_delete.html
        subscription_form.html
        subscription_detail.html
        subscription_dashboard.html
  search/
    models.py
    __init__.py
    apps.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      search/
        results.html
        partials/
          result_list.html
  theme/
    __init__.py
    apps.py
    static_src/
      tailwind.config.js
      postcss.config.js
      src/
        styles.css
        dashboard.css
    static/
      css/
        dist/
          styles.css
    templates/
      base.html
  prompts/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      prompts/
        prompt_list.html
        my_prompts.html
        tag_detail.html
        category_detail.html
        prompt_detail.html
        prompt_list_simple.html
        test.html
        collections.html
        collection_detail.html
  files/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    templates/
      files/
        file_detail.html
        file_upload.html
        file_delete.html
        file_list.html
  surveys/
    models.py
    __init__.py
    apps.py
    README.md
    forms.py
    context.py
    admin.py
    urls.py
    views.py
    tests/
      test_surveys_smoke.py
      __init__.py
      test_wiring.py
    management/
      __init__.py
      commands/
        seed_balanced_honesty.py
        __init__.py
    templates/
      surveys/
        response_complete.html
        survey_detail.html
        action_note.html
        survey_response.html
        results_index.html
        my_invites.html
        survey_list.html
        admin/
          survey_invites.html
          survey_form.html
          survey_list.html
        partials/
          privacy_explainer.html
        reports/
          survey_reports.html
  templates/
    base.html
    registration/
      login.html
  userprofile/
    models.py
    __init__.py
    apps.py
    forms.py
    admin.py
    tests.py
    urls.py
    views.py
    management/
      __init__.py
      commands/
        __init__.py
        create_user_profiles.py
    templates/
      userprofile/
        profile_edit.html
        profile_view.html
        profile_list.html
        password_change.html
  main/
    models.py
    __init__.py
    apps.py
    admin.py
    tests.py
    urls.py
    views.py
    management/
      __init__.py
      commands/
        populate_sample_data.py
        cleanup_test_data.py
        __init__.py
        create_dashboard_sample_data.py
        create_sample_data.py
        verify_search_links.py
    templates/
      main/
        home.html
        dashboard.html
```

## Project-Level Files
### manage.py
```python
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

```

### core/settings.py
```python
"""
Django settings for core project.

Generated by 'django-admin startproject' using Django 5.2.4.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-5b(t4uzirw5=or^lw1@o2o4f964+8#&4f!*^z(1!klewa_4s!x'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ["localhost", "127.0.0.1", "0.0.0.0", "192.168.3.147", "192.168.1.*", "192.168.0.*", "10.0.0.*"]


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.humanize',
    'tailwind',
    'theme',
    'main',
    'files',
    'images',
    'userprofile',
    'prompts',
    'suno_prompt_builder',
    'subscriptions',
    'search',  # Added
    'surveys',  # Added
]

# Temporarily disabled browser reload to debug process issues
# if DEBUG:
#     # Add django_browser_reload only in DEBUG mode
#     INSTALLED_APPS += ['django_browser_reload']

# NPM_BIN_PATH = r"C:\Program Files\nodejs\npm.cmd"  # Windows path
# For Mac/Linux, npm should be in PATH by default

# Added: Registers the theme app for Tailwind
TAILWIND_APP_NAME = 'theme'

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',  # Added for static file serving
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

# Temporarily disabled browser reload middleware to debug process issues
# if DEBUG:
#     # Add django_browser_reload middleware only in DEBUG mode
#     MIDDLEWARE += [
#         "django_browser_reload.middleware.BrowserReloadMiddleware",
#     ]

ROOT_URLCONF = 'core.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        # Added project-level templates directory for global templates (e.g., base.html)
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'surveys.context.surveys_context',
            ],
        },
    },
]

WSGI_APPLICATION = 'core.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Added: Serve Tailwind CSS and other static assets from theme/static during development
STATICFILES_DIRS = [
    BASE_DIR / 'theme' / 'static',
]

# Added: Directory where collectstatic will gather static files for production
STATIC_ROOT = BASE_DIR / 'staticfiles'

# Added: WhiteNoise storage for compressed static files
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'

# Media files (user uploaded files)
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# Added: Authentication redirects for login/logout flows
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/login/'
LOGIN_URL = '/login/'

# Email backend for development: prints emails to the console.
# Use an SMTP backend in production for real email delivery.
EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

# Feature flags
SURVEYS_ENABLED = True

```

### core/urls.py
```python
from django.contrib import admin
from django.urls import path, include
from django.contrib.auth import views as auth_views
from django.conf import settings
from main.views import register, home

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', home, name='home'),
    # File and Image management
    path('files/', include('files.urls')),
    path('images/', include('images.urls')),
    # User Profile management
    path('profile/', include('userprofile.urls')),
    # Prompt management
    path('prompts/', include('prompts.urls')),
    # Suno Prompt Builder
    path('suno-prompt-builder/', include('suno_prompt_builder.urls')),
    # Subscription management
    path('subscriptions/', include('subscriptions.urls')),
    # Search functionality
    path('search/', include('search.urls')),
    # Surveys functionality
    path('surveys/', include(('surveys.urls', 'surveys'), namespace='surveys')),
    # Registration page
    path('register/', register, name='register'),  # User registration
    # Login page using Django's built-in view
    path('login/', auth_views.LoginView.as_view(template_name='registration/login.html'), name='login'),  # User login
    # Logout page using Django's built-in view
    path('logout/', auth_views.LogoutView.as_view(template_name='registration/logged_out.html'), name='logout'),  # User logout
    # Password reset views
    path('password-reset/', auth_views.PasswordResetView.as_view(template_name='registration/password_reset_form.html'), name='password_reset'),  # Request password reset
    path('password-reset/done/', auth_views.PasswordResetDoneView.as_view(template_name='registration/password_reset_done.html'), name='password_reset_done'),  # Password reset email sent
    path('password-reset/confirm/<uidb64>/<token>/', auth_views.PasswordResetConfirmView.as_view(template_name='registration/password_reset_confirm.html'), name='password_reset_confirm'),  # Password reset link
    path('password-reset/complete/', auth_views.PasswordResetCompleteView.as_view(template_name='registration/password_reset_complete.html'), name='password_reset_complete'),  # Password reset complete
]

# Static and Media files
from django.conf.urls.static import static
from django.views.static import serve

# Serve static files from STATIC_ROOT (production-ready)
urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)

# Media files (for development)
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

```

### core/wsgi.py
```python
"""
WSGI config for core project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')

application = get_wsgi_application()

```

### core/asgi.py
```python
"""
ASGI config for core project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')

application = get_asgi_application()

```

### requirements.txt
```python
asgiref
Django
django-tailwind
python-dotenv
sqlparse
tzdata
Pillow
requests
whitenoise
qrcode[pil]
```

## Apps
### App: images
### images/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.urls import reverse
from PIL import Image as PILImage
import os

class Image(models.Model):
    title = models.CharField(max_length=255)
    description = models.TextField(blank=True, null=True)
    image = models.ImageField(upload_to='images/')
    thumbnail = models.ImageField(upload_to='images/thumbnails/', blank=True, null=True)
    uploaded_by = models.ForeignKey(User, on_delete=models.CASCADE)
    uploaded_at = models.DateTimeField(auto_now_add=True)
    file_size = models.BigIntegerField(blank=True, null=True)
    width = models.IntegerField(blank=True, null=True)
    height = models.IntegerField(blank=True, null=True)

    def __str__(self):
        return self.title

    def get_absolute_url(self):
        return reverse('images:image_detail', kwargs={'image_id': self.pk})

    def save(self, *args, **kwargs):
        # Save first to ensure the file is written to disk
        super().save(*args, **kwargs)

        # Calculate file size and dimensions after saving
        if self.image:
            self.file_size = self.image.size

            # Open image to get dimensions
            with PILImage.open(self.image.path) as img:
                self.width = img.width
                self.height = img.height

                # Create thumbnail if it doesn't exist
                if not self.thumbnail:
                    self.create_thumbnail()

                # Save again to update the dimensions and thumbnail
                super().save(update_fields=['width', 'height', 'thumbnail'])

    def create_thumbnail(self):
        """Create a thumbnail version of the image"""
        if self.image:
            with PILImage.open(self.image.path) as img:
                # Convert to RGB if necessary
                if img.mode != 'RGB':
                    img = img.convert('RGB')

                # Create thumbnail (max 200x200)
                img.thumbnail((200, 200), PILImage.Resampling.LANCZOS)

                # Save thumbnail
                thumb_filename = f'thumb_{os.path.basename(self.image.name)}'
                thumb_path = f'images/thumbnails/{thumb_filename}'

                # Use Django's storage to save the thumbnail
                from django.core.files.base import ContentFile
                import io

                # Save image to bytes
                buffer = io.BytesIO()
                img.save(buffer, format='JPEG', quality=85)
                buffer.seek(0)

                # Save to Django storage
                self.thumbnail.save(thumb_filename, ContentFile(buffer.getvalue()), save=False)

    def filename(self):
        return os.path.basename(self.image.name)

    def file_extension(self):
        name, extension = os.path.splitext(self.image.name)
        return extension.lower()

    def aspect_ratio(self):
        if self.width and self.height:
            return self.width / self.height
        return None

```

### images/views.py
```python
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from .models import Image
from .forms import ImageUploadForm

@login_required
def image_list(request):
    """Display list of uploaded images"""
    images = Image.objects.filter(uploaded_by=request.user).order_by('-uploaded_at')
    return render(request, 'images/image_list.html', {'images': images})

@login_required
def image_upload(request):
    """Handle image upload"""
    if request.method == 'POST':
        form = ImageUploadForm(request.POST, request.FILES)
        if form.is_valid():
            image_obj = form.save(commit=False)
            image_obj.uploaded_by = request.user
            image_obj.save()
            messages.success(request, f'Image "{image_obj.title}" uploaded successfully!')
            return redirect('images:image_list')
    else:
        form = ImageUploadForm()

    return render(request, 'images/image_upload.html', {'form': form})

@login_required
def image_detail(request, image_id):
    """Display image details"""
    image_obj = get_object_or_404(Image, id=image_id, uploaded_by=request.user)
    return render(request, 'images/image_detail.html', {'image': image_obj})

@login_required
def image_delete(request, image_id):
    """Delete an image"""
    image_obj = get_object_or_404(Image, id=image_id, uploaded_by=request.user)

    if request.method == 'POST':
        title = image_obj.title
        image_obj.delete()
        messages.success(request, f'Image "{title}" deleted successfully!')
        return redirect('images:image_list')

    return render(request, 'images/image_delete.html', {'image': image_obj})

# Keep the original view for backward compatibility
def images(request):
    return render(request, 'images/images.html')

```

### images/urls.py
```python
from django.urls import path
from . import views

app_name = 'images'

urlpatterns = [
    path('', views.image_list, name='image_list'),
    path('upload/', views.image_upload, name='image_upload'),
    path('<int:image_id>/', views.image_detail, name='image_detail'),
    path('<int:image_id>/delete/', views.image_delete, name='image_delete'),
]

```

### images/forms.py
```python
from django import forms
from .models import Image

class ImageUploadForm(forms.ModelForm):
    class Meta:
        model = Image
        fields = ['title', 'description', 'image']
        widgets = {
            'title': forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
            'description': forms.Textarea(attrs={'class': 'textarea textarea-bordered w-full', 'rows': 3}),
            'image': forms.FileInput(attrs={'class': 'file-input file-input-bordered w-full'}),
        }
    
    def clean_image(self):
        image = self.cleaned_data.get('image')
        if image:
            # Check file size (max 10MB for images)
            if image.size > 10 * 1024 * 1024:
                raise forms.ValidationError("Image size must be under 10MB.")
            
            # Check file extension
            allowed_extensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp']
            
            import os
            ext = os.path.splitext(image.name)[1].lower()
            if ext not in allowed_extensions:
                raise forms.ValidationError(f"Image type {ext} is not allowed. Use: {', '.join(allowed_extensions)}")
        
        return image 
```

### images/admin.py
```python
from django.contrib import admin
from .models import Image

@admin.register(Image)
class ImageAdmin(admin.ModelAdmin):
    list_display = ('title', 'uploaded_by', 'uploaded_at', 'file_size', 'width', 'height')
    list_filter = ('uploaded_at', 'uploaded_by')
    search_fields = ('title', 'description', 'uploaded_by__username')
    readonly_fields = ('uploaded_at', 'file_size', 'width', 'height', 'thumbnail')
    date_hierarchy = 'uploaded_at'

```

### images/apps.py
```python
from django.apps import AppConfig


class ImagesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'images'

```

### images/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in images
### images/templates/images/image_list.html
```python
{% extends "base.html" %}

{% block title %}Images - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-base-content">Image Gallery</h1>
            <p class="text-base-content/70 mt-2">Upload and manage your images</p>
        </div>
        <a href="{% url 'images:image_upload' %}" class="btn btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Upload Image
        </a>
    </div>

    {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}error{% else %}success{% endif %} mb-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        {% if message.tags == 'error' %}
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        {% else %}
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        {% endif %}
                    </svg>
                    <span>{{ message }}</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% if images %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for image in images %}
                <div class="card bg-base-100 shadow-xl">
                    <figure class="px-4 pt-4">
                        {% if image.thumbnail %}
                            <img src="{{ image.thumbnail.url }}" alt="{{ image.title }}" class="rounded-xl w-full h-48 object-cover">
                        {% else %}
                            <img src="{{ image.image.url }}" alt="{{ image.title }}" class="rounded-xl w-full h-48 object-cover">
                        {% endif %}
                    </figure>
                    <div class="card-body">
                        <h2 class="card-title text-lg">{{ image.title }}</h2>
                        {% if image.description %}
                            <p class="text-sm text-base-content/80">{{ image.description|truncatewords:15 }}</p>
                        {% endif %}
                        
                        <div class="text-xs text-base-content/60 mb-4">
                            <div class="flex justify-between">
                                <span>Size: {{ image.file_size|filesizeformat }}</span>
                                <span>{{ image.width }}×{{ image.height }}</span>
                            </div>
                            <div class="flex justify-between mt-1">
                                <span>By: {{ image.uploaded_by.username }}</span>
                                <span>{{ image.uploaded_at|date:"M d, Y" }}</span>
                            </div>
                        </div>
                        
                        <div class="card-actions justify-end">
                            <a href="{% url 'images:image_detail' image.id %}" class="btn btn-sm btn-outline">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                View
                            </a>
                            {% if user == image.uploaded_by or user.is_staff %}
                                <a href="{% url 'images:image_delete' image.id %}" class="btn btn-sm btn-error">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Delete
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="avatar placeholder mb-4">
                <div class="bg-neutral text-neutral-content rounded-full w-24">
                    <span class="text-4xl">🖼️</span>
                </div>
            </div>
            <h3 class="text-xl font-semibold mb-2">No images uploaded yet</h3>
            <p class="text-base-content/70 mb-6">Start by uploading your first image</p>
            <a href="{% url 'images:image_upload' %}" class="btn btn-primary">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                Upload Your First Image
            </a>
        </div>
    {% endif %}
</div>
{% endblock %} 
```

### images/templates/images/image_detail.html
```python
{% extends "base.html" %}

{% block title %}{{ image.title }} - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'images:image_list' %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to Gallery
                </a>
                <h1 class="text-3xl font-bold text-base-content">{{ image.title }}</h1>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Image Display -->
            <div class="lg:col-span-2">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">Image Preview</h2>
                        
                        <div class="flex items-center justify-center p-4 bg-base-200 rounded-lg">
                            <img src="{{ image.image.url }}" alt="{{ image.title }}" class="max-w-full h-auto rounded-lg shadow-lg">
                        </div>
                        
                        <div class="flex flex-wrap gap-4 mt-6">
                            <a href="{{ image.image.url }}" target="_blank" class="btn btn-primary">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                View Full Size
                            </a>
                            
                            <a href="{{ image.image.url }}" download class="btn btn-secondary">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                Download Image
                            </a>
                            
                            {% if user == image.uploaded_by or user.is_staff %}
                                <a href="{% url 'images:image_delete' image.id %}" class="btn btn-error">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Delete Image
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Image Information -->
            <div class="lg:col-span-1">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">Image Information</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Title</span>
                                </label>
                                <p class="text-base-content">{{ image.title }}</p>
                            </div>
                            
                            {% if image.description %}
                                <div>
                                    <label class="label">
                                        <span class="label-text font-semibold">Description</span>
                                    </label>
                                    <p class="text-base-content">{{ image.description }}</p>
                                </div>
                            {% endif %}
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Filename</span>
                                </label>
                                <p class="text-base-content font-mono text-sm">{{ image.filename }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">File Type</span>
                                </label>
                                <p class="text-base-content">{{ image.file_extension|upper }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Dimensions</span>
                                </label>
                                <p class="text-base-content">{{ image.width }} × {{ image.height }} pixels</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Aspect Ratio</span>
                                </label>
                                <p class="text-base-content">{{ image.aspect_ratio|floatformat:2 }}:1</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">File Size</span>
                                </label>
                                <p class="text-base-content">{{ image.file_size|filesizeformat }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Uploaded By</span>
                                </label>
                                <p class="text-base-content">{{ image.uploaded_by.username }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Upload Date</span>
                                </label>
                                <p class="text-base-content">{{ image.uploaded_at|date:"F d, Y \a\t g:i A" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Thumbnail Preview -->
                {% if image.thumbnail %}
                    <div class="card bg-base-100 shadow-xl mt-6">
                        <div class="card-body">
                            <h2 class="card-title text-xl mb-4">Thumbnail</h2>
                            <img src="{{ image.thumbnail.url }}" alt="{{ image.title }} thumbnail" class="w-full h-auto rounded-lg">
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### images/templates/images/image_upload.html
```python
{% extends "base.html" %}

{% block title %}Upload Image - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-base-content">Upload Image</h1>
            <p class="text-base-content/70 mt-2">Upload a new image to your gallery</p>
        </div>

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                        <div class="alert alert-error mb-6">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>Please correct the errors below.</span>
                        </div>
                    {% endif %}

                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">Image Title *</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.title.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">Description</span>
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.description.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">Select Image *</span>
                        </label>
                        {{ form.image }}
                        {% if form.image.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.image.errors.0 }}</span>
                            </label>
                        {% endif %}
                        <label class="label">
                            <span class="label-text-alt text-base-content/60">
                                Maximum file size: 10MB. Allowed types: JPG, JPEG, PNG, GIF, BMP, WEBP
                            </span>
                        </label>
                    </div>

                    <div class="card-actions justify-end">
                        <a href="{% url 'images:image_list' %}" class="btn btn-outline">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            Upload Image
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### images/templates/images/image_delete.html
```python
{% extends "base.html" %}

{% block title %}Delete Image - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'images:image_detail' image.id %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to Image
                </a>
                <h1 class="text-3xl font-bold text-error">Delete Image</h1>
            </div>
        </div>

        <div class="card bg-base-100 shadow-xl border-l-4 border-error">
            <div class="card-body">
                <div class="flex items-center mb-6">
                    <div class="avatar placeholder mr-4">
                        <div class="bg-error text-error-content rounded-full w-16">
                            <span class="text-2xl">⚠️</span>
                        </div>
                    </div>
                    <div>
                        <h2 class="card-title text-xl text-error">Confirm Deletion</h2>
                        <p class="text-base-content/70">This action cannot be undone.</p>
                    </div>
                </div>

                <div class="alert alert-warning mb-6">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                    <span>Are you sure you want to delete "{{ image.title }}"?</span>
                </div>

                <!-- Image Preview -->
                <div class="flex justify-center mb-6">
                    {% if image.thumbnail %}
                        <img src="{{ image.thumbnail.url }}" alt="{{ image.title }}" class="max-w-xs h-auto rounded-lg shadow-lg">
                    {% else %}
                        <img src="{{ image.image.url }}" alt="{{ image.title }}" class="max-w-xs h-auto rounded-lg shadow-lg">
                    {% endif %}
                </div>

                <div class="bg-base-200 p-4 rounded-lg mb-6">
                    <h3 class="font-semibold mb-2">Image Details:</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="font-medium">Title:</span>
                            <p>{{ image.title }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Filename:</span>
                            <p class="font-mono">{{ image.filename }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Size:</span>
                            <p>{{ image.file_size|filesizeformat }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Dimensions:</span>
                            <p>{{ image.width }} × {{ image.height }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Uploaded:</span>
                            <p>{{ image.uploaded_at|date:"M d, Y" }}</p>
                        </div>
                        <div>
                            <span class="font-medium">By:</span>
                            <p>{{ image.uploaded_by.username }}</p>
                        </div>
                    </div>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="card-actions justify-end">
                        <a href="{% url 'images:image_detail' image.id %}" class="btn btn-outline">Cancel</a>
                        <button type="submit" class="btn btn-error">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            Delete Image
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### App: suno_prompt_builder
### suno_prompt_builder/models.py
```python
from django.db import models


class SongPrompt(models.Model):
    title = models.CharField(max_length=200, blank=True)
    lyrics = models.TextField(blank=True)
    subject = models.CharField(max_length=300, blank=True)
    styles = models.JSONField(default=list, help_text="List of styles, e.g., ['disco', 'rap', 'cinematic']")
    excluded_styles = models.JSONField(default=list, blank=True)
    weirdness = models.PositiveSmallIntegerField(default=50, help_text="0–100")
    style_influence = models.PositiveSmallIntegerField(default=50, help_text="0–100")
    is_instrumental = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def formatted_prompt(self):
        return {
            "title": self.title,
            "lyrics": self.lyrics or self.subject,
            "styles": self.styles,
            "excluded_styles": self.excluded_styles,
            "weirdness": self.weirdness,
            "style_influence": self.style_influence,
            "instrumental": self.is_instrumental
        }

    def __str__(self):
        return self.title or f"Untitled ({self.id})"

    class Meta:
        ordering = ['-created_at']
```

### suno_prompt_builder/views.py
```python
from django.shortcuts import render, redirect
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
from django.views.decorators.http import require_http_methods
import json
from .models import SongPrompt


def prompt_builder(request):
    """Main view for the song prompt builder interface."""
    return render(request, 'suno_prompt_builder/prompt_builder.html')


@csrf_exempt
@require_http_methods(["POST"])
def save_prompt(request):
    """Save a new song prompt."""
    try:
        data = json.loads(request.body)
        
        # Convert comma-separated strings to lists for styles
        styles = [style.strip() for style in data.get('styles', '').split(',') if style.strip()]
        excluded_styles = [style.strip() for style in data.get('excluded_styles', '').split(',') if style.strip()]
        
        prompt = SongPrompt.objects.create(
            title=data.get('title', ''),
            lyrics=data.get('lyrics', ''),
            subject=data.get('subject', ''),
            styles=styles,
            excluded_styles=excluded_styles,
            weirdness=int(data.get('weirdness', 50)),
            style_influence=int(data.get('style_influence', 50)),
            is_instrumental=data.get('is_instrumental', False)
        )
        
        return JsonResponse({
            'success': True,
            'id': prompt.id,
            'formatted_prompt': prompt.formatted_prompt()
        })
    except Exception as e:
        return JsonResponse({
            'success': False,
            'error': str(e)
        }, status=400)


def get_prompts(request):
    """Get all saved prompts."""
    prompts = SongPrompt.objects.all()
    return JsonResponse({
        'prompts': [prompt.formatted_prompt() for prompt in prompts]
    })
```

### suno_prompt_builder/urls.py
```python
from django.urls import path
from . import views

app_name = 'suno_prompt_builder'

urlpatterns = [
    path('', views.prompt_builder, name='prompt_builder'),
    path('save/', views.save_prompt, name='save_prompt'),
    path('prompts/', views.get_prompts, name='get_prompts'),
]
```

### suno_prompt_builder/admin.py
```python
from django.contrib import admin
from .models import SongPrompt


@admin.register(SongPrompt)
class SongPromptAdmin(admin.ModelAdmin):
    list_display = ['title', 'subject', 'weirdness', 'style_influence', 'is_instrumental', 'created_at']
    list_filter = ['is_instrumental', 'created_at', 'updated_at']
    search_fields = ['title', 'subject', 'lyrics']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('title', 'subject', 'lyrics')
        }),
        ('Style Configuration', {
            'fields': ('styles', 'excluded_styles', 'weirdness', 'style_influence')
        }),
        ('Options', {
            'fields': ('is_instrumental',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def get_queryset(self, request):
        return super().get_queryset(request).order_by('-created_at')
```

### suno_prompt_builder/apps.py
```python
from django.apps import AppConfig


class SunoPromptBuilderConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'suno_prompt_builder'
    verbose_name = 'Suno Prompt Builder'
```

#### Templates in suno_prompt_builder
### suno_prompt_builder/templates/suno_prompt_builder/prompt_builder.html
```python
{% extends "base.html" %}
{% load static %}

{% block title %}Suno Prompt Builder{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-primary mb-2">🎵 Suno Prompt Builder</h1>
            <p class="text-lg text-base-content/70">Create and manage song prompts for Suno AI</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Form Section -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-2xl mb-6">📝 Create New Prompt</h2>
                    
                    <form id="prompt-form" class="space-y-6">
                        {% csrf_token %}
                        
                        <!-- Title -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">🎤 Title</span>
                            </label>
                            <input type="text" name="title" placeholder="Enter song title..." 
                                   class="input input-bordered w-full" />
                        </div>

                        <!-- Subject -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">📝 Subject</span>
                            </label>
                            <input type="text" name="subject" placeholder="Describe the song concept..." 
                                   class="input input-bordered w-full" />
                        </div>

                        <!-- Lyrics -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">📝 Lyrics (Optional)</span>
                            </label>
                            <textarea name="lyrics" placeholder="Enter lyrics or leave blank to use subject..." 
                                      class="textarea textarea-bordered h-24"></textarea>
                        </div>

                        <!-- Styles -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">🎧 Styles (comma-separated)</span>
                            </label>
                            <input type="text" name="styles" placeholder="disco, rap, cinematic, electronic..." 
                                   class="input input-bordered w-full" />
                            <label class="label">
                                <span class="label-text-alt">Example: disco, funk, electronic</span>
                            </label>
                        </div>

                        <!-- Excluded Styles -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">❌ Styles to Exclude</span>
                            </label>
                            <input type="text" name="excluded_styles" placeholder="heavy metal, country..." 
                                   class="input input-bordered w-full" />
                        </div>

                        <!-- Weirdness Slider -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">🎚 Weirdness: <span id="weirdness-value">50</span></span>
                            </label>
                            <input type="range" name="weirdness" min="0" max="100" value="50" 
                                   class="range range-primary" id="weirdness-slider" />
                            <div class="w-full flex justify-between text-xs px-2 mt-1">
                                <span>Normal</span>
                                <span>Weird</span>
                            </div>
                        </div>

                        <!-- Style Influence Slider -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">🎚 Style Influence: <span id="style-influence-value">50</span></span>
                            </label>
                            <input type="range" name="style_influence" min="0" max="100" value="50" 
                                   class="range range-secondary" id="style-influence-slider" />
                            <div class="w-full flex justify-between text-xs px-2 mt-1">
                                <span>Low</span>
                                <span>High</span>
                            </div>
                        </div>

                        <!-- Instrumental Toggle -->
                        <div class="form-control">
                            <label class="label cursor-pointer">
                                <span class="label-text font-semibold">🎵 Instrumental</span>
                                <input type="checkbox" name="is_instrumental" class="toggle toggle-primary" />
                            </label>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-4 pt-4">
                            <button type="button" id="save-button" class="btn btn-primary flex-1">
                                💾 Save Prompt
                            </button>
                            <button type="button" id="copy-button" class="btn btn-outline">
                                📋 Copy JSON
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- JSON Preview Section -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-2xl mb-6">👀 JSON Preview</h2>
                    <div class="bg-base-200 rounded-lg p-4">
                        <pre id="json-preview" class="text-sm overflow-auto max-h-96 whitespace-pre-wrap"></pre>
                    </div>
                    <div class="mt-4 text-sm text-base-content/70">
                        <p>💡 This preview updates in real-time as you fill out the form above.</p>
                        <p>📋 Use the "Copy JSON" button to copy the formatted prompt to your clipboard.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Prompts Section -->
        <div class="mt-12">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-2xl mb-6">💾 Saved Prompts</h2>
                    <div id="saved-prompts" class="space-y-4">
                        <!-- Prompts will be loaded here via JavaScript -->
                        <div class="text-center text-base-content/70">
                            <p>No saved prompts yet. Create your first prompt above!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slider value update scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const weirdnessSlider = document.getElementById('weirdness-slider');
    const weirdnessValue = document.getElementById('weirdness-value');
    const styleInfluenceSlider = document.getElementById('style-influence-slider');
    const styleInfluenceValue = document.getElementById('style-influence-value');

    weirdnessSlider.addEventListener('input', function() {
        weirdnessValue.textContent = this.value;
    });

    styleInfluenceSlider.addEventListener('input', function() {
        styleInfluenceValue.textContent = this.value;
    });
});
</script>

<!-- Load our custom JavaScript -->
<script src="{% static 'suno_prompt_builder/js/copy_prompt.js' %}"></script>
{% endblock %}
```

#### Static Files in suno_prompt_builder
### suno_prompt_builder/static/suno_prompt_builder/js/copy_prompt.js
```python
// Copy prompt functionality and live JSON preview
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('prompt-form');
    const jsonPreview = document.getElementById('json-preview');
    const copyButton = document.getElementById('copy-button');
    
    // Live JSON preview update
    function updateJsonPreview() {
        const formData = new FormData(form);
        const promptData = {
            title: formData.get('title') || '',
            lyrics: formData.get('lyrics') || formData.get('subject') || '',
            styles: formData.get('styles') ? formData.get('styles').split(',').map(s => s.trim()).filter(s => s) : [],
            excluded_styles: formData.get('excluded_styles') ? formData.get('excluded_styles').split(',').map(s => s.trim()).filter(s => s) : [],
            weirdness: parseInt(formData.get('weirdness') || 50),
            style_influence: parseInt(formData.get('style_influence') || 50),
            instrumental: formData.get('is_instrumental') === 'on'
        };
        
        jsonPreview.textContent = JSON.stringify(promptData, null, 2);
    }
    
    // Add event listeners for live updates
    form.addEventListener('input', updateJsonPreview);
    form.addEventListener('change', updateJsonPreview);
    
    // Copy to clipboard functionality
    copyButton.addEventListener('click', async function() {
        try {
            const jsonText = jsonPreview.textContent;
            await navigator.clipboard.writeText(jsonText);
            
            // Show success feedback
            const originalText = copyButton.textContent;
            copyButton.textContent = 'Copied!';
            copyButton.classList.add('btn-success');
            copyButton.classList.remove('btn-primary');
            
            setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.classList.remove('btn-success');
                copyButton.classList.add('btn-primary');
            }, 2000);
            
        } catch (err) {
            console.error('Failed to copy: ', err);
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = jsonPreview.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // Show success feedback
            const originalText = copyButton.textContent;
            copyButton.textContent = 'Copied!';
            copyButton.classList.add('btn-success');
            copyButton.classList.remove('btn-primary');
            
            setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.classList.remove('btn-success');
                copyButton.classList.add('btn-primary');
            }, 2000);
        }
    });
    
    // Save prompt functionality
    const saveButton = document.getElementById('save-button');
    saveButton.addEventListener('click', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        const data = {
            title: formData.get('title') || '',
            lyrics: formData.get('lyrics') || '',
            subject: formData.get('subject') || '',
            styles: formData.get('styles') || '',
            excluded_styles: formData.get('excluded_styles') || '',
            weirdness: formData.get('weirdness') || 50,
            style_influence: formData.get('style_influence') || 50,
            is_instrumental: formData.get('is_instrumental') === 'on'
        };
        
        try {
            const response = await fetch('/suno-prompt-builder/save/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Show success message
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success mt-4';
                alertDiv.textContent = 'Prompt saved successfully!';
                form.parentNode.insertBefore(alertDiv, form.nextSibling);
                
                // Clear form
                form.reset();
                updateJsonPreview();
                
                // Remove alert after 3 seconds
                setTimeout(() => {
                    alertDiv.remove();
                }, 3000);
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            console.error('Error saving prompt:', error);
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-error mt-4';
            alertDiv.textContent = 'Error saving prompt: ' + error.message;
            form.parentNode.insertBefore(alertDiv, form.nextSibling);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    });
    
    // Initialize JSON preview
    updateJsonPreview();
});
```

### App: subscriptions
### subscriptions/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.urls import reverse

class Subscription(models.Model):
    BILLING_CYCLE_CHOICES = [
        ('weekly', 'Weekly'),
        ('monthly', 'Monthly'),
        ('yearly', 'Yearly'),
    ]

    user = models.ForeignKey(User, on_delete=models.CASCADE)
    name = models.CharField(max_length=100)
    provider = models.CharField(max_length=100, blank=True, null=True)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    billing_cycle = models.CharField(max_length=10, choices=BILLING_CYCLE_CHOICES, default='monthly')
    start_date = models.DateField()
    next_due_date = models.DateField()
    notes = models.TextField(blank=True, null=True)
    is_active = models.BooleanField(default=True)
    is_api_enabled = models.BooleanField(default=False)

    # API fields
    api_base_url = models.URLField(blank=True, null=True)
    api_key = models.CharField(max_length=255, blank=True, null=True)
    api_token = models.TextField(blank=True, null=True)

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return f"{self.name} (${self.amount})"

    def get_absolute_url(self):
        return reverse('subscriptions:subscription_detail', kwargs={'pk': self.pk})

    class Meta:
        ordering = ['-created_at']

```

### subscriptions/views.py
```python
from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from django.urls import reverse_lazy
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.db.models import Sum
from .models import Subscription
from .forms import SubscriptionForm

class SubscriptionListView(LoginRequiredMixin, ListView):
    model = Subscription
    template_name = 'subscriptions/subscription_list.html'
    context_object_name = 'subscriptions'

    def get_queryset(self):
        return Subscription.objects.filter(user=self.request.user)

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        subscriptions = context['subscriptions']

        # Calculate totals
        context['total_monthly'] = subscriptions.filter(is_active=True).aggregate(
            total=Sum('amount')
        )['total'] or 0

        context['active_count'] = subscriptions.filter(is_active=True).count()
        context['api_enabled_count'] = subscriptions.filter(is_active=True, is_api_enabled=True).count()

        return context

class SubscriptionDetailView(LoginRequiredMixin, UserPassesTestMixin, DetailView):
    model = Subscription
    template_name = 'subscriptions/subscription_detail.html'
    context_object_name = 'subscription'

    def test_func(self):
        subscription = self.get_object()
        return subscription.user == self.request.user

class SubscriptionCreateView(LoginRequiredMixin, CreateView):
    model = Subscription
    form_class = SubscriptionForm
    template_name = 'subscriptions/subscription_form.html'
    success_url = reverse_lazy('subscriptions:subscription_list')

    def form_valid(self, form):
        form.instance.user = self.request.user
        messages.success(self.request, 'Subscription created successfully!')
        return super().form_valid(form)

class SubscriptionUpdateView(LoginRequiredMixin, UserPassesTestMixin, UpdateView):
    model = Subscription
    form_class = SubscriptionForm
    template_name = 'subscriptions/subscription_form.html'
    success_url = reverse_lazy('subscriptions:subscription_list')

    def test_func(self):
        subscription = self.get_object()
        return subscription.user == self.request.user

    def form_valid(self, form):
        messages.success(self.request, 'Subscription updated successfully!')
        return super().form_valid(form)

class SubscriptionDeleteView(LoginRequiredMixin, UserPassesTestMixin, DeleteView):
    model = Subscription
    template_name = 'subscriptions/subscription_confirm_delete.html'
    success_url = reverse_lazy('subscriptions:subscription_list')

    def test_func(self):
        subscription = self.get_object()
        return subscription.user == self.request.user

    def delete(self, request, *args, **kwargs):
        messages.success(request, 'Subscription deleted successfully!')
        return super().delete(request, *args, **kwargs)

@login_required
def subscription_dashboard(request):
    """Dashboard view showing subscription statistics"""
    subscriptions = Subscription.objects.filter(user=request.user)

    context = {
        'total_subscriptions': subscriptions.count(),
        'active_subscriptions': subscriptions.filter(is_active=True).count(),
        'api_enabled_subscriptions': subscriptions.filter(is_active=True, is_api_enabled=True).count(),
        'total_monthly_cost': subscriptions.filter(is_active=True).aggregate(
            total=Sum('amount')
        )['total'] or 0,
        'recent_subscriptions': subscriptions.order_by('-created_at')[:5],
        'upcoming_renewals': subscriptions.filter(
            is_active=True
        ).order_by('next_due_date')[:5],
    }

    return render(request, 'subscriptions/subscription_dashboard.html', context)

```

### subscriptions/urls.py
```python
from django.urls import path
from . import views

app_name = 'subscriptions'

urlpatterns = [
    path('', views.SubscriptionListView.as_view(), name='subscription_list'),
    path('dashboard/', views.subscription_dashboard, name='subscription_dashboard'),
    path('create/', views.SubscriptionCreateView.as_view(), name='subscription_create'),
    path('<int:pk>/', views.SubscriptionDetailView.as_view(), name='subscription_detail'),
    path('<int:pk>/update/', views.SubscriptionUpdateView.as_view(), name='subscription_update'),
    path('<int:pk>/delete/', views.SubscriptionDeleteView.as_view(), name='subscription_delete'),
]
```

### subscriptions/forms.py
```python
from django import forms
from .models import Subscription

class SubscriptionForm(forms.ModelForm):
    class Meta:
        model = Subscription
        fields = [
            'name', 'provider', 'amount', 'billing_cycle', 'start_date', 'next_due_date',
            'notes', 'is_active', 'is_api_enabled', 'api_base_url', 'api_key', 'api_token'
        ]
        widgets = {
            'notes': forms.Textarea(attrs={'rows': 3, 'class': 'textarea textarea-bordered w-full'}),
            'api_token': forms.Textarea(attrs={'rows': 2, 'class': 'textarea textarea-bordered w-full'}),
            'start_date': forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
            'next_due_date': forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
            'name': forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
            'provider': forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
            'amount': forms.NumberInput(attrs={'class': 'input input-bordered w-full', 'step': '0.01'}),
            'billing_cycle': forms.Select(attrs={'class': 'select select-bordered w-full'}),
            'api_base_url': forms.URLInput(attrs={'class': 'input input-bordered w-full'}),
            'api_key': forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
        }
```

### subscriptions/admin.py
```python
from django.contrib import admin
from .models import Subscription

@admin.register(Subscription)
class SubscriptionAdmin(admin.ModelAdmin):
    list_display = ('name', 'user', 'amount', 'billing_cycle', 'is_api_enabled', 'next_due_date', 'is_active')
    list_filter = ('billing_cycle', 'is_active', 'is_api_enabled')
    search_fields = ('name', 'provider', 'user__username')
    readonly_fields = ('created_at', 'updated_at')
    fieldsets = (
        ('Basic Information', {
            'fields': ('user', 'name', 'provider', 'amount', 'billing_cycle')
        }),
        ('Dates', {
            'fields': ('start_date', 'next_due_date')
        }),
        ('Status', {
            'fields': ('is_active', 'notes')
        }),
        ('API Configuration', {
            'fields': ('is_api_enabled', 'api_base_url', 'api_key', 'api_token'),
            'classes': ('collapse',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )

```

### subscriptions/apps.py
```python
from django.apps import AppConfig


class SubscriptionsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'subscriptions'

```

### subscriptions/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in subscriptions
### subscriptions/templates/subscriptions/subscription_list.html
```python
{% extends 'base.html' %}

{% block title %}My Subscriptions{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">My Subscriptions</h1>
        <a href="{% url 'subscriptions:subscription_create' %}" class="btn btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Add Subscription
        </a>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">Total Monthly Cost</div>
            <div class="stat-value text-primary">${{ total_monthly|floatformat:2 }}</div>
            <div class="stat-desc">Active subscriptions</div>
        </div>

        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">Active Subscriptions</div>
            <div class="stat-value text-success">{{ active_count }}</div>
            <div class="stat-desc">Currently active</div>
        </div>

        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">API Enabled</div>
            <div class="stat-value text-info">{{ api_enabled_count }}</div>
            <div class="stat-desc">With API access</div>
        </div>
    </div>

    {% if subscriptions %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for subscription in subscriptions %}
            <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
                <div class="card-body">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="card-title text-lg">{{ subscription.name }}</h2>
                        <div class="badge {% if subscription.is_active %}badge-success{% else %}badge-error{% endif %}">
                            {% if subscription.is_active %}Active{% else %}Inactive{% endif %}
                        </div>
                    </div>

                    {% if subscription.provider %}
                    <p class="text-sm text-gray-600 mb-2">{{ subscription.provider }}</p>
                    {% endif %}

                    <div class="flex justify-between items-center mb-4">
                        <span class="text-2xl font-bold text-primary">${{ subscription.amount }}</span>
                        <span class="badge badge-outline">{{ subscription.get_billing_cycle_display }}</span>
                    </div>

                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Next Due:</span>
                            <span class="font-medium">{{ subscription.next_due_date }}</span>
                        </div>
                        {% if subscription.is_api_enabled %}
                        <div class="flex items-center text-sm text-info">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            API Enabled
                        </div>
                        {% endif %}
                    </div>

                    <div class="card-actions justify-end">
                        <a href="{% url 'subscriptions:subscription_detail' subscription.pk %}" class="btn btn-sm btn-outline">View</a>
                        <a href="{% url 'subscriptions:subscription_update' subscription.pk %}" class="btn btn-sm btn-primary">Edit</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="max-w-md mx-auto">
                <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No subscriptions yet</h3>
                <p class="text-gray-600 mb-6">Start tracking your subscriptions and API services by adding your first one.</p>
                <a href="{% url 'subscriptions:subscription_create' %}" class="btn btn-primary">
                    Add Your First Subscription
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
```

### subscriptions/templates/subscriptions/subscription_confirm_delete.html
```python
{% extends 'base.html' %}

{% block title %}Delete Subscription - {{ subscription.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-md mx-auto">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body text-center">
                <div class="mb-6">
                    <svg class="w-16 h-16 mx-auto text-error mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Delete Subscription</h2>
                    <p class="text-gray-600">Are you sure you want to delete this subscription?</p>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-lg mb-2">{{ subscription.name }}</h3>
                    <div class="text-sm text-gray-600 space-y-1">
                        <p><strong>Provider:</strong> {{ subscription.provider|default:"N/A" }}</p>
                        <p><strong>Amount:</strong> ${{ subscription.amount }}</p>
                        <p><strong>Billing Cycle:</strong> {{ subscription.get_billing_cycle_display }}</p>
                        <p><strong>Next Due:</strong> {{ subscription.next_due_date }}</p>
                    </div>
                </div>

                <div class="alert alert-warning mb-6">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>This action cannot be undone. All subscription data will be permanently deleted.</span>
                </div>

                <form method="post" class="space-y-4">
                    {% csrf_token %}
                    <div class="flex space-x-4">
                        <a href="{% url 'subscriptions:subscription_detail' subscription.pk %}" class="btn btn-outline flex-1">
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-error flex-1">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            Delete Subscription
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

### subscriptions/templates/subscriptions/subscription_form.html
```python
{% extends 'base.html' %}

{% block title %}
    {% if object %}Edit Subscription{% else %}Add Subscription{% endif %}
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="flex items-center mb-8">
            <a href="{% url 'subscriptions:subscription_list' %}" class="btn btn-ghost btn-sm mr-4">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to Subscriptions
            </a>
            <h1 class="text-3xl font-bold text-gray-800">
                {% if object %}Edit Subscription{% else %}Add New Subscription{% endif %}
            </h1>
        </div>

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <form method="post" class="space-y-6">
                    {% csrf_token %}

                    <!-- Basic Information -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Basic Information</h3>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Subscription Name *</span>
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.name.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Provider</span>
                            </label>
                            {{ form.provider }}
                            {% if form.provider.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.provider.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Amount *</span>
                                </label>
                                {{ form.amount }}
                                {% if form.amount.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.amount.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Billing Cycle *</span>
                                </label>
                                {{ form.billing_cycle }}
                                {% if form.billing_cycle.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.billing_cycle.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Dates -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Dates</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Start Date *</span>
                                </label>
                                {{ form.start_date }}
                                {% if form.start_date.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.start_date.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Next Due Date *</span>
                                </label>
                                {{ form.next_due_date }}
                                {% if form.next_due_date.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.next_due_date.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- API Configuration -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">API Configuration</h3>

                        <div class="form-control">
                            <label class="label cursor-pointer">
                                <span class="label-text">Enable API Access</span>
                                {{ form.is_api_enabled }}
                            </label>
                        </div>

                        <div id="api-fields" class="space-y-4 {% if not form.is_api_enabled.value %}hidden{% endif %}">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">API Base URL</span>
                                </label>
                                {{ form.api_base_url }}
                                {% if form.api_base_url.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.api_base_url.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">API Key</span>
                                </label>
                                {{ form.api_key }}
                                {% if form.api_key.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.api_key.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">API Token</span>
                                </label>
                                {{ form.api_token }}
                                {% if form.api_token.errors %}
                                    <label class="label">
                                        <span class="label-text-alt text-error">{{ form.api_token.errors.0 }}</span>
                                    </label>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Status</h3>

                        <div class="form-control">
                            <label class="label cursor-pointer">
                                <span class="label-text">Active Subscription</span>
                                {{ form.is_active }}
                            </label>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Notes</span>
                            </label>
                            {{ form.notes }}
                            {% if form.notes.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.notes.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end space-x-4 pt-6 border-t">
                        <a href="{% url 'subscriptions:subscription_list' %}" class="btn btn-outline">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            {% if object %}Update Subscription{% else %}Create Subscription{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const apiEnabledCheckbox = document.querySelector('input[name="is_api_enabled"]');
    const apiFields = document.getElementById('api-fields');

    function toggleApiFields() {
        if (apiEnabledCheckbox.checked) {
            apiFields.classList.remove('hidden');
        } else {
            apiFields.classList.add('hidden');
        }
    }

    apiEnabledCheckbox.addEventListener('change', toggleApiFields);
    toggleApiFields(); // Initial state
});
</script>
{% endblock %}
```

### subscriptions/templates/subscriptions/subscription_detail.html
```python
{% extends 'base.html' %}

{% block title %}{{ subscription.name }} - Subscription Details{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center">
                <a href="{% url 'subscriptions:subscription_list' %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Subscriptions
                </a>
                <h1 class="text-3xl font-bold text-gray-800">{{ subscription.name }}</h1>
            </div>
            <div class="flex space-x-2">
                <a href="{% url 'subscriptions:subscription_update' subscription.pk %}" class="btn btn-primary">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Edit
                </a>
                <a href="{% url 'subscriptions:subscription_delete' subscription.pk %}" class="btn btn-error">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Delete
                </a>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Information -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Basic Info Card -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">Basic Information</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-600">Subscription Name</label>
                                <p class="text-lg font-semibold">{{ subscription.name }}</p>
                            </div>
                            {% if subscription.provider %}
                            <div>
                                <label class="text-sm font-medium text-gray-600">Provider</label>
                                <p class="text-lg">{{ subscription.provider }}</p>
                            </div>
                            {% endif %}
                            <div>
                                <label class="text-sm font-medium text-gray-600">Amount</label>
                                <p class="text-2xl font-bold text-primary">${{ subscription.amount }}</p>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-600">Billing Cycle</label>
                                <p class="text-lg">{{ subscription.get_billing_cycle_display }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dates Card -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">Important Dates</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-600">Start Date</label>
                                <p class="text-lg">{{ subscription.start_date }}</p>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-600">Next Due Date</label>
                                <p class="text-lg font-semibold {% if subscription.next_due_date < today %}text-error{% else %}text-success{% endif %}">
                                    {{ subscription.next_due_date }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Configuration Card -->
                {% if subscription.is_api_enabled %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-info" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            API Configuration
                        </h2>
                        <div class="space-y-4">
                            {% if subscription.api_base_url %}
                            <div>
                                <label class="text-sm font-medium text-gray-600">API Base URL</label>
                                <p class="text-sm font-mono bg-gray-100 p-2 rounded">{{ subscription.api_base_url }}</p>
                            </div>
                            {% endif %}
                            {% if subscription.api_key %}
                            <div>
                                <label class="text-sm font-medium text-gray-600">API Key</label>
                                <p class="text-sm font-mono bg-gray-100 p-2 rounded">{{ subscription.api_key|truncatechars:20 }}...</p>
                            </div>
                            {% endif %}
                            {% if subscription.api_token %}
                            <div>
                                <label class="text-sm font-medium text-gray-600">API Token</label>
                                <p class="text-sm font-mono bg-gray-100 p-2 rounded">{{ subscription.api_token|truncatechars:30 }}...</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Notes Card -->
                {% if subscription.notes %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">Notes</h2>
                        <p class="text-gray-700 whitespace-pre-wrap">{{ subscription.notes }}</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Status Card -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title text-lg mb-4">Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-600">Active</span>
                                <div class="badge {% if subscription.is_active %}badge-success{% else %}badge-error{% endif %}">
                                    {% if subscription.is_active %}Yes{% else %}No{% endif %}
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-600">API Enabled</span>
                                <div class="badge {% if subscription.is_api_enabled %}badge-info{% else %}badge-neutral{% endif %}">
                                    {% if subscription.is_api_enabled %}Yes{% else %}No{% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timestamps Card -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title text-lg mb-4">Timestamps</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm font-medium text-gray-600">Created</label>
                                <p class="text-sm">{{ subscription.created_at|date:"M d, Y H:i" }}</p>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-600">Last Updated</label>
                                <p class="text-sm">{{ subscription.updated_at|date:"M d, Y H:i" }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title text-lg mb-4">Quick Actions</h3>
                        <div class="space-y-2">
                            <a href="{% url 'subscriptions:subscription_update' subscription.pk %}" class="btn btn-primary btn-sm w-full">
                                Edit Subscription
                            </a>
                            <a href="{% url 'subscriptions:subscription_delete' subscription.pk %}" class="btn btn-error btn-sm w-full">
                                Delete Subscription
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

### subscriptions/templates/subscriptions/subscription_dashboard.html
```python
{% extends 'base.html' %}

{% block title %}Subscription Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Subscription Dashboard</h1>
        <a href="{% url 'subscriptions:subscription_list' %}" class="btn btn-outline">
            View All Subscriptions
        </a>
    </div>

    <!-- Statistics Overview -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">Total Subscriptions</div>
            <div class="stat-value text-primary">{{ total_subscriptions }}</div>
            <div class="stat-desc">All subscriptions</div>
        </div>

        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">Active Subscriptions</div>
            <div class="stat-value text-success">{{ active_subscriptions }}</div>
            <div class="stat-desc">Currently active</div>
        </div>

        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">API Enabled</div>
            <div class="stat-value text-info">{{ api_enabled_subscriptions }}</div>
            <div class="stat-desc">With API access</div>
        </div>

        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-title">Monthly Cost</div>
            <div class="stat-value text-warning">${{ total_monthly_cost|floatformat:2 }}</div>
            <div class="stat-desc">Active subscriptions</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Subscriptions -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">Recent Subscriptions</h2>
                {% if recent_subscriptions %}
                    <div class="space-y-4">
                        {% for subscription in recent_subscriptions %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h3 class="font-semibold">{{ subscription.name }}</h3>
                                <p class="text-sm text-gray-600">{{ subscription.provider|default:"No provider" }}</p>
                                <p class="text-xs text-gray-500">Added {{ subscription.created_at|date:"M d, Y" }}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-primary">${{ subscription.amount }}</p>
                                <span class="badge badge-sm {% if subscription.is_active %}badge-success{% else %}badge-error{% endif %}">
                                    {% if subscription.is_active %}Active{% else %}Inactive{% endif %}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-gray-600">No subscriptions yet</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Upcoming Renewals -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">Upcoming Renewals</h2>
                {% if upcoming_renewals %}
                    <div class="space-y-4">
                        {% for subscription in upcoming_renewals %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h3 class="font-semibold">{{ subscription.name }}</h3>
                                <p class="text-sm text-gray-600">{{ subscription.get_billing_cycle_display }}</p>
                                <p class="text-xs text-gray-500">Due {{ subscription.next_due_date|date:"M d, Y" }}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-primary">${{ subscription.amount }}</p>
                                <a href="{% url 'subscriptions:subscription_detail' subscription.pk %}" class="btn btn-xs btn-outline">
                                    View
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-gray-600">No upcoming renewals</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-8">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">Quick Actions</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <a href="{% url 'subscriptions:subscription_create' %}" class="btn btn-primary">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add New Subscription
                    </a>
                    <a href="{% url 'subscriptions:subscription_list' %}" class="btn btn-outline">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        View All Subscriptions
                    </a>
                    <a href="{% url 'admin:subscriptions_subscription_changelist' %}" class="btn btn-outline">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Admin Panel
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

### App: search
### search/models.py
```python
from django.db import models

# Create your models here.

```

### search/views.py
```python
from django.shortcuts import render
from django.apps import apps
from django.db.models import Q, CharField, TextField
from django.contrib.auth.decorators import login_required

@login_required
def global_search(request):
    query = request.GET.get('q', '').strip()
    results = []

    if query:
        for model in apps.get_models():
            try:
                # Skip proxy or abstract models
                if model._meta.abstract or model._meta.proxy:
                    continue

                # Build query on CharFields and TextFields
                fields = [f.name for f in model._meta.fields if isinstance(f, (CharField, TextField))]
                if not fields:
                    continue

                q = Q()
                for field in fields:
                    q |= Q(**{f"{field}__icontains": query})

                # Default queryset
                queryset = model.objects.all()

                # Filter to user-owned objects based on ownership field
                field_names = [f.name for f in model._meta.fields]
                if 'user' in field_names:
                    queryset = queryset.filter(user=request.user)
                elif 'uploaded_by' in field_names:
                    queryset = queryset.filter(uploaded_by=request.user)
                elif 'author' in field_names:
                    queryset = queryset.filter(author=request.user)
                elif 'owner' in field_names:
                    queryset = queryset.filter(owner=request.user)

                # Optional: exclude test data if marked
                if 'is_test' in field_names:
                    queryset = queryset.filter(is_test=False)

                found = queryset.filter(q)[:5]
                if found:
                    results.append({
                        'model': model.__name__,
                        'items': found
                    })

            except Exception as e:
                print(f"[SEARCH ERROR] {model.__name__}: {e}")

    # If AJAX (modal search), return partial
    if request.headers.get("x-requested-with") == "XMLHttpRequest":
        return render(request, "search/partials/result_list.html", {
            "results": results,
            "query": query,
        })

    # Otherwise full search result page
    return render(request, "search/results.html", {
        "results": results,
        "query": query,
    })

```

### search/urls.py
```python
from django.urls import path
from .views import global_search

urlpatterns = [
    path('', global_search, name='global_search'),
]
```

### search/admin.py
```python
from django.contrib import admin

# Register your models here.

```

### search/apps.py
```python
from django.apps import AppConfig


class SearchConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'search'

```

### search/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in search
### search/templates/search/results.html
```python
{% extends "base.html" %}

{% block title %}Search Results{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-xl font-bold mb-4">Search Results for "{{ query }}"</h1>

    {% if results %}
        {% for result in results %}
            <div class="card bg-base-100 shadow-xl mb-4">
                <div class="card-body">
                    <h2 class="card-title">{{ result.model }}</h2>
                    <ul class="space-y-2">
                        {% for item in result.items %}
                            <li class="p-2 bg-base-200 rounded">
                                <a href="#" class="hover:text-primary">{{ item }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-8">
            <p class="text-gray-500">No results found.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
```

### search/templates/search/partials/result_list.html
```python
{% if results %}
    {% for result in results %}
        <div class="p-4 border-b border-base-300 hover:bg-base-200 transition-colors">
            <h3 class="font-bold text-base mb-2 flex items-center gap-2">
                <span class="badge badge-primary badge-sm">{{ result.model }}</span>
                <span class="text-base-content/70">{{ result.items|length }} result{{ result.items|length|pluralize }}</span>
            </h3>
            <ul class="space-y-1">
                {% for item in result.items %}
                    <li class="p-2 rounded hover:bg-base-300 transition-colors">
                        {% if item.get_absolute_url %}
                            <a href="{{ item.get_absolute_url }}" class="block hover:text-primary">
                                <div class="font-medium">{{ item }}</div>
                                {% if item.description %}
                                    <div class="text-sm text-base-content/60 mt-1">{{ item.description|truncatechars:100 }}</div>
                                {% elif item.bio %}
                                    <div class="text-sm text-base-content/60 mt-1">{{ item.bio|truncatechars:100 }}</div>
                                {% elif item.notes %}
                                    <div class="text-sm text-base-content/60 mt-1">{{ item.notes|truncatechars:100 }}</div>
                                {% endif %}
                                {% if item.created_at %}
                                    <div class="text-xs text-base-content/40 mt-1">{{ item.created_at|date:"M j, Y" }}</div>
                                {% endif %}
                            </a>
                        {% else %}
                            <div class="block">
                                <div class="font-medium">{{ item }}</div>
                                {% if item.description %}
                                    <div class="text-sm text-base-content/60 mt-1">{{ item.description|truncatechars:100 }}</div>
                                {% elif item.bio %}
                                    <div class="text-sm text-base-content/60 mt-1">{{ item.bio|truncatechars:100 }}</div>
                                {% elif item.notes %}
                                    <div class="text-sm text-base-content/60 mt-1">{{ item.notes|truncatechars:100 }}</div>
                                {% endif %}
                                {% if item.created_at %}
                                    <div class="text-xs text-base-content/40 mt-1">{{ item.created_at|date:"M j, Y" }}</div>
                                {% endif %}
                                <div class="text-xs text-base-content/40 mt-1">No detail page available</div>
                            </div>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endfor %}
{% else %}
    <div class="text-center py-8">
        <svg class="w-12 h-12 mx-auto mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-base-content/70">No results found for "{{ query }}"</p>
        <p class="text-sm text-base-content/50 mt-2">Try different keywords</p>
    </div>
{% endif %}
```

### App: prompts
### prompts/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.urls import reverse
from django.utils.text import slugify
import uuid

class Category(models.Model):
    name = models.CharField(max_length=100, unique=True)
    description = models.TextField(blank=True, null=True)
    color = models.CharField(max_length=7, default='#3B82F6', help_text='Hex color code (e.g., #3B82F6)')
    icon = models.CharField(max_length=50, default='light-bulb', help_text='Heroicon name (e.g., light-bulb, code, cog)')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name_plural = 'Categories'
        ordering = ['name']

    def __str__(self):
        return self.name

    def get_absolute_url(self):
        return reverse('prompts:category_detail', kwargs={'pk': self.pk})

class Tag(models.Model):
    name = models.CharField(max_length=50, unique=True)
    color = models.CharField(max_length=7, default='#6B7280', help_text='Hex color code (e.g., #6B7280)')
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['name']

    def __str__(self):
        return self.name

    def get_absolute_url(self):
        return reverse('prompts:tag_detail', kwargs={'pk': self.pk})

class Prompt(models.Model):
    PROMPT_TYPES = [
        ('text', 'Text Prompt'),
        ('code', 'Code Prompt'),
        ('creative', 'Creative Writing'),
        ('analysis', 'Analysis'),
        ('instruction', 'Instruction'),
        ('question', 'Question'),
        ('template', 'Template'),
    ]

    DIFFICULTY_LEVELS = [
        ('beginner', 'Beginner'),
        ('intermediate', 'Intermediate'),
        ('advanced', 'Advanced'),
        ('expert', 'Expert'),
    ]

    # Basic Information
    title = models.CharField(max_length=200)
    slug = models.SlugField(max_length=250, unique=True, blank=True)
    description = models.TextField(help_text='Brief description of what this prompt does')
    content = models.TextField(help_text='The actual prompt text')

    # Categorization
    category = models.ForeignKey(Category, on_delete=models.CASCADE, related_name='prompts')
    tags = models.ManyToManyField(Tag, blank=True, related_name='prompts')
    prompt_type = models.CharField(max_length=20, choices=PROMPT_TYPES, default='text')
    difficulty = models.CharField(max_length=15, choices=DIFFICULTY_LEVELS, default='intermediate')

    # Usage and Performance
    usage_count = models.PositiveIntegerField(default=0)
    success_rate = models.DecimalField(max_digits=5, decimal_places=2, default=0.00, help_text='Success rate percentage')
    average_rating = models.DecimalField(max_digits=3, decimal_places=2, default=0.00)

    # Examples and Context
    example_input = models.TextField(blank=True, null=True, help_text='Example input for the prompt')
    example_output = models.TextField(blank=True, null=True, help_text='Example output from the prompt')
    context_notes = models.TextField(blank=True, null=True, help_text='Additional context or instructions')

    # Metadata
    author = models.ForeignKey(User, on_delete=models.CASCADE, related_name='authored_prompts')
    is_public = models.BooleanField(default=True, help_text='Whether this prompt is visible to all users')
    is_featured = models.BooleanField(default=False, help_text='Featured prompts appear prominently')
    is_template = models.BooleanField(default=False, help_text='Template prompts can be used as starting points')

    # Timestamps
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    last_used = models.DateTimeField(blank=True, null=True)

    class Meta:
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['-created_at']),
            models.Index(fields=['category']),
            models.Index(fields=['prompt_type']),
            models.Index(fields=['difficulty']),
            models.Index(fields=['is_public']),
            models.Index(fields=['is_featured']),
        ]

    def __str__(self):
        return self.title

    def save(self, *args, **kwargs):
        if not self.slug:
            # Generate a unique slug
            base_slug = slugify(self.title)
            unique_slug = base_slug
            counter = 1

            while Prompt.objects.filter(slug=unique_slug).exists():
                unique_slug = f"{base_slug}-{counter}"
                counter += 1

            self.slug = unique_slug

        super().save(*args, **kwargs)

    def get_absolute_url(self):
        return reverse('prompts:prompt_detail', kwargs={'slug': self.slug})

    def increment_usage(self):
        """Increment the usage count"""
        self.usage_count += 1
        self.save(update_fields=['usage_count'])

    def update_rating(self, new_rating):
        """Update the average rating"""
        # This is a simplified version - in a real app you'd want a separate Rating model
        if self.average_rating == 0:
            self.average_rating = new_rating
        else:
            # Simple average - in production you'd want to track individual ratings
            self.average_rating = (self.average_rating + new_rating) / 2
        self.save(update_fields=['average_rating'])

    @property
    def short_description(self):
        """Return a shortened version of the description"""
        if len(self.description) <= 150:
            return self.description
        return self.description[:147] + '...'

    @property
    def difficulty_color(self):
        """Return color based on difficulty level"""
        colors = {
            'beginner': 'success',
            'intermediate': 'warning',
            'advanced': 'error',
            'expert': 'secondary',
        }
        return colors.get(self.difficulty, 'neutral')

class PromptUsage(models.Model):
    """Track individual prompt usage for analytics"""
    prompt = models.ForeignKey(Prompt, on_delete=models.CASCADE, related_name='usages')
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='prompt_usages')
    input_text = models.TextField(blank=True, null=True)
    output_text = models.TextField(blank=True, null=True)
    rating = models.PositiveSmallIntegerField(blank=True, null=True, choices=[(i, i) for i in range(1, 6)])
    feedback = models.TextField(blank=True, null=True)
    execution_time = models.DurationField(blank=True, null=True)
    tokens_used = models.PositiveIntegerField(blank=True, null=True)
    cost = models.DecimalField(max_digits=10, decimal_places=4, blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['-created_at']),
            models.Index(fields=['prompt', 'user']),
        ]

    def __str__(self):
        return f"{self.user.username} used {self.prompt.title} on {self.created_at.date()}"

class PromptCollection(models.Model):
    """Collections of prompts for organization"""
    name = models.CharField(max_length=200)
    description = models.TextField(blank=True, null=True)
    prompts = models.ManyToManyField(Prompt, related_name='collections')
    owner = models.ForeignKey(User, on_delete=models.CASCADE, related_name='prompt_collections')
    is_public = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-created_at']

    def __str__(self):
        return self.name

    def get_absolute_url(self):
        return reverse('prompts:collection_detail', kwargs={'pk': self.pk})

```

### prompts/views.py
```python
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from django.contrib.auth.models import User
from django.db.models import Q, Count, Avg
from django.core.paginator import Paginator
from django.http import JsonResponse
from django.views.decorators.http import require_POST
from django.utils import timezone
from .models import Prompt, Category, Tag, PromptCollection, PromptUsage
from .forms import (
    PromptForm, CategoryForm, TagForm, PromptCollectionForm,
    PromptUsageForm, PromptSearchForm, PromptTestForm
)

def test_view(request):
    """Test view to check template loading"""
    return render(request, 'prompts/test.html')

def prompt_list(request):
    """Display list of prompts with search and filtering"""
    search_form = PromptSearchForm(request.GET)
    prompts = Prompt.objects.filter(is_public=True)

    # Apply search filters
    if search_form.is_valid():
        q = search_form.cleaned_data.get('q')
        if q:
            prompts = prompts.filter(
                Q(title__icontains=q) |
                Q(description__icontains=q) |
                Q(content__icontains=q) |
                Q(tags__name__icontains=q)
            ).distinct()

        category = search_form.cleaned_data.get('category')
        if category:
            prompts = prompts.filter(category=category)

        prompt_type = search_form.cleaned_data.get('prompt_type')
        if prompt_type:
            prompts = prompts.filter(prompt_type=prompt_type)

        difficulty = search_form.cleaned_data.get('difficulty')
        if difficulty:
            prompts = prompts.filter(difficulty=difficulty)

        tags = search_form.cleaned_data.get('tags')
        if tags:
            prompts = prompts.filter(tags__in=tags).distinct()

        if search_form.cleaned_data.get('is_featured'):
            prompts = prompts.filter(is_featured=True)

        if search_form.cleaned_data.get('is_template'):
            prompts = prompts.filter(is_template=True)

    # Get categories and tags for sidebar
    categories = Category.objects.annotate(prompt_count=Count('prompts')).order_by('-prompt_count')[:10]
    popular_tags = Tag.objects.annotate(prompt_count=Count('prompts')).order_by('-prompt_count')[:15]

    # Pagination
    paginator = Paginator(prompts, 12)
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)

    context = {
        'page_obj': page_obj,
        'search_form': search_form,
        'categories': categories,
        'popular_tags': popular_tags,
        'featured_prompts': Prompt.objects.filter(is_featured=True, is_public=True)[:3],
    }
    return render(request, 'prompts/prompt_list.html', context)

def prompt_detail(request, slug):
    """Display prompt details and allow testing"""
    prompt = get_object_or_404(Prompt, slug=slug, is_public=True)
    test_form = PromptTestForm()
    usage_form = PromptUsageForm()

    # Get related prompts
    related_prompts = Prompt.objects.filter(
        category=prompt.category,
        is_public=True
    ).exclude(id=prompt.id)[:4]

    # Track view (increment usage count)
    if request.user.is_authenticated:
        prompt.increment_usage()

    context = {
        'prompt': prompt,
        'test_form': test_form,
        'usage_form': usage_form,
        'related_prompts': related_prompts,
    }
    return render(request, 'prompts/prompt_detail.html', context)

@login_required
def prompt_create(request):
    """Create a new prompt"""
    if request.method == 'POST':
        form = PromptForm(request.POST, user=request.user)
        if form.is_valid():
            prompt = form.save(commit=False)
            prompt.author = request.user
            prompt.save()
            form.save_m2m()  # Save many-to-many relationships
            messages.success(request, 'Prompt created successfully!')
            return redirect('prompts:prompt_detail', slug=prompt.slug)
    else:
        form = PromptForm(user=request.user)

    context = {
        'form': form,
        'title': 'Create New Prompt',
    }
    return render(request, 'prompts/prompt_form.html', context)

@login_required
def prompt_edit(request, slug):
    """Edit an existing prompt"""
    prompt = get_object_or_404(Prompt, slug=slug)

    # Check permissions
    if not request.user.is_staff and prompt.author != request.user:
        messages.error(request, "You don't have permission to edit this prompt.")
        return redirect('prompts:prompt_detail', slug=slug)

    if request.method == 'POST':
        form = PromptForm(request.POST, instance=prompt, user=request.user)
        if form.is_valid():
            form.save()
            messages.success(request, 'Prompt updated successfully!')
            return redirect('prompts:prompt_detail', slug=prompt.slug)
    else:
        form = PromptForm(instance=prompt, user=request.user)

    context = {
        'form': form,
        'prompt': prompt,
        'title': 'Edit Prompt',
    }
    return render(request, 'prompts/prompt_form.html', context)

@login_required
@require_POST
def prompt_delete(request, slug):
    """Delete a prompt"""
    prompt = get_object_or_404(Prompt, slug=slug)

    # Check permissions
    if not request.user.is_staff and prompt.author != request.user:
        messages.error(request, "You don't have permission to delete this prompt.")
        return redirect('prompts:prompt_detail', slug=slug)

    prompt.delete()
    messages.success(request, 'Prompt deleted successfully!')
    return redirect('prompts:prompt_list')

@login_required
def prompt_test(request, slug):
    """Test a prompt with AI"""
    prompt = get_object_or_404(Prompt, slug=slug, is_public=True)

    if request.method == 'POST':
        form = PromptTestForm(request.POST)
        if form.is_valid():
            # Here you would integrate with your AI service
            # For now, we'll just simulate a response
            input_text = form.cleaned_data.get('input_text', '')
            custom_prompt = form.cleaned_data.get('custom_prompt', '')

            # Use custom prompt if provided, otherwise use the prompt's content
            final_prompt = custom_prompt if custom_prompt else prompt.content

            # Simulate AI response (replace with actual AI integration)
            simulated_response = f"""
This is a simulated response to your prompt:

**Prompt:** {final_prompt}

**Input:** {input_text if input_text else 'No input provided'}

**Response:** This is where the actual AI response would appear. In a real implementation, you would integrate with OpenAI, Claude, or another AI service here.

**Model used:** {form.cleaned_data.get('model')}
**Temperature:** {form.cleaned_data.get('temperature')}
**Max tokens:** {form.cleaned_data.get('max_tokens')}
"""

            # Create usage record
            usage = PromptUsage.objects.create(
                prompt=prompt,
                user=request.user,
                input_text=input_text,
                output_text=simulated_response,
            )

            context = {
                'prompt': prompt,
                'form': form,
                'response': simulated_response,
                'usage': usage,
            }
            return render(request, 'prompts/prompt_test_result.html', context)
    else:
        form = PromptTestForm()

    context = {
        'prompt': prompt,
        'form': form,
    }
    return render(request, 'prompts/prompt_test.html', context)

@login_required
@require_POST
def prompt_rate(request, slug):
    """Rate a prompt after using it"""
    prompt = get_object_or_404(Prompt, slug=slug)
    usage_id = request.POST.get('usage_id')

    if usage_id:
        usage = get_object_or_404(PromptUsage, id=usage_id, user=request.user)
        rating = request.POST.get('rating')
        feedback = request.POST.get('feedback', '')

        if rating:
            usage.rating = int(rating)
            usage.feedback = feedback
            usage.save()

            # Update prompt's average rating
            prompt.update_rating(int(rating))

            messages.success(request, 'Thank you for your feedback!')
        else:
            messages.error(request, 'Please provide a rating.')

    return redirect('prompts:prompt_detail', slug=slug)

def category_list(request):
    """Display list of categories"""
    categories = Category.objects.annotate(
        prompt_count=Count('prompts', filter=Q(prompts__is_public=True))
    ).order_by('-prompt_count')

    context = {
        'categories': categories,
    }
    return render(request, 'prompts/category_list.html', context)

def category_detail(request, pk):
    """Display category details and its prompts"""
    category = get_object_or_404(Category, pk=pk)
    prompts = Prompt.objects.filter(category=category, is_public=True).order_by('-created_at')

    # Pagination
    paginator = Paginator(prompts, 12)
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)

    context = {
        'category': category,
        'page_obj': page_obj,
    }
    return render(request, 'prompts/category_detail.html', context)

def tag_detail(request, pk):
    """Display tag details and its prompts"""
    tag = get_object_or_404(Tag, pk=pk)
    prompts = Prompt.objects.filter(tags=tag, is_public=True).order_by('-created_at')

    # Pagination
    paginator = Paginator(prompts, 12)
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)

    context = {
        'tag': tag,
        'page_obj': page_obj,
    }
    return render(request, 'prompts/tag_detail.html', context)

@login_required
def my_prompts(request):
    """Display user's own prompts"""
    prompts = Prompt.objects.filter(author=request.user).order_by('-created_at')

    # Pagination
    paginator = Paginator(prompts, 12)
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)

    context = {
        'page_obj': page_obj,
        'title': 'My Prompts',
    }
    return render(request, 'prompts/my_prompts.html', context)

@login_required
def prompt_collections(request):
    """Display user's prompt collections"""
    collections = PromptCollection.objects.filter(owner=request.user).order_by('-created_at')

    context = {
        'collections': collections,
    }
    return render(request, 'prompts/collections.html', context)

@login_required
def collection_create(request):
    """Create a new prompt collection"""
    if request.method == 'POST':
        form = PromptCollectionForm(request.POST)
        if form.is_valid():
            collection = form.save(commit=False)
            collection.owner = request.user
            collection.save()
            form.save_m2m()  # Save many-to-many relationships
            messages.success(request, 'Collection created successfully!')
            return redirect('prompts:collection_detail', pk=collection.pk)
    else:
        form = PromptCollectionForm()

    context = {
        'form': form,
        'title': 'Create New Collection',
    }
    return render(request, 'prompts/collection_form.html', context)

def collection_detail(request, pk):
    """Display collection details"""
    collection = get_object_or_404(PromptCollection, pk=pk)

    # Check if user can view this collection
    if not collection.is_public and collection.owner != request.user:
        messages.error(request, "You don't have permission to view this collection.")
        return redirect('prompts:collections')

    context = {
        'collection': collection,
    }
    return render(request, 'prompts/collection_detail.html', context)

# Admin views (staff only)
@login_required
def admin_dashboard(request):
    """Admin dashboard for prompt management"""
    if not request.user.is_staff:
        messages.error(request, "You don't have permission to access this page.")
        return redirect('prompts:prompt_list')

    # Statistics
    total_prompts = Prompt.objects.count()
    public_prompts = Prompt.objects.filter(is_public=True).count()
    featured_prompts = Prompt.objects.filter(is_featured=True).count()
    total_categories = Category.objects.count()
    total_tags = Tag.objects.count()

    # Recent activity
    recent_prompts = Prompt.objects.order_by('-created_at')[:5]
    recent_usage = PromptUsage.objects.order_by('-created_at')[:10]

    context = {
        'total_prompts': total_prompts,
        'public_prompts': public_prompts,
        'featured_prompts': featured_prompts,
        'total_categories': total_categories,
        'total_tags': total_tags,
        'recent_prompts': recent_prompts,
        'recent_usage': recent_usage,
    }
    return render(request, 'prompts/admin_dashboard.html', context)

```

### prompts/urls.py
```python
from django.urls import path
from . import views

app_name = 'prompts'

urlpatterns = [
    # Test view
    path('test/', views.test_view, name='test'),

    # Main prompt views
    path('', views.prompt_list, name='prompt_list'),
    path('create/', views.prompt_create, name='prompt_create'),

    # User-specific views (must come before slug patterns)
    path('my-prompts/', views.my_prompts, name='my_prompts'),
    path('collections/', views.prompt_collections, name='collections'),
    path('collections/create/', views.collection_create, name='collection_create'),
    path('collections/<int:pk>/', views.collection_detail, name='collection_detail'),

    # Category views
    path('categories/', views.category_list, name='category_list'),
    path('categories/<int:pk>/', views.category_detail, name='category_detail'),

    # Tag views
    path('tags/<int:pk>/', views.tag_detail, name='tag_detail'),

    # Admin views
    path('admin/dashboard/', views.admin_dashboard, name='admin_dashboard'),

    # Prompt detail views (must come last to avoid catching other paths)
    path('<slug:slug>/', views.prompt_detail, name='prompt_detail'),
    path('<slug:slug>/edit/', views.prompt_edit, name='prompt_edit'),
    path('<slug:slug>/delete/', views.prompt_delete, name='prompt_delete'),
    path('<slug:slug>/test/', views.prompt_test, name='prompt_test'),
    path('<slug:slug>/rate/', views.prompt_rate, name='prompt_rate'),
]
```

### prompts/forms.py
```python
from django import forms
from django.contrib.auth.models import User
from .models import Prompt, Category, Tag, PromptCollection, PromptUsage
from django.db import models

class PromptForm(forms.ModelForm):
    class Meta:
        model = Prompt
        fields = [
            'title', 'description', 'content', 'category', 'tags', 
            'prompt_type', 'difficulty', 'example_input', 'example_output', 
            'context_notes', 'is_public', 'is_featured', 'is_template'
        ]
        widgets = {
            'title': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'placeholder': 'Enter prompt title...'
            }),
            'description': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full',
                'rows': 3,
                'placeholder': 'Brief description of what this prompt does...'
            }),
            'content': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full font-mono',
                'rows': 8,
                'placeholder': 'Enter your prompt content here...'
            }),
            'category': forms.Select(attrs={
                'class': 'select select-bordered w-full'
            }),
            'tags': forms.SelectMultiple(attrs={
                'class': 'select select-bordered w-full',
                'size': 5
            }),
            'prompt_type': forms.Select(attrs={
                'class': 'select select-bordered w-full'
            }),
            'difficulty': forms.Select(attrs={
                'class': 'select select-bordered w-full'
            }),
            'example_input': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full font-mono',
                'rows': 4,
                'placeholder': 'Example input for the prompt...'
            }),
            'example_output': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full font-mono',
                'rows': 4,
                'placeholder': 'Example output from the prompt...'
            }),
            'context_notes': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full',
                'rows': 3,
                'placeholder': 'Additional context or instructions...'
            }),
            'is_public': forms.CheckboxInput(attrs={
                'class': 'checkbox checkbox-primary'
            }),
            'is_featured': forms.CheckboxInput(attrs={
                'class': 'checkbox checkbox-secondary'
            }),
            'is_template': forms.CheckboxInput(attrs={
                'class': 'checkbox checkbox-accent'
            }),
        }
    
    def __init__(self, *args, **kwargs):
        user = kwargs.pop('user', None)
        super().__init__(*args, **kwargs)
        
        # Filter categories and tags if user is not staff
        if user and not user.is_staff:
            self.fields['category'].queryset = Category.objects.filter(
                prompts__is_public=True
            ).distinct()
            self.fields['tags'].queryset = Tag.objects.filter(
                prompts__is_public=True
            ).distinct()

class CategoryForm(forms.ModelForm):
    class Meta:
        model = Category
        fields = ['name', 'description', 'color', 'icon']
        widgets = {
            'name': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'placeholder': 'Category name...'
            }),
            'description': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full',
                'rows': 3,
                'placeholder': 'Category description...'
            }),
            'color': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'type': 'color',
                'placeholder': '#3B82F6'
            }),
            'icon': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'placeholder': 'light-bulb, code, cog, etc.'
            }),
        }

class TagForm(forms.ModelForm):
    class Meta:
        model = Tag
        fields = ['name', 'color']
        widgets = {
            'name': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'placeholder': 'Tag name...'
            }),
            'color': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'type': 'color',
                'placeholder': '#6B7280'
            }),
        }

class PromptCollectionForm(forms.ModelForm):
    class Meta:
        model = PromptCollection
        fields = ['name', 'description', 'prompts', 'is_public']
        widgets = {
            'name': forms.TextInput(attrs={
                'class': 'input input-bordered w-full',
                'placeholder': 'Collection name...'
            }),
            'description': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full',
                'rows': 3,
                'placeholder': 'Collection description...'
            }),
            'prompts': forms.SelectMultiple(attrs={
                'class': 'select select-bordered w-full',
                'size': 8
            }),
            'is_public': forms.CheckboxInput(attrs={
                'class': 'checkbox checkbox-primary'
            }),
        }
    
    def __init__(self, *args, **kwargs):
        user = kwargs.pop('user', None)
        super().__init__(*args, **kwargs)
        
        if user:
            # Only show prompts that the user can access
            if user.is_staff:
                self.fields['prompts'].queryset = Prompt.objects.all()
            else:
                self.fields['prompts'].queryset = Prompt.objects.filter(
                    models.Q(is_public=True) | models.Q(author=user)
                )

class PromptUsageForm(forms.ModelForm):
    class Meta:
        model = PromptUsage
        fields = ['input_text', 'output_text', 'rating', 'feedback']
        widgets = {
            'input_text': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full font-mono',
                'rows': 4,
                'placeholder': 'Your input text...'
            }),
            'output_text': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full font-mono',
                'rows': 6,
                'placeholder': 'Generated output...'
            }),
            'rating': forms.Select(attrs={
                'class': 'select select-bordered w-full'
            }),
            'feedback': forms.Textarea(attrs={
                'class': 'textarea textarea-bordered w-full',
                'rows': 3,
                'placeholder': 'Your feedback about this prompt...'
            }),
        }

class PromptSearchForm(forms.Form):
    q = forms.CharField(
        max_length=200,
        required=False,
        widget=forms.TextInput(attrs={
            'class': 'input input-bordered w-full',
            'placeholder': 'Search prompts...'
        })
    )
    
    category = forms.ModelChoiceField(
        queryset=Category.objects.all(),
        required=False,
        empty_label="All Categories",
        widget=forms.Select(attrs={
            'class': 'select select-bordered w-full'
        })
    )
    
    prompt_type = forms.ChoiceField(
        choices=[('', 'All Types')] + Prompt.PROMPT_TYPES,
        required=False,
        widget=forms.Select(attrs={
            'class': 'select select-bordered w-full'
        })
    )
    
    difficulty = forms.ChoiceField(
        choices=[('', 'All Difficulties')] + Prompt.DIFFICULTY_LEVELS,
        required=False,
        widget=forms.Select(attrs={
            'class': 'select select-bordered w-full'
        })
    )
    
    tags = forms.ModelMultipleChoiceField(
        queryset=Tag.objects.all(),
        required=False,
        widget=forms.SelectMultiple(attrs={
            'class': 'select select-bordered w-full',
            'size': 4
        })
    )
    
    is_featured = forms.BooleanField(
        required=False,
        widget=forms.CheckboxInput(attrs={
            'class': 'checkbox checkbox-primary'
        })
    )
    
    is_template = forms.BooleanField(
        required=False,
        widget=forms.CheckboxInput(attrs={
            'class': 'checkbox checkbox-accent'
        })
    )

class PromptTestForm(forms.Form):
    input_text = forms.CharField(
        widget=forms.Textarea(attrs={
            'class': 'textarea textarea-bordered w-full font-mono',
            'rows': 6,
            'placeholder': 'Enter your input text here...'
        }),
        required=False
    )
    
    custom_prompt = forms.CharField(
        widget=forms.Textarea(attrs={
            'class': 'textarea textarea-bordered w-full font-mono',
            'rows': 4,
            'placeholder': 'Or enter a custom prompt...'
        }),
        required=False
    )
    
    model = forms.ChoiceField(
        choices=[
            ('gpt-4', 'GPT-4'),
            ('gpt-3.5-turbo', 'GPT-3.5 Turbo'),
            ('claude-3', 'Claude 3'),
            ('gemini-pro', 'Gemini Pro'),
        ],
        initial='gpt-3.5-turbo',
        widget=forms.Select(attrs={
            'class': 'select select-bordered w-full'
        })
    )
    
    temperature = forms.FloatField(
        min_value=0.0,
        max_value=2.0,
        initial=0.7,
        widget=forms.NumberInput(attrs={
            'class': 'input input-bordered w-full',
            'step': '0.1'
        })
    )
    
    max_tokens = forms.IntegerField(
        min_value=1,
        max_value=4000,
        initial=1000,
        widget=forms.NumberInput(attrs={
            'class': 'input input-bordered w-full'
        })
    ) 
```

### prompts/admin.py
```python
from django.contrib import admin
from .models import Prompt, Category, Tag, PromptUsage, PromptCollection

@admin.register(Category)
class CategoryAdmin(admin.ModelAdmin):
    list_display = ['name', 'prompt_count', 'created_at']
    list_filter = ['created_at']
    search_fields = ['name', 'description']
    readonly_fields = ['created_at', 'updated_at']
    
    def prompt_count(self, obj):
        return obj.prompts.count()
    prompt_count.short_description = 'Prompts'

@admin.register(Tag)
class TagAdmin(admin.ModelAdmin):
    list_display = ['name', 'prompt_count', 'color', 'created_at']
    list_filter = ['created_at']
    search_fields = ['name']
    readonly_fields = ['created_at']
    
    def prompt_count(self, obj):
        return obj.prompts.count()
    prompt_count.short_description = 'Prompts'

@admin.register(Prompt)
class PromptAdmin(admin.ModelAdmin):
    list_display = [
        'title', 'author', 'category', 'prompt_type', 'difficulty', 
        'is_public', 'is_featured', 'usage_count', 'average_rating', 'created_at'
    ]
    list_filter = [
        'prompt_type', 'difficulty', 'is_public', 'is_featured', 'is_template',
        'category', 'tags', 'created_at'
    ]
    search_fields = ['title', 'description', 'content', 'author__username']
    readonly_fields = ['slug', 'usage_count', 'success_rate', 'average_rating', 'created_at', 'updated_at', 'last_used']
    prepopulated_fields = {'slug': ('title',)}
    filter_horizontal = ['tags']
    date_hierarchy = 'created_at'
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('title', 'slug', 'description', 'content', 'author')
        }),
        ('Categorization', {
            'fields': ('category', 'tags', 'prompt_type', 'difficulty')
        }),
        ('Examples & Context', {
            'fields': ('example_input', 'example_output', 'context_notes'),
            'classes': ('collapse',)
        }),
        ('Settings', {
            'fields': ('is_public', 'is_featured', 'is_template')
        }),
        ('Statistics', {
            'fields': ('usage_count', 'success_rate', 'average_rating', 'last_used'),
            'classes': ('collapse',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )

@admin.register(PromptUsage)
class PromptUsageAdmin(admin.ModelAdmin):
    list_display = ['prompt', 'user', 'rating', 'tokens_used', 'cost', 'created_at']
    list_filter = ['rating', 'created_at', 'prompt__category']
    search_fields = ['prompt__title', 'user__username', 'input_text', 'output_text']
    readonly_fields = ['created_at']
    date_hierarchy = 'created_at'
    
    fieldsets = (
        ('Usage Information', {
            'fields': ('prompt', 'user', 'input_text', 'output_text')
        }),
        ('Feedback', {
            'fields': ('rating', 'feedback')
        }),
        ('Analytics', {
            'fields': ('execution_time', 'tokens_used', 'cost'),
            'classes': ('collapse',)
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        }),
    )

@admin.register(PromptCollection)
class PromptCollectionAdmin(admin.ModelAdmin):
    list_display = ['name', 'owner', 'prompt_count', 'is_public', 'created_at']
    list_filter = ['is_public', 'created_at']
    search_fields = ['name', 'description', 'owner__username']
    readonly_fields = ['created_at', 'updated_at']
    filter_horizontal = ['prompts']
    
    def prompt_count(self, obj):
        return obj.prompts.count()
    prompt_count.short_description = 'Prompts'

```

### prompts/apps.py
```python
from django.apps import AppConfig


class PromptsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'prompts'

```

### prompts/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in prompts
### prompts/templates/prompts/prompt_list.html
```python
{% extends "base.html" %}

{% block title %}AI Prompts - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div>
                    <h1 class="text-4xl font-bold text-base-content">AI Prompts</h1>
                    <p class="text-base-content/70 text-lg mt-2">Discover and test powerful AI prompts</p>
                </div>
                {% if user.is_authenticated %}
                    <div class="flex gap-2">
                        <a href="{% url 'prompts:prompt_create' %}" class="btn btn-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Create Prompt
                        </a>
                        <a href="{% url 'prompts:my_prompts' %}" class="btn btn-outline">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            My Prompts
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Featured Prompts -->
        {% if featured_prompts %}
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-4">Featured Prompts</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {% for prompt in featured_prompts %}
                        <div class="card bg-gradient-to-br from-primary/10 to-secondary/10 border border-primary/20">
                            <div class="card-body">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="badge badge-primary">Featured</div>
                                    <div class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.get_difficulty_display }}</div>
                                </div>
                                <h3 class="card-title text-lg">{{ prompt.title }}</h3>
                                <p class="text-base-content/70">{{ prompt.short_description }}</p>
                                <div class="flex items-center gap-2 mt-2">
                                    <div class="avatar">
                                        <div class="w-6 h-6 rounded-full bg-primary text-primary-content text-xs flex items-center justify-center">
                                            {{ prompt.author.username|first|upper }}
                                        </div>
                                    </div>
                                    <span class="text-sm text-base-content/60">@{{ prompt.author.username }}</span>
                                </div>
                                <div class="card-actions justify-end mt-4">
                                    <a href="{% url 'prompts:prompt_detail' prompt.slug %}" class="btn btn-primary btn-sm">
                                        View & Test
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <!-- Search Form -->
                <div class="card bg-base-100 shadow-xl mb-6">
                    <div class="card-body">
                        <h3 class="card-title text-lg mb-4">Search & Filter</h3>
                        <form method="get" class="space-y-4">
                            {{ search_form.q }}
                            {{ search_form.category }}
                            {{ search_form.prompt_type }}
                            {{ search_form.difficulty }}
                            {{ search_form.tags }}
                            
                            <div class="form-control">
                                <label class="label cursor-pointer">
                                    <span class="label-text">Featured Only</span>
                                    {{ search_form.is_featured }}
                                </label>
                            </div>
                            
                            <div class="form-control">
                                <label class="label cursor-pointer">
                                    <span class="label-text">Templates Only</span>
                                    {{ search_form.is_template }}
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                                Search
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Categories -->
                <div class="card bg-base-100 shadow-xl mb-6">
                    <div class="card-body">
                        <h3 class="card-title text-lg mb-4">Categories</h3>
                        <div class="space-y-2">
                            {% for category in categories %}
                                <a href="{% url 'prompts:category_detail' category.pk %}" 
                                   class="flex items-center justify-between p-2 rounded-lg hover:bg-base-200 transition-colors">
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 rounded-full" style="background-color: {{ category.color }};"></div>
                                        <span>{{ category.name }}</span>
                                    </div>
                                    <span class="badge badge-neutral">{{ category.prompt_count }}</span>
                                </a>
                            {% empty %}
                                <p class="text-base-content/60 text-sm">No categories yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Popular Tags -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title text-lg mb-4">Popular Tags</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for tag in popular_tags %}
                                <span class="badge badge-outline" style="border-color: {{ tag.color }}; color: {{ tag.color }};">
                                    {{ tag.name }}
                                </span>
                            {% empty %}
                                <p class="text-base-content/60 text-sm">No tags yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-3">
                <!-- Results Header -->
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold">All Prompts</h2>
                        <p class="text-base-content/60">
                            Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} prompts
                        </p>
                    </div>
                </div>

                <!-- Prompts Grid -->
                {% if page_obj %}
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        {% for prompt in page_obj %}
                            <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
                                <div class="card-body">
                                    <!-- Header -->
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.get_difficulty_display }}</div>
                                            {% if prompt.is_featured %}
                                                <div class="badge badge-primary">Featured</div>
                                            {% endif %}
                                            {% if prompt.is_template %}
                                                <div class="badge badge-accent">Template</div>
                                            {% endif %}
                                        </div>
                                        <div class="dropdown dropdown-end">
                                            <div tabindex="0" role="button" class="btn btn-ghost btn-xs">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                                                </svg>
                                            </div>
                                            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                                                <li><a href="{% url 'prompts:prompt_detail' prompt.slug %}">View Details</a></li>
                                                <li><a href="{% url 'prompts:prompt_test' prompt.slug %}">Test Prompt</a></li>
                                                {% if user == prompt.author or user.is_staff %}
                                                    <li><a href="{% url 'prompts:prompt_edit' prompt.slug %}">Edit</a></li>
                                                {% endif %}
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- Title and Description -->
                                    <h3 class="card-title text-lg mb-2">
                                        <a href="{% url 'prompts:prompt_detail' prompt.slug %}" class="hover:text-primary">
                                            {{ prompt.title }}
                                        </a>
                                    </h3>
                                    <p class="text-base-content/70 text-sm mb-4">{{ prompt.short_description }}</p>

                                    <!-- Category and Type -->
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="text-xs text-base-content/60">{{ prompt.get_prompt_type_display }}</span>
                                        <span class="text-xs text-base-content/40">•</span>
                                        <span class="text-xs text-base-content/60">{{ prompt.category.name }}</span>
                                    </div>

                                    <!-- Tags -->
                                    {% if prompt.tags.all %}
                                        <div class="flex flex-wrap gap-1 mb-4">
                                            {% for tag in prompt.tags.all|slice:":3" %}
                                                <span class="badge badge-outline badge-xs" style="border-color: {{ tag.color }}; color: {{ tag.color }};">
                                                    {{ tag.name }}
                                                </span>
                                            {% endfor %}
                                            {% if prompt.tags.count > 3 %}
                                                <span class="badge badge-outline badge-xs">+{{ prompt.tags.count|add:"-3" }}</span>
                                            {% endif %}
                                        </div>
                                    {% endif %}

                                    <!-- Stats and Author -->
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4 text-xs text-base-content/60">
                                            <span class="flex items-center gap-1">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                </svg>
                                                {{ prompt.usage_count }}
                                            </span>
                                            {% if prompt.average_rating > 0 %}
                                                <span class="flex items-center gap-1">
                                                    <svg class="w-3 h-3 text-warning" fill="currentColor" viewBox="0 0 24 24">
                                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                                    </svg>
                                                    {{ prompt.average_rating|floatformat:1 }}
                                                </span>
                                            {% endif %}
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="avatar">
                                                <div class="w-6 h-6 rounded-full bg-primary text-primary-content text-xs flex items-center justify-center">
                                                    {{ prompt.author.username|first|upper }}
                                                </div>
                                            </div>
                                            <span class="text-xs text-base-content/60">@{{ prompt.author.username }}</span>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="card-actions justify-end mt-4">
                                        <a href="{% url 'prompts:prompt_detail' prompt.slug %}" class="btn btn-primary btn-sm">
                                            View & Test
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Pagination -->
                    {% if page_obj.has_other_pages %}
                        <div class="flex justify-center mt-8">
                            <div class="join">
                                {% if page_obj.has_previous %}
                                    <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="join-item btn">«</a>
                                {% endif %}
                                
                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <span class="join-item btn btn-active">{{ num }}</span>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="join-item btn">{{ num }}</a>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if page_obj.has_next %}
                                    <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="join-item btn">»</a>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-base-content/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                        <h3 class="text-xl font-semibold mb-2">No prompts found</h3>
                        <p class="text-base-content/60 mb-4">Try adjusting your search criteria or create the first prompt!</p>
                        {% if user.is_authenticated %}
                            <a href="{% url 'prompts:prompt_create' %}" class="btn btn-primary">
                                Create First Prompt
                            </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### prompts/templates/prompts/my_prompts.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}My Prompts{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">My Prompts</h1>
                    <p class="mt-2 text-gray-600">Manage and organize your personal prompt collection</p>
                </div>
                <a href="{% url 'prompts:prompt_create' %}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create New Prompt
                </a>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-6 w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Total Prompts</dt>
                                <dd class="text-lg font-medium text-gray-900">{{ page_obj.paginator.count }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Public Prompts</dt>
                                <dd class="text-lg font-medium text-gray-900">{{ page_obj.paginator.count|default:0 }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Total Usage</dt>
                                <dd class="text-lg font-medium text-gray-900">0</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompts Grid -->
        {% if page_obj %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for prompt in page_obj %}
                <div class="bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow duration-200">
                    <div class="p-6">
                        <!-- Prompt Header -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                    <a href="{% url 'prompts:prompt_detail' prompt.slug %}" class="hover:text-indigo-600">
                                        {{ prompt.title }}
                                    </a>
                                </h3>
                                <div class="flex items-center text-sm text-gray-500">
                                    <span class="mr-3">
                                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        {{ prompt.created_at|date:"M j, Y" }}
                                    </span>
                                    {% if prompt.is_public %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            Public
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                            Private
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Prompt Content Preview -->
                        <div class="mb-4">
                            <p class="text-gray-600 text-sm line-clamp-3">
                                {{ prompt.content|truncatewords:20 }}
                            </p>
                        </div>

                        <!-- Tags -->
                        {% if prompt.tags.all %}
                        <div class="mb-4">
                            <div class="flex flex-wrap gap-1">
                                {% for tag in prompt.tags.all|slice:":3" %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                    {{ tag.name }}
                                </span>
                                {% endfor %}
                                {% if prompt.tags.count > 3 %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600">
                                    +{{ prompt.tags.count|add:"-3" }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Actions -->
                        <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                            <div class="flex items-center space-x-2">
                                <a href="{% url 'prompts:prompt_detail' prompt.slug %}" 
                                   class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                    View Details
                                </a>
                                <span class="text-gray-300">•</span>
                                <a href="{% url 'prompts:prompt_edit' prompt.slug %}" 
                                   class="text-sm text-gray-600 hover:text-gray-800">
                                    Edit
                                </a>
                            </div>
                            <div class="flex items-center text-sm text-gray-500">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                {{ prompt.views|default:0 }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if page_obj.has_other_pages %}
            <div class="mt-8 flex items-center justify-center">
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}" 
                           class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Previous</span>
                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                        </a>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-indigo-50 text-sm font-medium text-indigo-600">
                                {{ num }}
                            </span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <a href="?page={{ num }}" 
                               class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                                {{ num }}
                            </a>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" 
                           class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Next</span>
                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                            </svg>
                        </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}

        {% else %}
            <!-- Empty State -->
            <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No prompts yet</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by creating your first prompt.</p>
                <div class="mt-6">
                    <a href="{% url 'prompts:prompt_create' %}" 
                       class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Create Your First Prompt
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %} 
```

### prompts/templates/prompts/tag_detail.html
```python
{% extends "base.html" %}

{% block title %}{{ tag.name }} - Prompts{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <div class="mb-6">
        <div class="flex items-center gap-3 mb-4">
            <div class="badge badge-lg" style="background-color: {{ tag.color }}; color: white;">
                {{ tag.name }}
            </div>
            <h1 class="text-2xl font-bold">{{ tag.name }}</h1>
        </div>
        <p class="text-base-content/70">
            {{ page_obj.paginator.count }} prompt{{ page_obj.paginator.count|pluralize }} tagged with "{{ tag.name }}"
        </p>
    </div>

    {% if page_obj %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for prompt in page_obj %}
                <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
                    <div class="card-body">
                        <h2 class="card-title">
                            <a href="{{ prompt.get_absolute_url }}" class="hover:text-primary">
                                {{ prompt.title }}
                            </a>
                        </h2>
                        <p class="text-base-content/70">{{ prompt.short_description }}</p>

                        <div class="flex flex-wrap gap-2 mt-3">
                            <span class="badge badge-outline">{{ prompt.category.name }}</span>
                            <span class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.difficulty|title }}</span>
                            {% if prompt.is_featured %}
                                <span class="badge badge-primary">Featured</span>
                            {% endif %}
                        </div>

                        <div class="flex justify-between items-center mt-4 text-sm text-base-content/60">
                            <span>By {{ prompt.author.username }}</span>
                            <span>{{ prompt.created_at|date:"M j, Y" }}</span>
                        </div>

                        <div class="card-actions justify-end mt-4">
                            <a href="{{ prompt.get_absolute_url }}" class="btn btn-primary btn-sm">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
            <div class="flex justify-center mt-8">
                <div class="join">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}" class="join-item btn">«</a>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <span class="join-item btn btn-active">{{ num }}</span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <a href="?page={{ num }}" class="join-item btn">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="join-item btn">»</a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">🏷️</div>
            <h2 class="text-xl font-semibold mb-2">No prompts found</h2>
            <p class="text-base-content/70 mb-6">
                No prompts are currently tagged with "{{ tag.name }}"
            </p>
            <a href="{% url 'prompts:prompt_list' %}" class="btn btn-primary">
                Browse All Prompts
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
```

### prompts/templates/prompts/category_detail.html
```python
{% extends "base.html" %}

{% block title %}{{ category.name }} - Prompts{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <div class="mb-6">
        <div class="flex items-center gap-3 mb-4">
            <div class="badge badge-lg" style="background-color: {{ category.color }}; color: white;">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                {{ category.name }}
            </div>
            <h1 class="text-2xl font-bold">{{ category.name }}</h1>
        </div>
        {% if category.description %}
            <p class="text-base-content/70 mb-4">{{ category.description }}</p>
        {% endif %}
        <p class="text-base-content/70">
            {{ page_obj.paginator.count }} prompt{{ page_obj.paginator.count|pluralize }} in this category
        </p>
    </div>

    {% if page_obj %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for prompt in page_obj %}
                <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
                    <div class="card-body">
                        <h2 class="card-title">
                            <a href="{{ prompt.get_absolute_url }}" class="hover:text-primary">
                                {{ prompt.title }}
                            </a>
                        </h2>
                        <p class="text-base-content/70">{{ prompt.short_description }}</p>

                        <div class="flex flex-wrap gap-2 mt-3">
                            <span class="badge badge-outline">{{ prompt.category.name }}</span>
                            <span class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.difficulty|title }}</span>
                            {% if prompt.is_featured %}
                                <span class="badge badge-primary">Featured</span>
                            {% endif %}
                        </div>

                        <div class="flex justify-between items-center mt-4 text-sm text-base-content/60">
                            <span>By {{ prompt.author.username }}</span>
                            <span>{{ prompt.created_at|date:"M j, Y" }}</span>
                        </div>

                        <div class="card-actions justify-end mt-4">
                            <a href="{{ prompt.get_absolute_url }}" class="btn btn-primary btn-sm">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
            <div class="flex justify-center mt-8">
                <div class="join">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}" class="join-item btn">«</a>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <span class="join-item btn btn-active">{{ num }}</span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <a href="?page={{ num }}" class="join-item btn">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="join-item btn">»</a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📁</div>
            <h2 class="text-xl font-semibold mb-2">No prompts found</h2>
            <p class="text-base-content/70 mb-6">
                No prompts are currently in the "{{ category.name }}" category
            </p>
            <a href="{% url 'prompts:prompt_list' %}" class="btn btn-primary">
                Browse All Prompts
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
```

### prompts/templates/prompts/prompt_detail.html
```python
{% extends "base.html" %}

{% block title %}{{ prompt.title }} - Prompt Details{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
            <h1 class="text-3xl font-bold">{{ prompt.title }}</h1>
            <div class="flex gap-2">
                {% if user == prompt.author or user.is_staff %}
                    <a href="{% url 'prompts:prompt_edit' slug=prompt.slug %}" class="btn btn-outline btn-sm">
                        Edit
                    </a>
                    <a href="{% url 'prompts:prompt_delete' slug=prompt.slug %}" class="btn btn-error btn-sm">
                        Delete
                    </a>
                {% endif %}
            </div>
        </div>

        <div class="flex flex-wrap gap-2 mb-4">
            <span class="badge badge-outline">{{ prompt.category.name }}</span>
            <span class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.difficulty|title }}</span>
            <span class="badge badge-primary">{{ prompt.prompt_type|title }}</span>
            {% if prompt.is_featured %}
                <span class="badge badge-secondary">Featured</span>
            {% endif %}
            {% if prompt.is_template %}
                <span class="badge badge-accent">Template</span>
            {% endif %}
        </div>

        <p class="text-base-content/70 text-lg">{{ prompt.description }}</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Main Content -->
        <div class="space-y-6">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Prompt Content</h2>
                    <div class="bg-base-200 p-4 rounded-lg">
                        <pre class="whitespace-pre-wrap text-sm">{{ prompt.content }}</pre>
                    </div>
                </div>
            </div>

            {% if prompt.example_input or prompt.example_output %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">Examples</h2>
                        {% if prompt.example_input %}
                            <div class="mb-4">
                                <h3 class="font-semibold mb-2">Input Example:</h3>
                                <div class="bg-base-200 p-3 rounded">
                                    <pre class="whitespace-pre-wrap text-sm">{{ prompt.example_input }}</pre>
                                </div>
                            </div>
                        {% endif %}
                        {% if prompt.example_output %}
                            <div>
                                <h3 class="font-semibold mb-2">Output Example:</h3>
                                <div class="bg-base-200 p-3 rounded">
                                    <pre class="whitespace-pre-wrap text-sm">{{ prompt.example_output }}</pre>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {% if prompt.context_notes %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">Context Notes</h2>
                        <p class="text-base-content/70">{{ prompt.context_notes }}</p>
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Prompt Information</h2>
                    <div class="space-y-3">
                        <div>
                            <span class="font-semibold">Author:</span>
                            <span>{{ prompt.author.username }}</span>
                        </div>
                        <div>
                            <span class="font-semibold">Created:</span>
                            <span>{{ prompt.created_at|date:"M j, Y" }}</span>
                        </div>
                        <div>
                            <span class="font-semibold">Last Updated:</span>
                            <span>{{ prompt.updated_at|date:"M j, Y" }}</span>
                        </div>
                        <div>
                            <span class="font-semibold">Usage Count:</span>
                            <span>{{ prompt.usage_count }}</span>
                        </div>
                        {% if prompt.average_rating > 0 %}
                            <div>
                                <span class="font-semibold">Rating:</span>
                                <span>{{ prompt.average_rating|floatformat:1 }}/5.0</span>
                            </div>
                        {% endif %}
                        {% if prompt.success_rate > 0 %}
                            <div>
                                <span class="font-semibold">Success Rate:</span>
                                <span>{{ prompt.success_rate|floatformat:1 }}%</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if prompt.tags.all %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">Tags</h2>
                        <div class="flex flex-wrap gap-2">
                            {% for tag in prompt.tags.all %}
                                <span class="badge badge-outline" style="border-color: {{ tag.color }}; color: {{ tag.color }};">
                                    {{ tag.name }}
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if related_prompts %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">Related Prompts</h2>
                        <div class="space-y-2">
                            {% for related in related_prompts %}
                                <a href="{{ related.get_absolute_url }}" class="block p-2 hover:bg-base-200 rounded">
                                    <div class="font-medium">{{ related.title }}</div>
                                    <div class="text-sm text-base-content/60">{{ related.short_description }}</div>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
```

### prompts/templates/prompts/prompt_list_simple.html
```python
{% extends "base.html" %}

{% block title %}AI Prompts - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-4">AI Prompts</h1>
        <p class="text-lg mb-6">Discover and test powerful AI prompts</p>
        
        {% if user.is_authenticated %}
            <div class="mb-6">
                <a href="{% url 'prompts:prompt_create' %}" class="btn btn-primary">
                    Create Prompt
                </a>
                <a href="{% url 'prompts:my_prompts' %}" class="btn btn-outline ml-2">
                    My Prompts
                </a>
            </div>
        {% endif %}
        
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">All Prompts</h2>
                
                {% if page_obj %}
                    <div class="space-y-4">
                        {% for prompt in page_obj %}
                            <div class="border-b border-base-300 pb-4 last:border-b-0">
                                <h3 class="text-lg font-semibold">{{ prompt.title }}</h3>
                                <p class="text-base-content/70">{{ prompt.short_description }}</p>
                                <div class="flex items-center gap-2 mt-2">
                                    <span class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.get_difficulty_display }}</span>
                                    <span class="text-sm text-base-content/60">by @{{ prompt.author.username }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <p class="text-base-content/60">No prompts found.</p>
                        {% if user.is_authenticated %}
                            <a href="{% url 'prompts:prompt_create' %}" class="btn btn-primary mt-4">
                                Create First Prompt
                            </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### prompts/templates/prompts/test.html
```python
{% extends "base.html" %}

{% block title %}Test - Prompts{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-4">Prompts Test Page</h1>
        <p class="text-lg">If you can see this, the template loading is working!</p>
        <a href="{% url 'prompts:prompt_list' %}" class="btn btn-primary mt-4">Back to Prompts</a>
    </div>
</div>
{% endblock %} 
```

### prompts/templates/prompts/collections.html
```python
{% extends "base.html" %}

{% block title %}My Collections - Prompts{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">My Collections</h1>
        <a href="{% url 'prompts:collection_create' %}" class="btn btn-primary">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Create Collection
        </a>
    </div>

    {% if collections %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for collection in collections %}
                <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
                    <div class="card-body">
                        <h2 class="card-title">
                            <a href="{{ collection.get_absolute_url }}" class="hover:text-primary">
                                {{ collection.name }}
                            </a>
                        </h2>
                        {% if collection.description %}
                            <p class="text-base-content/70">{{ collection.description|truncatechars:100 }}</p>
                        {% endif %}

                        <div class="flex items-center gap-2 mt-3">
                            <span class="badge badge-outline">{{ collection.prompts.count }} prompts</span>
                            {% if collection.is_public %}
                                <span class="badge badge-success">Public</span>
                            {% else %}
                                <span class="badge badge-warning">Private</span>
                            {% endif %}
                        </div>

                        <div class="flex justify-between items-center mt-4 text-sm text-base-content/60">
                            <span>Created {{ collection.created_at|date:"M j, Y" }}</span>
                            <span>Updated {{ collection.updated_at|date:"M j, Y" }}</span>
                        </div>

                        <div class="card-actions justify-end mt-4">
                            <a href="{{ collection.get_absolute_url }}" class="btn btn-primary btn-sm">
                                View Collection
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📚</div>
            <h2 class="text-xl font-semibold mb-2">No collections yet</h2>
            <p class="text-base-content/70 mb-6">
                Create your first collection to organize your prompts
            </p>
            <a href="{% url 'prompts:collection_create' %}" class="btn btn-primary">
                Create Your First Collection
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
```

### prompts/templates/prompts/collection_detail.html
```python
{% extends "base.html" %}

{% block title %}{{ collection.name }} - Collection{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
            <h1 class="text-3xl font-bold">{{ collection.name }}</h1>
            <div class="flex gap-2">
                {% if user == collection.owner %}
                    <a href="#" class="btn btn-outline btn-sm">Edit</a>
                    <a href="#" class="btn btn-error btn-sm">Delete</a>
                {% endif %}
            </div>
        </div>

        {% if collection.description %}
            <p class="text-base-content/70 text-lg mb-4">{{ collection.description }}</p>
        {% endif %}

        <div class="flex items-center gap-4 text-sm text-base-content/60">
            <span>By {{ collection.owner.username }}</span>
            <span>Created {{ collection.created_at|date:"M j, Y" }}</span>
            <span>Updated {{ collection.updated_at|date:"M j, Y" }}</span>
            {% if collection.is_public %}
                <span class="badge badge-success">Public</span>
            {% else %}
                <span class="badge badge-warning">Private</span>
            {% endif %}
        </div>
    </div>

    {% if collection.prompts.all %}
        <div class="mb-6">
            <h2 class="text-2xl font-bold mb-4">{{ collection.prompts.count }} Prompt{{ collection.prompts.count|pluralize }}</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for prompt in collection.prompts.all %}
                    <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
                        <div class="card-body">
                            <h3 class="card-title">
                                <a href="{{ prompt.get_absolute_url }}" class="hover:text-primary">
                                    {{ prompt.title }}
                                </a>
                            </h3>
                            <p class="text-base-content/70">{{ prompt.short_description }}</p>

                            <div class="flex flex-wrap gap-2 mt-3">
                                <span class="badge badge-outline">{{ prompt.category.name }}</span>
                                <span class="badge badge-{{ prompt.difficulty_color }}">{{ prompt.difficulty|title }}</span>
                                {% if prompt.is_featured %}
                                    <span class="badge badge-primary">Featured</span>
                                {% endif %}
                            </div>

                            <div class="flex justify-between items-center mt-4 text-sm text-base-content/60">
                                <span>By {{ prompt.author.username }}</span>
                                <span>{{ prompt.created_at|date:"M j, Y" }}</span>
                            </div>

                            <div class="card-actions justify-end mt-4">
                                <a href="{{ prompt.get_absolute_url }}" class="btn btn-primary btn-sm">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📚</div>
            <h2 class="text-xl font-semibold mb-2">No prompts in this collection</h2>
            <p class="text-base-content/70 mb-6">
                This collection is empty. Add some prompts to get started.
            </p>
            {% if user == collection.owner %}
                <a href="{% url 'prompts:prompt_create' %}" class="btn btn-primary">
                    Create Your First Prompt
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
```

### App: files
### files/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.urls import reverse
import os

# Create your models here.

class File(models.Model):
    title = models.CharField(max_length=255)
    description = models.TextField(blank=True, null=True)
    file = models.FileField(upload_to='files/')
    uploaded_by = models.ForeignKey(User, on_delete=models.CASCADE)
    uploaded_at = models.DateTimeField(auto_now_add=True)
    file_size = models.BigIntegerField(blank=True, null=True)

    def __str__(self):
        return self.title

    def get_absolute_url(self):
        return reverse('files:file_detail', kwargs={'file_id': self.pk})

    def save(self, *args, **kwargs):
        # Calculate file size before saving
        if self.file:
            self.file_size = self.file.size
        super().save(*args, **kwargs)

    def filename(self):
        return os.path.basename(self.file.name)

    def file_extension(self):
        name, extension = os.path.splitext(self.file.name)
        return extension.lower()

    def is_image(self):
        image_extensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp']
        return self.file_extension() in image_extensions

    def is_pdf(self):
        return self.file_extension() == '.pdf'

    def is_document(self):
        doc_extensions = ['.doc', '.docx', '.txt', '.rtf']
        return self.file_extension() in doc_extensions

    def is_spreadsheet(self):
        spreadsheet_extensions = ['.xls', '.xlsx', '.csv']
        return self.file_extension() in spreadsheet_extensions

```

### files/views.py
```python
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from django.http import HttpResponse, Http404
from django.conf import settings
from .models import File
from .forms import FileUploadForm
import os

# image views
def files(request):
    return render(request, 'files/files.html')

@login_required
def file_list(request):
    """Display list of uploaded files"""
    files = File.objects.filter(uploaded_by=request.user).order_by('-uploaded_at')
    return render(request, 'files/file_list.html', {'files': files})

@login_required
def file_upload(request):
    """Handle file upload"""
    if request.method == 'POST':
        form = FileUploadForm(request.POST, request.FILES)
        if form.is_valid():
            file_obj = form.save(commit=False)
            file_obj.uploaded_by = request.user
            file_obj.save()
            messages.success(request, f'File "{file_obj.title}" uploaded successfully!')
            return redirect('files:file_list')
    else:
        form = FileUploadForm()

    return render(request, 'files/file_upload.html', {'form': form})

@login_required
def file_detail(request, file_id):
    """Display file details"""
    file_obj = get_object_or_404(File, id=file_id, uploaded_by=request.user)
    return render(request, 'files/file_detail.html', {'file': file_obj})

@login_required
def file_download(request, file_id):
    """Download a file"""
    file_obj = get_object_or_404(File, id=file_id, uploaded_by=request.user)

    # Check if file exists
    if not os.path.exists(file_obj.file.path):
        raise Http404("File not found")

    # Open and serve the file
    with open(file_obj.file.path, 'rb') as f:
        response = HttpResponse(f.read(), content_type='application/octet-stream')
        response['Content-Disposition'] = f'attachment; filename="{file_obj.filename()}"'
        return response

@login_required
def file_delete(request, file_id):
    """Delete a file"""
    file_obj = get_object_or_404(File, id=file_id, uploaded_by=request.user)

    if request.method == 'POST':
        title = file_obj.title
        file_obj.delete()
        messages.success(request, f'File "{title}" deleted successfully!')
        return redirect('files:file_list')

    return render(request, 'files/file_delete.html', {'file': file_obj})

```

### files/urls.py
```python
from django.urls import path
from . import views

app_name = 'files'

urlpatterns = [
    path('', views.file_list, name='file_list'),
    path('upload/', views.file_upload, name='file_upload'),
    path('<int:file_id>/', views.file_detail, name='file_detail'),
    path('<int:file_id>/download/', views.file_download, name='file_download'),
    path('<int:file_id>/delete/', views.file_delete, name='file_delete'),
]

```

### files/forms.py
```python
from django import forms
from .models import File

class FileUploadForm(forms.ModelForm):
    class Meta:
        model = File
        fields = ['title', 'description', 'file']
        widgets = {
            'title': forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
            'description': forms.Textarea(attrs={'class': 'textarea textarea-bordered w-full', 'rows': 3}),
            'file': forms.FileInput(attrs={'class': 'file-input file-input-bordered w-full'}),
        }
    
    def clean_file(self):
        file = self.cleaned_data.get('file')
        if file:
            # Check file size (max 50MB)
            if file.size > 50 * 1024 * 1024:
                raise forms.ValidationError("File size must be under 50MB.")
            
            # Check file extension
            allowed_extensions = [
                '.pdf', '.doc', '.docx', '.txt', '.rtf',
                '.xls', '.xlsx', '.csv',
                '.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp',
                '.zip', '.rar', '.7z',
                '.mp3', '.mp4', '.avi', '.mov'
            ]
            
            import os
            ext = os.path.splitext(file.name)[1].lower()
            if ext not in allowed_extensions:
                raise forms.ValidationError(f"File type {ext} is not allowed.")
        
        return file 
```

### files/admin.py
```python
from django.contrib import admin
from .models import File

@admin.register(File)
class FileAdmin(admin.ModelAdmin):
    list_display = ('title', 'uploaded_by', 'uploaded_at', 'file_size', 'file_extension')
    list_filter = ('uploaded_at', 'uploaded_by')
    search_fields = ('title', 'description', 'uploaded_by__username')
    readonly_fields = ('uploaded_at', 'file_size')
    date_hierarchy = 'uploaded_at'
    
    def file_extension(self, obj):
        return obj.file_extension()
    file_extension.short_description = 'Type'

```

### files/apps.py
```python
from django.apps import AppConfig


class FilesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'files'

```

### files/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in files
### files/templates/files/file_detail.html
```python
{% extends "base.html" %}

{% block title %}{{ file.title }} - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'files:file_list' %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to Files
                </a>
                <h1 class="text-3xl font-bold text-base-content">{{ file.title }}</h1>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- File Preview -->
            <div class="lg:col-span-2">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">File Preview</h2>
                        
                        <div class="flex items-center justify-center p-8 bg-base-200 rounded-lg">
                            <div class="text-center">
                                <div class="avatar placeholder mb-4">
                                    <div class="bg-neutral text-neutral-content rounded-full w-24">
                                        <span class="text-4xl font-bold">
                                            {% if file.is_image %}
                                                🖼️
                                            {% elif file.is_pdf %}
                                                📄
                                            {% elif file.is_document %}
                                                📝
                                            {% elif file.is_spreadsheet %}
                                                📊
                                            {% else %}
                                                📁
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <h3 class="text-lg font-semibold mb-2">{{ file.filename }}</h3>
                                <p class="text-base-content/70 mb-4">{{ file.file_extension|upper }} File</p>
                                
                                {% if file.is_image %}
                                    <img src="{{ file.file.url }}" alt="{{ file.title }}" class="max-w-full h-auto rounded-lg shadow-lg">
                                {% else %}
                                    <p class="text-base-content/60">Preview not available for this file type</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-4 mt-6">
                            <a href="{% url 'files:file_download' file.id %}" class="btn btn-primary">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                Download File
                            </a>
                            
                            {% if user == file.uploaded_by or user.is_staff %}
                                <a href="{% url 'files:file_delete' file.id %}" class="btn btn-error">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Delete File
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Information -->
            <div class="lg:col-span-1">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">File Information</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Title</span>
                                </label>
                                <p class="text-base-content">{{ file.title }}</p>
                            </div>
                            
                            {% if file.description %}
                                <div>
                                    <label class="label">
                                        <span class="label-text font-semibold">Description</span>
                                    </label>
                                    <p class="text-base-content">{{ file.description }}</p>
                                </div>
                            {% endif %}
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Filename</span>
                                </label>
                                <p class="text-base-content font-mono text-sm">{{ file.filename }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">File Type</span>
                                </label>
                                <p class="text-base-content">{{ file.file_extension|upper }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">File Size</span>
                                </label>
                                <p class="text-base-content">{{ file.file_size|filesizeformat }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Uploaded By</span>
                                </label>
                                <p class="text-base-content">{{ file.uploaded_by.username }}</p>
                            </div>
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Upload Date</span>
                                </label>
                                <p class="text-base-content">{{ file.uploaded_at|date:"F d, Y \a\t g:i A" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### files/templates/files/file_upload.html
```python
{% extends "base.html" %}

{% block title %}Upload File - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-base-content">Upload File</h1>
            <p class="text-base-content/70 mt-2">Upload a new file to your collection</p>
        </div>

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                        <div class="alert alert-error mb-6">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>Please correct the errors below.</span>
                        </div>
                    {% endif %}

                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">File Title *</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.title.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">Description</span>
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.description.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">Select File *</span>
                        </label>
                        {{ form.file }}
                        {% if form.file.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.file.errors.0 }}</span>
                            </label>
                        {% endif %}
                        <label class="label">
                            <span class="label-text-alt text-base-content/60">
                                Maximum file size: 50MB. Allowed types: PDF, DOC, DOCX, TXT, RTF, XLS, XLSX, CSV, JPG, PNG, GIF, ZIP, RAR, 7Z, MP3, MP4, AVI, MOV
                            </span>
                        </label>
                    </div>

                    <div class="card-actions justify-end">
                        <a href="{% url 'files:file_list' %}" class="btn btn-outline">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            Upload File
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### files/templates/files/file_delete.html
```python
{% extends "base.html" %}

{% block title %}Delete File - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'files:file_detail' file.id %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to File
                </a>
                <h1 class="text-3xl font-bold text-error">Delete File</h1>
            </div>
        </div>

        <div class="card bg-base-100 shadow-xl border-l-4 border-error">
            <div class="card-body">
                <div class="flex items-center mb-6">
                    <div class="avatar placeholder mr-4">
                        <div class="bg-error text-error-content rounded-full w-16">
                            <span class="text-2xl">⚠️</span>
                        </div>
                    </div>
                    <div>
                        <h2 class="card-title text-xl text-error">Confirm Deletion</h2>
                        <p class="text-base-content/70">This action cannot be undone.</p>
                    </div>
                </div>

                <div class="alert alert-warning mb-6">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                    <span>Are you sure you want to delete "{{ file.title }}"?</span>
                </div>

                <div class="bg-base-200 p-4 rounded-lg mb-6">
                    <h3 class="font-semibold mb-2">File Details:</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="font-medium">Title:</span>
                            <p>{{ file.title }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Filename:</span>
                            <p class="font-mono">{{ file.filename }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Size:</span>
                            <p>{{ file.file_size|filesizeformat }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Type:</span>
                            <p>{{ file.file_extension|upper }}</p>
                        </div>
                        <div>
                            <span class="font-medium">Uploaded:</span>
                            <p>{{ file.uploaded_at|date:"M d, Y" }}</p>
                        </div>
                        <div>
                            <span class="font-medium">By:</span>
                            <p>{{ file.uploaded_by.username }}</p>
                        </div>
                    </div>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="card-actions justify-end">
                        <a href="{% url 'files:file_detail' file.id %}" class="btn btn-outline">Cancel</a>
                        <button type="submit" class="btn btn-error">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            Delete File
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### files/templates/files/file_list.html
```python
{% extends "base.html" %}

{% block title %}Files - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-base-content">File Management</h1>
            <p class="text-base-content/70 mt-2">Upload and manage your files</p>
        </div>
        <a href="{% url 'files:file_upload' %}" class="btn btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Upload File
        </a>
    </div>

    {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}error{% else %}success{% endif %} mb-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        {% if message.tags == 'error' %}
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        {% else %}
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        {% endif %}
                    </svg>
                    <span>{{ message }}</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% if files %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for file in files %}
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <div class="flex items-center mb-4">
                            <div class="avatar placeholder mr-4">
                                <div class="bg-neutral text-neutral-content rounded-full w-12">
                                    <span class="text-lg font-bold">
                                        {% if file.is_image %}
                                            🖼️
                                        {% elif file.is_pdf %}
                                            📄
                                        {% elif file.is_document %}
                                            📝
                                        {% elif file.is_spreadsheet %}
                                            📊
                                        {% else %}
                                            📁
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="flex-1">
                                <h2 class="card-title text-lg">{{ file.title }}</h2>
                                <p class="text-sm text-base-content/70">{{ file.filename }}</p>
                            </div>
                        </div>
                        
                        {% if file.description %}
                            <p class="text-sm text-base-content/80 mb-4">{{ file.description|truncatewords:20 }}</p>
                        {% endif %}
                        
                        <div class="text-xs text-base-content/60 mb-4">
                            <div class="flex justify-between">
                                <span>Size: {{ file.file_size|filesizeformat }}</span>
                                <span>Type: {{ file.file_extension|upper }}</span>
                            </div>
                            <div class="flex justify-between mt-1">
                                <span>By: {{ file.uploaded_by.username }}</span>
                                <span>{{ file.uploaded_at|date:"M d, Y" }}</span>
                            </div>
                        </div>
                        
                        <div class="card-actions justify-end">
                            <a href="{% url 'files:file_detail' file.id %}" class="btn btn-sm btn-outline">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                View
                            </a>
                            <a href="{% url 'files:file_download' file.id %}" class="btn btn-sm btn-primary">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                Download
                            </a>
                            {% if user == file.uploaded_by or user.is_staff %}
                                <a href="{% url 'files:file_delete' file.id %}" class="btn btn-sm btn-error">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Delete
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="avatar placeholder mb-4">
                <div class="bg-neutral text-neutral-content rounded-full w-24">
                    <span class="text-4xl">📁</span>
                </div>
            </div>
            <h3 class="text-xl font-semibold mb-2">No files uploaded yet</h3>
            <p class="text-base-content/70 mb-6">Start by uploading your first file</p>
            <a href="{% url 'files:file_upload' %}" class="btn btn-primary">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                Upload Your First File
            </a>
        </div>
    {% endif %}
</div>
{% endblock %} 
```

### App: surveys
### surveys/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.core.validators import MinValueValidator, MaxValueValidator
from django.utils import timezone
from django.urls import reverse
import json


class Survey(models.Model):
    STATUS_CHOICES = [
        ('DRAFT', 'Draft'),
        ('PUBLISHED', 'Published'),
        ('CLOSED', 'Closed'),
        ('ARCHIVED', 'Archived'),
    ]
    
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    publish_start = models.DateTimeField()
    publish_end = models.DateTimeField()
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='DRAFT')
    created_by = models.ForeignKey(User, on_delete=models.CASCADE, related_name='created_surveys')
    k_threshold = models.IntegerField(default=5, validators=[MinValueValidator(1)])
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        ordering = ['-created_at']
    
    def __str__(self):
        return self.title
    
    def get_absolute_url(self):
        return reverse('surveys:survey_detail', kwargs={'pk': self.pk})
    
    @property
    def is_active(self):
        now = timezone.now()
        return (self.status == 'PUBLISHED' and 
                self.publish_start <= now <= self.publish_end)
    
    @property
    def response_count(self):
        return self.responses.count()
    
    @property
    def sections_count(self):
        return self.sections.count()


class Section(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='sections')
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    order = models.IntegerField(default=0)
    
    class Meta:
        ordering = ['order']
        unique_together = ['survey', 'order']
    
    def __str__(self):
        return f"{self.survey.title} - {self.title}"
    
    def get_absolute_url(self):
        return reverse('surveys:section_detail', kwargs={'pk': self.pk})


class Question(models.Model):
    QUESTION_TYPES = [
        ('LIKERT', 'Likert Scale'),
        ('MULTI', 'Multiple Choice'),
        ('SINGLE', 'Single Choice'),
        ('MATRIX', 'Matrix Question'),
        ('SHORT_TEXT', 'Short Text'),
        ('LONG_TEXT', 'Long Text'),
        ('NPS', 'Net Promoter Score'),
        ('RANK', 'Ranking'),
        ('DATE', 'Date'),
        ('NUMBER', 'Number'),
    ]
    
    ANONYMITY_MODES = [
        ('ANONYMOUS', 'Anonymous'),
        ('ESCROW', 'Private (Escrow)'),
        ('SIGNED', 'Signed'),
    ]
    
    section = models.ForeignKey(Section, on_delete=models.CASCADE, related_name='questions')
    type = models.CharField(max_length=20, choices=QUESTION_TYPES)
    prompt = models.TextField()
    help_text = models.TextField(blank=True)
    required = models.BooleanField(default=True)
    options_json = models.JSONField(default=dict, blank=True)  # For choices, matrix options, etc.
    scale_min = models.IntegerField(default=1, validators=[MinValueValidator(0)])
    scale_max = models.IntegerField(default=5, validators=[MaxValueValidator(10)])
    order = models.IntegerField(default=0)
    logic_json = models.JSONField(default=dict, blank=True)  # For conditional logic
    anonymity_mode = models.CharField(max_length=20, choices=ANONYMITY_MODES, default='ESCROW')
    
    class Meta:
        ordering = ['order']
        unique_together = ['section', 'order']
    
    def __str__(self):
        return f"{self.section.title} - {self.prompt[:50]}..."
    
    def get_absolute_url(self):
        return reverse('surveys:question_detail', kwargs={'pk': self.pk})
    
    @property
    def options(self):
        """Get options as a list, handling both list and dict formats"""
        if isinstance(self.options_json, list):
            return self.options_json
        elif isinstance(self.options_json, dict):
            return self.options_json.get('choices', [])
        return []
    
    @property
    def is_scale_question(self):
        """Check if this is a scale-based question (Likert, NPS, Number)"""
        return self.type in ['LIKERT', 'NPS', 'NUMBER']

    @property
    def scale_values(self):
        """List of integer options for scale questions."""
        try:
            start = int(self.scale_min)
            end = int(self.scale_max)
            if end < start:
                start, end = end, start
            return list(range(start, end + 1))
        except Exception:
            return []


class Response(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='responses')
    identity_user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='survey_responses')
    submitted_at = models.DateTimeField(auto_now_add=True)
    cohort_json = models.JSONField(default=dict, blank=True)  # For demographic/cohort data
    meta_json = models.JSONField(default=dict, blank=True)  # For additional metadata
    
    class Meta:
        ordering = ['-submitted_at']
        unique_together = ['survey', 'identity_user']  # One response per user per survey
    
    def __str__(self):
        user_id = self.identity_user.username if self.identity_user else 'Anonymous'
        return f"{self.survey.title} - {user_id} - {self.submitted_at.strftime('%Y-%m-%d %H:%M')}"
    
    def get_absolute_url(self):
        return reverse('surveys:response_detail', kwargs={'pk': self.pk})
    
    @property
    def is_anonymous(self):
        """Check if this response is completely anonymous"""
        return self.identity_user is None
    
    @property
    def answers_count(self):
        return self.answers.count()


class Answer(models.Model):
    MODERATION_STATUS = [
        ('OK', 'OK'),
        ('FLAGGED', 'Flagged for Review'),
        ('REDACTED', 'Redacted'),
    ]
    
    response = models.ForeignKey(Response, on_delete=models.CASCADE, related_name='answers')
    question = models.ForeignKey(Question, on_delete=models.CASCADE, related_name='answers')
    value_text = models.TextField(blank=True)
    value_number = models.FloatField(null=True, blank=True)
    value_json = models.JSONField(default=dict, blank=True)  # For complex answers (matrix, ranking, etc.)
    is_signed = models.BooleanField(default=False)
    signed_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='signed_answers')
    followup_opt_in = models.BooleanField(default=False)
    preferred_contact = models.TextField(blank=True)
    moderation_status = models.CharField(max_length=20, choices=MODERATION_STATUS, default='OK')
    flags_json = models.JSONField(default=dict, blank=True)  # For moderation flags
    
    class Meta:
        unique_together = ['response', 'question']
    
    def __str__(self):
        return f"{self.question.prompt[:30]}... - {self.response}"
    
    def get_absolute_url(self):
        return reverse('surveys:answer_detail', kwargs={'pk': self.pk})
    
    @property
    def display_value(self):
        """Get the display value based on question type"""
        if self.question.type in ['SHORT_TEXT', 'LONG_TEXT']:
            return self.value_text
        elif self.question.type in ['LIKERT', 'NPS', 'NUMBER']:
            return self.value_number
        elif self.question.type in ['MULTI', 'SINGLE', 'RANK']:
            return self.options.get('selected', [])
        elif self.question.type == 'DATE':
            return self.value_json.get('date')
        elif self.question.type == 'MATRIX':
            return self.value_json.get('matrix_data', {})
        return "N/A"
    
    @property
    def is_anonymous_answer(self):
        """Check if this answer should be treated as anonymous in reports"""
        if self.question.anonymity_mode == 'ANONYMOUS':
            return True
        elif self.question.anonymity_mode == 'ESCROW':
            return not self.followup_opt_in
        return False


class Invite(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='invites')
    email = models.EmailField(null=True, blank=True)  # Optional for anonymous surveys
    token = models.CharField(max_length=100, unique=True)
    used_at = models.DateTimeField(null=True, blank=True)
    expires_at = models.DateTimeField()
    meta_json = models.JSONField(default=dict, blank=True)  # For additional invite metadata
    
    class Meta:
        ordering = ['-expires_at']
    
    def __str__(self):
        email = self.email or 'Anonymous'
        return f"{self.survey.title} - {email} - {self.token[:8]}..."
    
    def get_absolute_url(self):
        return reverse('surveys:invite_detail', kwargs={'pk': self.pk})
    
    @property
    def is_expired(self):
        return timezone.now() > self.expires_at
    
    @property
    def is_used(self):
        return self.used_at is not None
    
    @property
    def is_valid(self):
        return not self.is_expired and not self.is_used


class ReportSnapshot(models.Model):
    survey = models.ForeignKey(Survey, on_delete=models.CASCADE, related_name='report_snapshots')
    computed_at = models.DateTimeField(auto_now_add=True)
    aggregates_json = models.JSONField(default=dict)  # For storing computed aggregates
    
    class Meta:
        ordering = ['-computed_at']
    
    def __str__(self):
        return f"{self.survey.title} - {self.computed_at.strftime('%Y-%m-%d %H:%M')}"
    
    def get_absolute_url(self):
        return reverse('surveys:report_snapshot_detail', kwargs={'pk': self.pk})
    
    @property
    def response_rate(self):
        """Calculate response rate as percentage"""
        total_invites = self.survey.invites.count()
        if total_invites == 0:
            return 0
        return (self.survey.response_count / total_invites) * 100
    
    @property
    def enps_score(self):
        """Calculate eNPS score from NPS questions"""
        nps_answers = Answer.objects.filter(
            question__type='NPS',
            response__survey=self.survey
        ).values_list('value_number', flat=True)
        
        if not nps_answers:
            return 0
        
        promoters = sum(1 for score in nps_answers if score >= 9)
        detractors = sum(1 for score in nps_answers if score <= 6)
        total = len(nps_answers)
        
        if total == 0:
            return 0
        
        return ((promoters - detractors) / total) * 100

```

### surveys/views.py
```python
from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required, user_passes_test
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.contrib import messages
from django.http import JsonResponse, HttpResponse
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView
from django.urls import reverse_lazy, reverse
from django.db.models import Q, Count, Avg, Min, Max
from django.utils import timezone
from django.core.paginator import Paginator
from django.template.loader import render_to_string
from django.utils.decorators import method_decorator
from django.views.decorators.csrf import csrf_exempt
from django.views.decorators.http import require_http_methods
import json
import uuid
from datetime import timedelta

from .models import Survey, Section, Question, Response, Answer, Invite, ReportSnapshot
from .forms import (
    SurveyForm, SectionForm, QuestionForm, ResponseForm, AnswerForm,
    InviteForm, BulkInviteForm, SurveyReportForm
)


def is_survey_admin(user):
    """Check if user has admin permissions for surveys"""
    return user.is_staff or user.has_perm('surveys.change_survey')


def is_survey_creator(user):
    """Check if user can create surveys"""
    return user.is_staff or user.has_perm('surveys.add_survey')


def is_survey_analyst(user):
    """Check if user can view survey reports"""
    return user.is_staff or user.has_perm('surveys.view_response')


def index(request):
    return redirect('surveys:list')


def my_invites(request):
    invites = []
    if request.user.is_authenticated:
        now = timezone.now()
        invites = Invite.objects.filter(email__iexact=request.user.email, used_at__isnull=True, expires_at__gt=now)
    return render(request, 'surveys/my_invites.html', {
        'invites': invites,
        'page_title': 'My Survey Invites',
    })


def results_index(request):
    surveys = Survey.objects.filter(status='PUBLISHED')
    return render(request, 'surveys/results_index.html', {
        'surveys': surveys,
        'page_title': 'Survey Results',
    })


def export_report(request, pk, format):
    # Placeholder: return HTTP response; later implement CSV/XLSX/PDF
    return HttpResponse(f"Export for survey {pk} as {format}")


def action_note(request, pk):
    # Placeholder page for manager action notes
    survey = get_object_or_404(Survey, pk=pk)
    return render(request, 'surveys/action_note.html', {
        'survey': survey,
        'page_title': 'Post-Survey Action Note',
    })


# Public Views
def survey_list(request):
    """Public view of published surveys"""
    surveys = Survey.objects.filter(
        status='PUBLISHED',
        publish_start__lte=timezone.now(),
        publish_end__gte=timezone.now()
    ).order_by('-publish_start')
    
    context = {
        'surveys': surveys,
        'page_title': 'Available Surveys'
    }
    return render(request, 'surveys/survey_list.html', context)


def survey_detail(request, pk):
    """Public view of survey details"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if not survey.is_active:
        messages.error(request, 'This survey is not currently active.')
        return redirect('surveys:survey_list')
    
    context = {
        'survey': survey,
        'page_title': survey.title
    }
    return render(request, 'surveys/survey_detail.html', context)


def survey_response(request, survey_pk, token=None):
    """Handle survey response submission"""
    survey = get_object_or_404(Survey, pk=survey_pk)
    
    if not survey.is_active:
        messages.error(request, 'This survey is not currently active.')
        return redirect('surveys:survey_list')
    
    # Check if user already responded
    if request.user.is_authenticated:
        existing_response = Response.objects.filter(
            survey=survey,
            identity_user=request.user
        ).first()
        if existing_response:
            messages.info(request, 'You have already completed this survey.')
            return redirect('surveys:response_detail', pk=existing_response.pk)
    
    # Handle token-based access
    invite = None
    if token:
        invite = get_object_or_404(Invite, token=token, survey=survey)
        if not invite.is_valid:
            messages.error(request, 'This invite link has expired or been used.')
            return redirect('surveys:survey_list')
    
    if request.method == 'POST':
        # Process survey response
        try:
            # Create or get response
            if request.user.is_authenticated:
                response, created = Response.objects.get_or_create(
                    survey=survey,
                    identity_user=request.user
                )
            else:
                # For anonymous responses, create without user
                response = Response.objects.create(survey=survey)
            
            # Process answers
            for section in survey.sections.all():
                for question in section.questions.all():
                    field_name = f'question_{question.pk}'
                    if field_name in request.POST:
                        value = request.POST[field_name]
                        
                        # Create answer based on question type
                        answer = Answer.objects.create(
                            response=response,
                            question=question
                        )
                        
                        if question.type in ['SHORT_TEXT', 'LONG_TEXT']:
                            answer.value_text = value
                            # Handle anonymity-specific fields
                            if question.anonymity_mode == 'ESCROW':
                                answer.followup_opt_in = request.POST.get(f'{field_name}_followup', False)
                                answer.preferred_contact = request.POST.get(f'{field_name}_contact', '')
                            if question.anonymity_mode in ['ESCROW', 'SIGNED']:
                                answer.is_signed = request.POST.get(f'{field_name}_signed', False)
                                if answer.is_signed and request.user.is_authenticated:
                                    answer.signed_by = request.user
                        
                        elif question.type in ['LIKERT', 'NPS', 'NUMBER']:
                            answer.value_number = float(value)
                        
                        elif question.type in ['MULTI', 'SINGLE', 'RANK']:
                            if question.type == 'MULTI':
                                # Handle multiple values
                                values = request.POST.getlist(field_name)
                                answer.value_json = {'selected': values}
                            else:
                                answer.value_json = {'selected': [value]}
                        
                        elif question.type == 'DATE':
                            answer.value_json = {'date': value}
                        
                        answer.save()
            
            # Mark invite as used if applicable
            if invite:
                invite.used_at = timezone.now()
                invite.save()
            
            messages.success(request, 'Thank you for completing the survey!')
            return redirect('surveys:response_complete', pk=response.pk)
            
        except Exception as e:
            messages.error(request, f'Error saving response: {str(e)}')
    
    # Get first question for initial display
    first_section = survey.sections.first()
    first_question = first_section.questions.first() if first_section else None
    
    context = {
        'survey': survey,
        'first_question': first_question,
        'invite': invite,
        'page_title': f'Complete: {survey.title}'
    }
    return render(request, 'surveys/survey_response.html', context)


def response_complete(request, pk):
    """Show completion message after survey response"""
    response = get_object_or_404(Response, pk=pk)
    
    context = {
        'response': response,
        'page_title': 'Survey Complete'
    }
    return render(request, 'surveys/response_complete.html', context)


# Admin Views
@login_required
@user_passes_test(is_survey_admin)
def survey_admin_list(request):
    """Admin view of all surveys"""
    surveys = Survey.objects.all().order_by('-created_at')
    
    context = {
        'surveys': surveys,
        'page_title': 'Survey Administration'
    }
    return render(request, 'surveys/admin/survey_list.html', context)


@login_required
@user_passes_test(is_survey_creator)
def survey_create(request):
    """Create new survey"""
    if request.method == 'POST':
        form = SurveyForm(request.POST)
        if form.is_valid():
            survey = form.save(commit=False)
            survey.created_by = request.user
            survey.save()
            messages.success(request, 'Survey created successfully!')
            return redirect('surveys:survey_edit', pk=survey.pk)
    else:
        form = SurveyForm()
    
    context = {
        'form': form,
        'page_title': 'Create New Survey'
    }
    return render(request, 'surveys/admin/survey_form.html', context)


@login_required
@user_passes_test(is_survey_creator)
def survey_edit(request, pk):
    """Edit existing survey"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        form = SurveyForm(request.POST, instance=survey)
        if form.is_valid():
            form.save()
            messages.success(request, 'Survey updated successfully!')
            return redirect('surveys:survey_admin_list')
    else:
        form = SurveyForm(instance=survey)
    
    context = {
        'form': form,
        'survey': survey,
        'page_title': f'Edit: {survey.title}'
    }
    return render(request, 'surveys/admin/survey_form.html', context)


@login_required
@user_passes_test(is_survey_admin)
def survey_publish(request, pk):
    """Publish or unpublish a survey"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        action = request.POST.get('action')
        if action == 'publish':
            survey.status = 'PUBLISHED'
            survey.save()
            messages.success(request, 'Survey published successfully!')
        elif action == 'unpublish':
            survey.status = 'DRAFT'
            survey.save()
            messages.success(request, 'Survey unpublished successfully!')
        elif action == 'close':
            survey.status = 'CLOSED'
            survey.save()
            messages.success(request, 'Survey closed successfully!')
    
    return redirect('surveys:survey_admin_list')


@login_required
@user_passes_test(is_survey_admin)
def survey_invites(request, pk):
    """Manage survey invites"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        form = BulkInviteForm(request.POST)
        if form.is_valid():
            # Process bulk invites
            invite_type = form.cleaned_data['invite_type']
            expires_in_days = form.cleaned_data['expires_in_days']
            expires_at = timezone.now() + timedelta(days=expires_in_days)
            
            if invite_type == 'all_users':
                users = User.objects.filter(is_active=True)
                for user in users:
                    token = str(uuid.uuid4())
                    Invite.objects.create(
                        survey=survey,
                        email=user.email,
                        token=token,
                        expires_at=expires_at
                    )
                messages.success(request, f'Invites sent to {users.count()} users.')
            
            elif invite_type == 'manual_list':
                email_list = form.cleaned_data['email_list']
                emails = [email.strip() for email in email_list.split('\n') if email.strip()]
                for email in emails:
                    token = str(uuid.uuid4())
                    Invite.objects.create(
                        survey=survey,
                        email=email,
                        token=token,
                        expires_at=expires_at
                    )
                messages.success(request, f'Invites sent to {len(emails)} email addresses.')
            
            return redirect('surveys:survey_invites', pk=survey.pk)
    else:
        form = BulkInviteForm()
    
    invites = survey.invites.all().order_by('-expires_at')
    
    context = {
        'survey': survey,
        'form': form,
        'invites': invites,
        'page_title': f'Manage Invites: {survey.title}'
    }
    return render(request, 'surveys/admin/survey_invites.html', context)


# Reporting Views
@login_required
@user_passes_test(is_survey_analyst)
def survey_reports(request, pk):
    """View survey reports and analytics"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if request.method == 'POST':
        form = SurveyReportForm(request.POST)
        if form.is_valid():
            # Generate report based on form data
            report_data = generate_survey_report(survey, form.cleaned_data)
            context = {
                'survey': survey,
                'report_data': report_data,
                'form': form,
                'page_title': f'Reports: {survey.title}'
            }
            return render(request, 'surveys/reports/survey_report.html', context)
    else:
        form = SurveyReportForm()
    
    # Basic stats
    total_responses = survey.response_count
    response_rate = 0
    if survey.invites.count() > 0:
        response_rate = (total_responses / survey.invites.count()) * 100
    
    context = {
        'survey': survey,
        'form': form,
        'total_responses': total_responses,
        'response_rate': response_rate,
        'page_title': f'Reports: {survey.title}'
    }
    return render(request, 'surveys/reports/survey_reports.html', context)


def generate_survey_report(survey, options):
    """Generate survey report data based on options"""
    report_data = {
        'summary': {},
        'questions': [],
        'cohorts': {},
        'sentiment': {}
    }
    
    # Get responses based on date filters
    responses = survey.responses.all()
    if options.get('date_from'):
        responses = responses.filter(submitted_at__gte=options['date_from'])
    if options.get('date_to'):
        responses = responses.filter(submitted_at__lte=options['date_to'])
    
    # Summary statistics
    report_data['summary'] = {
        'total_responses': responses.count(),
        'response_rate': (responses.count() / survey.invites.count() * 100) if survey.invites.count() > 0 else 0,
        'date_range': {
            'from': options.get('date_from'),
            'to': options.get('date_to')
        }
    }
    
    # Question-level analysis
    for section in survey.sections.all():
        for question in section.questions.all():
            question_data = {
                'question': question,
                'answers': [],
                'stats': {}
            }
            
            answers = Answer.objects.filter(
                question=question,
                response__in=responses
            )
            
            if question.type in ['LIKERT', 'NPS', 'NUMBER']:
                numeric_answers = [a.value_number for a in answers if a.value_number is not None]
                if numeric_answers:
                    question_data['stats'] = {
                        'count': len(numeric_answers),
                        'mean': sum(numeric_answers) / len(numeric_answers),
                        'median': sorted(numeric_answers)[len(numeric_answers) // 2],
                        'min': min(numeric_answers),
                        'max': max(numeric_answers)
                    }
            
            elif question.type in ['MULTI', 'SINGLE']:
                choice_counts = {}
                for answer in answers:
                    selected = answer.value_json.get('selected', [])
                    for choice in selected:
                        choice_counts[choice] = choice_counts.get(choice, 0) + 1
                question_data['stats'] = choice_counts
            
            question_data['answers'] = list(answers)
            report_data['questions'].append(question_data)
    
    return report_data


# HTMX Views for dynamic updates
@require_http_methods(["POST"])
@csrf_exempt
def reorder_sections(request, survey_pk):
    """HTMX endpoint for reordering sections"""
    if not request.user.is_authenticated or not is_survey_admin(request.user):
        return JsonResponse({'error': 'Unauthorized'}, status=403)
    
    try:
        data = json.loads(request.body)
        section_orders = data.get('section_orders', [])
        
        for item in section_orders:
            section_id = item.get('id')
            new_order = item.get('order')
            if section_id and new_order is not None:
                Section.objects.filter(id=section_id).update(order=new_order)
        
        return JsonResponse({'success': True})
    except Exception as e:
        return JsonResponse({'error': str(e)}, status=400)


@require_http_methods(["POST"])
@csrf_exempt
def reorder_questions(request, section_pk):
    """HTMX endpoint for reordering questions"""
    if not request.user.is_authenticated or not is_survey_admin(request.user):
        return JsonResponse({'error': 'Unauthorized'}, status=403)
    
    try:
        data = json.loads(request.body)
        question_orders = data.get('question_orders', [])
        
        for item in question_orders:
            question_id = item.get('id')
            new_order = item.get('order')
            if question_id and new_order is not None:
                Question.objects.filter(id=question_id).update(order=new_order)
        
        return JsonResponse({'success': True})
    except Exception as e:
        return JsonResponse({'error': str(e)}, status=400)


# API Views for mobile/JS consumption
def survey_api_detail(request, pk):
    """API endpoint for survey details"""
    survey = get_object_or_404(Survey, pk=pk)
    
    if not survey.is_active:
        return JsonResponse({'error': 'Survey not active'}, status=400)
    
    data = {
        'id': survey.pk,
        'title': survey.title,
        'description': survey.description,
        'sections': []
    }
    
    for section in survey.sections.all():
        section_data = {
            'id': section.pk,
            'title': section.title,
            'description': section.description,
            'order': section.order,
            'questions': []
        }
        
        for question in section.questions.all():
            question_data = {
                'id': question.pk,
                'type': question.type,
                'prompt': question.prompt,
                'help_text': question.help_text,
                'required': question.required,
                'anonymity_mode': question.anonymity_mode,
                'order': question.order
            }
            
            if question.is_scale_question:
                question_data.update({
                    'scale_min': question.scale_min,
                    'scale_max': question.scale_max
                })
            
            if question.options:
                question_data['options'] = question.options
            
            section_data['questions'].append(question_data)
        
        data['sections'].append(section_data)
    
    return JsonResponse(data)

```

### surveys/urls.py
```python
from django.urls import path
from . import views

app_name = 'surveys'

urlpatterns = [
    # Index and lists
    path('', views.index, name='index'),
    path('list/', views.survey_list, name='list'),
    path('invites/', views.my_invites, name='my_invites'),

    # Public survey views
    path('<int:pk>/', views.survey_detail, name='detail'),
    path('<int:survey_pk>/take/', views.survey_response, name='take'),
    path('<int:survey_pk>/take/<str:token>/', views.survey_response, name='take_with_token'),
    path('response/<int:pk>/complete/', views.response_complete, name='response_complete'),

    # Results and exports
    path('results/', views.results_index, name='results'),
    path('<int:pk>/export/<str:format>/', views.export_report, name='export'),
    path('<int:pk>/action-note/', views.action_note, name='action_note'),

    # Admin / Builder
    path('admin/', views.survey_admin_list, name='survey_admin_list'),
    path('admin/create/', views.survey_create, name='builder'),
    path('admin/<int:pk>/edit/', views.survey_edit, name='survey_edit'),
    path('admin/<int:pk>/publish/', views.survey_publish, name='publish'),
    path('admin/<int:pk>/invites/', views.survey_invites, name='survey_invites'),
    path('admin/<int:pk>/reports/', views.survey_reports, name='survey_reports'),

    # HTMX endpoints for dynamic updates
    path('admin/<int:survey_pk>/reorder-sections/', views.reorder_sections, name='reorder_sections'),
    path('admin/<int:section_pk>/reorder-questions/', views.reorder_questions, name='reorder_questions'),

    # API endpoints
    path('api/<int:pk>/', views.survey_api_detail, name='survey_api_detail'),
]

```

### surveys/forms.py
```python
from django import forms
from django.contrib.auth.models import User
from django.core.exceptions import ValidationError
from django.utils import timezone
from .models import Survey, Section, Question, Response, Answer, Invite


class SurveyForm(forms.ModelForm):
    class Meta:
        model = Survey
        fields = ['title', 'description', 'publish_start', 'publish_end', 'k_threshold']
        widgets = {
            'publish_start': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
            'publish_end': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
            'description': forms.Textarea(attrs={'rows': 4}),
        }
    
    def clean(self):
        cleaned_data = super().clean()
        publish_start = cleaned_data.get('publish_start')
        publish_end = cleaned_data.get('publish_end')
        
        if publish_start and publish_end:
            if publish_start >= publish_end:
                raise ValidationError("Publish end date must be after publish start date.")
            
            if publish_start < timezone.now():
                raise ValidationError("Publish start date cannot be in the past.")
        
        return cleaned_data


class SectionForm(forms.ModelForm):
    class Meta:
        model = Section
        fields = ['title', 'description', 'order']
        widgets = {
            'description': forms.Textarea(attrs={'rows': 3}),
        }


class QuestionForm(forms.ModelForm):
    class Meta:
        model = Question
        fields = [
            'type', 'prompt', 'help_text', 'required', 'anonymity_mode',
            'options_json', 'scale_min', 'scale_max', 'order', 'logic_json'
        ]
        widgets = {
            'prompt': forms.Textarea(attrs={'rows': 3}),
            'help_text': forms.Textarea(attrs={'rows': 2}),
            'options_json': forms.Textarea(attrs={'rows': 4, 'placeholder': 'Enter JSON format options'}),
            'logic_json': forms.Textarea(attrs={'rows': 3, 'placeholder': 'Enter JSON format logic'}),
        }
    
    def clean(self):
        cleaned_data = super().clean()
        question_type = cleaned_data.get('type')
        scale_min = cleaned_data.get('scale_min')
        scale_max = cleaned_data.get('scale_max')
        options_json = cleaned_data.get('options_json')
        
        # Validate scale for scale-based questions
        if question_type in ['LIKERT', 'NPS', 'NUMBER']:
            if scale_min is None or scale_max is None:
                raise ValidationError("Scale min and max are required for scale-based questions.")
            if scale_min >= scale_max:
                raise ValidationError("Scale max must be greater than scale min.")
            if scale_max - scale_min > 10:
                raise ValidationError("Scale range cannot exceed 10 points.")
        
        # Validate options for choice-based questions
        if question_type in ['MULTI', 'SINGLE', 'RANK']:
            if not options_json or not isinstance(options_json, dict):
                raise ValidationError("Options are required for choice-based questions.")
            choices = options_json.get('choices', [])
            if not choices or len(choices) < 2:
                raise ValidationError("At least 2 choices are required for choice-based questions.")
        
        return cleaned_data


class ResponseForm(forms.ModelForm):
    class Meta:
        model = Response
        fields = ['cohort_json', 'meta_json']
        widgets = {
            'cohort_json': forms.Textarea(attrs={'rows': 3, 'placeholder': 'Enter JSON format cohort data'}),
            'meta_json': forms.Textarea(attrs={'rows': 3, 'placeholder': 'Enter JSON format metadata'}),
        }


class AnswerForm(forms.Form):
    """Dynamic form for answering questions based on question type"""
    
    def __init__(self, question, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.question = question
        self._build_fields()
    
    def _build_fields(self):
        """Build form fields based on question type"""
        question = self.question
        
        if question.type == 'LIKERT':
            choices = [(i, str(i)) for i in range(question.scale_min, question.scale_max + 1)]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.RadioSelect,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'NPS':
            choices = [(i, str(i)) for i in range(0, 11)]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.RadioSelect,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'MULTI':
            choices = [(opt, opt) for opt in question.options]
            self.fields['value'] = forms.MultipleChoiceField(
                choices=choices,
                widget=forms.CheckboxSelectMultiple,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'SINGLE':
            choices = [(opt, opt) for opt in question.options]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.RadioSelect,
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'SHORT_TEXT':
            self.fields['value'] = forms.CharField(
                max_length=500,
                widget=forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'LONG_TEXT':
            self.fields['value'] = forms.CharField(
                widget=forms.Textarea(attrs={'rows': 4, 'class': 'textarea textarea-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'NUMBER':
            self.fields['value'] = forms.IntegerField(
                min_value=question.scale_min,
                max_value=question.scale_max,
                widget=forms.NumberInput(attrs={'class': 'input input-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'DATE':
            self.fields['value'] = forms.DateField(
                widget=forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        elif question.type == 'RANK':
            choices = [(opt, opt) for opt in question.options]
            self.fields['value'] = forms.ChoiceField(
                choices=choices,
                widget=forms.Select(attrs={'class': 'select select-bordered w-full'}),
                required=question.required,
                label=question.prompt,
                help_text=question.help_text
            )
        
        # Add anonymity-specific fields for text questions
        if question.type in ['SHORT_TEXT', 'LONG_TEXT']:
            if question.anonymity_mode == 'ESCROW':
                self.fields['followup_opt_in'] = forms.BooleanField(
                    required=False,
                    initial=True,
                    label="I'm open to follow-up questions about this answer"
                )
                self.fields['preferred_contact'] = forms.CharField(
                    max_length=200,
                    required=False,
                    widget=forms.TextInput(attrs={'class': 'input input-bordered w-full'}),
                    label="Preferred contact method (optional)"
                )
            
            if question.anonymity_mode in ['ESCROW', 'SIGNED']:
                self.fields['is_signed'] = forms.BooleanField(
                    required=False,
                    initial=(question.anonymity_mode == 'SIGNED'),
                    label="Sign this answer with my name"
                )
    
    def clean_value(self):
        """Clean and validate the answer value"""
        value = self.cleaned_data.get('value')
        question = self.question
        
        if question.required and not value:
            raise ValidationError("This question is required.")
        
        # Type-specific validation
        if question.type == 'NUMBER':
            if value < question.scale_min or value > question.scale_max:
                raise ValidationError(f"Value must be between {question.scale_min} and {question.scale_max}.")
        
        return value


class InviteForm(forms.ModelForm):
    class Meta:
        model = Invite
        fields = ['email', 'expires_at']
        widgets = {
            'expires_at': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
        }
    
    def clean_expires_at(self):
        expires_at = self.cleaned_data.get('expires_at')
        if expires_at and expires_at <= timezone.now():
            raise ValidationError("Expiration date must be in the future.")
        return expires_at


class BulkInviteForm(forms.Form):
    """Form for bulk inviting users to surveys"""
    SURVEY_CHOICES = []
    USER_CHOICES = []
    
    survey = forms.ModelChoiceField(
        queryset=Survey.objects.filter(status='PUBLISHED'),
        empty_label="Select a survey",
        widget=forms.Select(attrs={'class': 'select select-bordered w-full'})
    )
    
    invite_type = forms.ChoiceField(
        choices=[
            ('all_users', 'All Users'),
            ('by_group', 'By Group'),
            ('manual_list', 'Manual Email List'),
        ],
        widget=forms.RadioSelect
    )
    
    # For manual email list
    email_list = forms.CharField(
        widget=forms.Textarea(attrs={
            'rows': 5,
            'placeholder': 'Enter email addresses, one per line',
            'class': 'textarea textarea-bordered w-full'
        }),
        required=False,
        help_text="Enter email addresses, one per line"
    )
    
    # For group selection
    groups = forms.ModelMultipleChoiceField(
        queryset=User.objects.none(),  # Will be populated in __init__
        required=False,
        widget=forms.CheckboxSelectMultiple
    )
    
    expires_in_days = forms.IntegerField(
        min_value=1,
        max_value=30,
        initial=7,
        widget=forms.NumberInput(attrs={'class': 'input input-bordered w-full'}),
        help_text="Invite expires in X days"
    )
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        # Populate user choices for group selection
        self.fields['groups'].queryset = User.objects.filter(is_active=True)
    
    def clean(self):
        cleaned_data = super().clean()
        invite_type = cleaned_data.get('invite_type')
        
        if invite_type == 'manual_list':
            email_list = cleaned_data.get('email_list', '').strip()
            if not email_list:
                raise ValidationError("Email list is required for manual invites.")
            
            # Validate email format
            emails = [email.strip() for email in email_list.split('\n') if email.strip()]
            for email in emails:
                if not forms.EmailField().clean(email):
                    raise ValidationError(f"Invalid email format: {email}")
        
        elif invite_type == 'by_group':
            groups = cleaned_data.get('groups')
            if not groups:
                raise ValidationError("Please select at least one group for group-based invites.")
        
        return cleaned_data


class SurveyReportForm(forms.Form):
    """Form for generating survey reports"""
    REPORT_TYPES = [
        ('summary', 'Summary Report'),
        ('detailed', 'Detailed Report'),
        ('cohort', 'Cohort Analysis'),
        ('sentiment', 'Sentiment Analysis'),
    ]
    
    EXPORT_FORMATS = [
        ('html', 'HTML'),
        ('csv', 'CSV'),
        ('xlsx', 'Excel'),
        ('pdf', 'PDF'),
    ]
    
    report_type = forms.ChoiceField(
        choices=REPORT_TYPES,
        widget=forms.RadioSelect,
        initial='summary'
    )
    
    export_format = forms.ChoiceField(
        choices=EXPORT_FORMATS,
        widget=forms.Select(attrs={'class': 'select select-bordered w-full'}),
        initial='html'
    )
    
    include_anonymous = forms.BooleanField(
        required=False,
        initial=True,
        label="Include anonymous responses in aggregates"
    )
    
    min_cohort_size = forms.IntegerField(
        min_value=1,
        initial=5,
        widget=forms.NumberInput(attrs={'class': 'input input-bordered w-full'}),
        help_text="Minimum cohort size for detailed breakdowns (k-anonymity)"
    )
    
    date_from = forms.DateField(
        required=False,
        widget=forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
        help_text="Filter responses from this date (optional)"
    )
    
    date_to = forms.DateField(
        required=False,
        widget=forms.DateInput(attrs={'type': 'date', 'class': 'input input-bordered w-full'}),
        help_text="Filter responses until this date (optional)"
    )

```

### surveys/admin.py
```python
from django.contrib import admin
from django.utils.html import format_html
from django.urls import reverse
from django.utils.safestring import mark_safe
from .models import Survey, Section, Question, Response, Answer, Invite, ReportSnapshot


class QuestionInline(admin.TabularInline):
    model = Question
    extra = 1
    fields = ['type', 'prompt', 'anonymity_mode', 'required', 'order']
    ordering = ['order']


class SectionInline(admin.TabularInline):
    model = Section
    extra = 1
    fields = ['title', 'description', 'order']
    ordering = ['order']


@admin.register(Survey)
class SurveyAdmin(admin.ModelAdmin):
    list_display = ['title', 'status', 'created_by', 'publish_start', 'publish_end', 'response_count', 'is_active_display']
    list_filter = ['status', 'created_by', 'publish_start', 'publish_end']
    search_fields = ['title', 'description', 'created_by__username']
    readonly_fields = ['created_at', 'updated_at', 'response_count', 'sections_count']
    inlines = [SectionInline]
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('title', 'description', 'created_by')
        }),
        ('Publishing', {
            'fields': ('status', 'publish_start', 'publish_end', 'k_threshold')
        }),
        ('Metadata', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def is_active_display(self, obj):
        if obj.is_active:
            return format_html('<span style="color: green;">✓ Active</span>')
        else:
            return format_html('<span style="color: red;">✗ Inactive</span>')
    is_active_display.short_description = 'Status'
    
    def response_count(self, obj):
        return obj.response_count
    response_count.short_description = 'Responses'


@admin.register(Section)
class SectionAdmin(admin.ModelAdmin):
    list_display = ['title', 'survey', 'order', 'questions_count']
    list_filter = ['survey']
    search_fields = ['title', 'survey__title']
    ordering = ['survey', 'order']
    inlines = [QuestionInline]
    
    def questions_count(self, obj):
        return obj.questions.count()
    questions_count.short_description = 'Questions'


@admin.register(Question)
class QuestionAdmin(admin.ModelAdmin):
    list_display = ['prompt_short', 'section', 'type', 'anonymity_mode', 'required', 'order']
    list_filter = ['type', 'anonymity_mode', 'required', 'section__survey']
    search_fields = ['prompt', 'section__title', 'section__survey__title']
    ordering = ['section', 'order']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('section', 'type', 'prompt', 'help_text', 'required', 'order')
        }),
        ('Anonymity & Logic', {
            'fields': ('anonymity_mode', 'logic_json')
        }),
        ('Options & Scales', {
            'fields': ('options_json', 'scale_min', 'scale_max'),
            'classes': ('collapse',)
        }),
    )
    
    def prompt_short(self, obj):
        return obj.prompt[:50] + "..." if len(obj.prompt) > 50 else obj.prompt
    prompt_short.short_description = 'Prompt'


class AnswerInline(admin.TabularInline):
    model = Answer
    extra = 0
    readonly_fields = ['question', 'display_value', 'is_signed', 'moderation_status']
    fields = ['question', 'display_value', 'is_signed', 'moderation_status']
    
    def display_value(self, obj):
        return obj.display_value
    display_value.short_description = 'Value'


@admin.register(Response)
class ResponseAdmin(admin.ModelAdmin):
    list_display = ['survey', 'identity_display', 'submitted_at', 'answers_count', 'is_anonymous_display']
    list_filter = ['survey', 'submitted_at', 'survey__status']
    search_fields = ['survey__title', 'identity_user__username', 'identity_user__email']
    readonly_fields = ['submitted_at', 'answers_count']
    inlines = [AnswerInline]
    
    fieldsets = (
        ('Response Information', {
            'fields': ('survey', 'identity_user', 'submitted_at')
        }),
        ('Metadata', {
            'fields': ('cohort_json', 'meta_json'),
            'classes': ('collapse',)
        }),
    )
    
    def identity_display(self, obj):
        if obj.identity_user:
            return obj.identity_user.username
        return 'Anonymous'
    identity_display.short_description = 'Respondent'
    
    def is_anonymous_display(self, obj):
        if obj.is_anonymous:
            return format_html('<span style="color: orange;">Anonymous</span>')
        else:
            return format_html('<span style="color: blue;">Identified</span>')
    is_anonymous_display.short_description = 'Anonymity'
    
    def answers_count(self, obj):
        return obj.answers_count
    answers_count.short_description = 'Answers'


@admin.register(Answer)
class AnswerAdmin(admin.ModelAdmin):
    list_display = ['question_short', 'response', 'display_value', 'question_anonymity_mode', 'moderation_status']
    list_filter = ['question__type', 'question__anonymity_mode', 'moderation_status', 'is_signed']
    search_fields = ['question__prompt', 'response__survey__title', 'value_text']
    readonly_fields = ['response', 'question', 'display_value']
    
    fieldsets = (
        ('Answer Information', {
            'fields': ('response', 'question', 'display_value')
        }),
        ('Values', {
            'fields': ('value_text', 'value_number', 'value_json'),
            'classes': ('collapse',)
        }),
        ('Metadata', {
            'fields': ('is_signed', 'signed_by', 'followup_opt_in', 'preferred_contact')
        }),
        ('Moderation', {
            'fields': ('moderation_status', 'flags_json'),
            'classes': ('collapse',)
        }),
    )
    
    def question_short(self, obj):
        return obj.question.prompt[:50] + "..." if len(obj.question.prompt) > 50 else obj.question.prompt
    question_short.short_description = 'Question'
    
    def question_anonymity_mode(self, obj):
        return obj.question.anonymity_mode
    question_anonymity_mode.short_description = 'Anonymity Mode'
    
    def display_value(self, obj):
        return obj.display_value
    display_value.short_description = 'Value'


@admin.register(Invite)
class InviteAdmin(admin.ModelAdmin):
    list_display = ['survey', 'email_display', 'token_short', 'expires_at', 'status_display']
    list_filter = ['survey', 'expires_at', 'used_at']
    search_fields = ['survey__title', 'email', 'token']
    readonly_fields = ['token', 'status_display']
    
    fieldsets = (
        ('Invite Information', {
            'fields': ('survey', 'email', 'token', 'expires_at')
        }),
        ('Usage', {
            'fields': ('used_at', 'meta_json'),
            'classes': ('collapse',)
        }),
    )
    
    def email_display(self, obj):
        return obj.email or 'Anonymous'
    email_display.short_description = 'Email'
    
    def token_short(self, obj):
        return obj.token[:8] + "..."
    token_short.short_description = 'Token'
    
    def status_display(self, obj):
        if obj.is_expired:
            return format_html('<span style="color: red;">Expired</span>')
        elif obj.is_used:
            return format_html('<span style="color: orange;">Used</span>')
        else:
            return format_html('<span style="color: green;">Valid</span>')
    status_display.short_description = 'Status'


@admin.register(ReportSnapshot)
class ReportSnapshotAdmin(admin.ModelAdmin):
    list_display = ['survey', 'computed_at', 'response_rate', 'enps_score']
    list_filter = ['survey', 'computed_at']
    search_fields = ['survey__title']
    readonly_fields = ['computed_at', 'response_rate', 'enps_score']
    
    fieldsets = (
        ('Snapshot Information', {
            'fields': ('survey', 'computed_at')
        }),
        ('Aggregates', {
            'fields': ('aggregates_json',),
            'classes': ('collapse',)
        }),
    )
    
    def response_rate(self, obj):
        return f"{obj.response_rate:.1f}%"
    response_rate.short_description = 'Response Rate'
    
    def enps_score(self, obj):
        return f"{obj.enps_score:.1f}"
    enps_score.short_description = 'eNPS Score'

```

### surveys/apps.py
```python
from django.apps import AppConfig


class SurveysConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'surveys'
    verbose_name = 'Surveys & Feedback'

```

#### Templates in surveys
### surveys/templates/surveys/response_complete.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <div class="text-center">
        <!-- Success Icon -->
        <div class="mb-6">
            <div class="w-24 h-24 bg-success rounded-full flex items-center justify-center mx-auto">
                <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
        </div>
        
        <!-- Success Message -->
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Survey Complete!</h1>
        <p class="text-lg text-gray-600 mb-6">
            Thank you for taking the time to complete 
            <span class="font-semibold">{{ response.survey.title }}</span>.
        </p>
        
        <!-- Response Details -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body text-center">
                <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Your Response</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                    <div class="stat bg-gray-50 rounded-lg">
                        <div class="stat-title text-sm">Questions Answered</div>
                        <div class="stat-value text-primary text-2xl">{{ response.answers.count }}</div>
                    </div>
                    
                    <div class="stat bg-gray-50 rounded-lg">
                        <div class="stat-title text-sm">Submitted</div>
                        <div class="stat-value text-info text-2xl">{{ response.submitted_at|date:"M j" }}</div>
                        <div class="stat-desc text-xs">{{ response.submitted_at|date:"g:i A" }}</div>
                    </div>
                </div>
                
                {% if response.identity_user %}
                    <p class="text-sm text-gray-600">
                        Response ID: <span class="font-mono">{{ response.pk }}</span>
                    </p>
                {% else %}
                    <p class="text-sm text-gray-600">
                        <span class="badge badge-warning">Anonymous Response</span>
                    </p>
                {% endif %}
            </div>
        </div>
        
        <!-- Anonymity Information -->
        <div class="card bg-blue-50 border border-blue-200 mb-8">
            <div class="card-body text-center">
                <h3 class="font-semibold text-blue-800 mb-2">Your Privacy is Protected</h3>
                <p class="text-blue-700 text-sm">
                    {% if response.identity_user %}
                        Your responses are stored securely and will only be used for improving our organization.
                        {% if response.answers.filter.is_signed=True %}
                            Some of your answers were signed and may be attributed to you in reports.
                        {% else %}
                            Your responses are private and will be aggregated with others for analysis.
                        {% endif %}
                    {% else %}
                        This was an anonymous survey. Your responses cannot be traced back to you.
                    {% endif %}
                </p>
            </div>
        </div>
        
        <!-- Next Steps -->
        <div class="card bg-gray-50 border border-gray-200 mb-8">
            <div class="card-body text-center">
                <h3 class="font-semibold text-gray-800 mb-2">What Happens Next?</h3>
                <div class="space-y-2 text-sm text-gray-600">
                    <p>• Your responses will be analyzed along with others</p>
                    <p>• Reports will be generated for organizational improvement</p>
                    <p>• If you opted in for follow-up, you may be contacted</p>
                    <p>• Results will be shared with the team when available</p>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="space-y-4">
            <a href="{% url 'surveys:survey_list' %}" class="btn btn-primary btn-lg">
                View Other Surveys
            </a>
            
            <div class="flex justify-center gap-4">
                <a href="{% url 'home' %}" class="btn btn-outline">
                    ← Back to Home
                </a>
                
                {% if user.is_staff %}
                    <a href="{% url 'surveys:survey_reports' response.survey.pk %}" class="btn btn-outline btn-secondary">
                        View Reports
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

### surveys/templates/surveys/survey_detail.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Survey Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">{{ survey.title }}</h1>
        {% if survey.description %}
            <p class="text-lg text-gray-600 mb-6">{{ survey.description }}</p>
        {% endif %}
        
        <!-- Status Badge -->
        {% if survey.is_active %}
            <div class="badge badge-success badge-lg mb-4">Active Survey</div>
        {% else %}
            <div class="badge badge-warning badge-lg mb-4">Survey Not Active</div>
        {% endif %}
        
        <!-- Survey Info -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="stat bg-white shadow-lg rounded-lg">
                <div class="stat-figure text-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="stat-title text-sm">Sections</div>
                <div class="stat-value text-primary text-2xl">{{ survey.sections.count }}</div>
            </div>
            
            <div class="stat bg-white shadow-lg rounded-lg">
                <div class="stat-figure text-info">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="stat-title text-sm">Questions</div>
                <div class="stat-value text-info text-2xl">{{ survey.sections.all|length }}</div>
            </div>
            
            <div class="stat bg-white shadow-lg rounded-lg">
                <div class="stat-figure text-success">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <div class="stat-title text-sm">Responses</div>
                <div class="stat-value text-success text-2xl">{{ survey.response_count }}</div>
            </div>
        </div>
        
        <!-- Availability -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 class="font-semibold text-gray-800 mb-2">Survey Availability</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="font-medium">Start Date:</span>
                    <span class="text-gray-600">{{ survey.publish_start|date:"F j, Y \a\t g:i A" }}</span>
                </div>
                <div>
                    <span class="font-medium">End Date:</span>
                    <span class="text-gray-600">{{ survey.publish_end|date:"F j, Y \a\t g:i A" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Survey Preview -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Survey Preview</h2>
            
            {% if survey.sections.all %}
                <div class="space-y-6">
                    {% for section in survey.sections.all %}
                        <div class="border-l-4 border-primary pl-4">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">
                                {{ section.title }}
                            </h3>
                            
                            {% if section.description %}
                                <p class="text-gray-600 mb-4">{{ section.description }}</p>
                            {% endif %}
                            
                            {% if section.questions.all %}
                                <div class="space-y-3">
                                    {% for question in section.questions.all %}
                                        <div class="bg-gray-50 rounded-lg p-3">
                                            <div class="flex items-start justify-between mb-2">
                                                <h4 class="font-medium text-gray-700">
                                                    {{ question.prompt }}
                                                </h4>
                                                <span class="badge badge-sm 
                                                    {% if question.anonymity_mode == 'ANONYMOUS' %}badge-warning
                                                    {% elif question.anonymity_mode == 'ESCROW' %}badge-info
                                                    {% else %}badge-success{% endif %}">
                                                    {% if question.anonymity_mode == 'ANONYMOUS' %}
                                                        Anonymous
                                                    {% elif question.anonymity_mode == 'ESCROW' %}
                                                        Private
                                                    {% else %}
                                                        Signed
                                                    {% endif %}
                                                </span>
                                            </div>
                                            
                                            <div class="text-sm text-gray-500">
                                                <span class="font-medium">Type:</span> 
                                                {% if question.type == 'LIKERT' %}Likert Scale ({{ question.scale_min }}-{{ question.scale_max }})
                                                {% elif question.type == 'NPS' %}Net Promoter Score (0-10)
                                                {% elif question.type == 'MULTI' %}Multiple Choice
                                                {% elif question.type == 'SINGLE' %}Single Choice
                                                {% elif question.type == 'SHORT_TEXT' %}Short Text
                                                {% elif question.type == 'LONG_TEXT' %}Long Text
                                                {% elif question.type == 'NUMBER' %}Number ({{ question.scale_min }}-{{ question.scale_max }})
                                                {% elif question.type == 'DATE' %}Date
                                                {% elif question.type == 'RANK' %}Ranking
                                                {% else %}{{ question.type }}{% endif %}
                                                
                                                {% if question.required %}
                                                    <span class="text-red-500 ml-2">* Required</span>
                                                {% endif %}
                                            </div>
                                            
                                            {% if question.help_text %}
                                                <p class="text-sm text-gray-600 mt-2 italic">{{ question.help_text }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-gray-500 italic">No questions in this section yet.</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">📝</div>
                    <p class="text-gray-600">This survey doesn't have any sections or questions yet.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="text-center space-y-4">
        {% if survey.is_active %}
            <a href="{% url 'surveys:take' survey.pk %}" 
               class="btn btn-primary btn-lg">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Take Survey Now
            </a>
        {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <p class="text-yellow-800">
                    This survey is not currently active. Please check back during the published dates.
                </p>
            </div>
        {% endif %}
        
        <div class="flex justify-center gap-4">
            <a href="{% url 'surveys:list' %}" class="btn btn-outline">
                ← Back to Surveys
            </a>
            
            {% if user.is_staff %}
                <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-outline btn-primary">
                    Edit Survey
                </a>
                <a href="{% url 'surveys:survey_reports' survey.pk %}" class="btn btn-outline btn-secondary">
                    View Reports
                </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

```

### surveys/templates/surveys/action_note.html
```python
{% extends 'base.html' %}
{% block title %}{{ page_title }}{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
  <h1 class="text-2xl font-bold mb-4">Post-Survey Action Note</h1>
  <p class="opacity-70 mb-6">Document next steps for {{ survey.title }}.</p>
  <form method="post" class="space-y-4">
    {% csrf_token %}
    <div class="form-control">
      <label class="label"><span class="label-text">Keep</span></label>
      <textarea class="textarea textarea-bordered" rows="2" name="keep"></textarea>
    </div>
    <div class="form-control">
      <label class="label"><span class="label-text">Stop</span></label>
      <textarea class="textarea textarea-bordered" rows="2" name="stop"></textarea>
    </div>
    <div class="form-control">
      <label class="label"><span class="label-text">Start</span></label>
      <textarea class="textarea textarea-bordered" rows="2" name="start"></textarea>
    </div>
    <div class="card-actions justify-end">
      <button class="btn btn-primary">Save</button>
    </div>
  </form>
  <div class="mt-6">
    <a class="btn btn-ghost" href="{% url 'surveys:survey_reports' survey.pk %}">Back to reports</a>
  </div>
{% endblock %}


```

### surveys/templates/surveys/survey_response.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<style>
    .anonymity-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
    }
    .anonymity-anonymous { background-color: #fef3c7; color: #92400e; }
    .anonymity-escrow { background-color: #dbeafe; color: #1e40af; }
    .anonymity-signed { background-color: #dcfce7; color: #166534; }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-4xl">
    <!-- Survey Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ survey.title }}</h1>
        {% if survey.description %}
            <p class="text-gray-600 mb-4">{{ survey.description }}</p>
        {% endif %}
        
        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
            <div class="bg-primary h-2 rounded-full transition-all duration-300" 
                 style="width: 0%" id="progress-bar"></div>
        </div>
        <p class="text-sm text-gray-500">
            <span id="current-question">1</span> of <span id="total-questions">{{ survey.sections.count }}</span> questions
        </p>
    </div>

    <!-- Survey Form -->
    <form method="post" id="survey-form" class="space-y-8">
        {% csrf_token %}
        
        {% for section in survey.sections.all %}
            <div class="section" data-section="{{ forloop.counter }}">
                <div class="card bg-white shadow-lg">
                    <div class="card-body">
                        <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">
                            {{ section.title }}
                        </h2>
                        
                        {% if section.description %}
                            <p class="text-gray-600 mb-6">{{ section.description }}</p>
                        {% endif %}
                        
                        {% for question in section.questions.all %}
                            <div class="question-container mb-8" data-question="{{ forloop.counter }}">
                                <div class="border-l-4 border-primary pl-4">
                                    <!-- Question Header -->
                                    <div class="flex items-start justify-between mb-3">
                                        <h3 class="text-lg font-medium text-gray-800">
                                            {{ question.prompt }}
                                        </h3>
                                        <span class="anonymity-badge anonymity-{{ question.anonymity_mode|lower }}">
                                            {% if question.anonymity_mode == 'ANONYMOUS' %}
                                                Anonymous
                                            {% elif question.anonymity_mode == 'ESCROW' %}
                                                Private
                                            {% else %}
                                                Signed
                                            {% endif %}
                                        </span>
                                    </div>
                                    
                                    {% if question.help_text %}
                                        <p class="text-sm text-gray-600 mb-4">{{ question.help_text }}</p>
                                    {% endif %}
                                    
                                    <!-- Question Input -->
                                    <div class="question-input">
                                        {% if question.type == 'LIKERT' %}
                                            <div class="flex flex-wrap gap-3">
                                                {% for i in question.scale_values %}
                                                    <label class="flex flex-col items-center">
                                                        <input type="radio" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ i }}"
                                                               class="radio radio-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="text-sm mt-1">{{ i }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        
                                        {% elif question.type == 'NPS' %}
                                            <div class="grid grid-cols-11 gap-1">
                                                {% for i in question.scale_values %}
                                                    <label class="flex flex-col items-center">
                                                        <input type="radio" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ i }}"
                                                               class="radio radio-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="text-xs mt-1">{{ i }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                                <span>Not likely</span>
                                                <span>Very likely</span>
                                            </div>
                                        
                                        {% elif question.type == 'MULTI' %}
                                            <div class="space-y-2">
                                                {% for option in question.options %}
                                                    <label class="flex items-center">
                                                        <input type="checkbox" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ option }}"
                                                               class="checkbox checkbox-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="ml-2">{{ option }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        
                                        {% elif question.type == 'SINGLE' %}
                                            <div class="space-y-2">
                                                {% for option in question.options %}
                                                    <label class="flex items-center">
                                                        <input type="radio" 
                                                               name="question_{{ question.pk }}" 
                                                               value="{{ option }}"
                                                               class="radio radio-primary"
                                                               {% if question.required %}required{% endif %}>
                                                        <span class="ml-2">{{ option }}</span>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        
                                        {% elif question.type == 'SHORT_TEXT' %}
                                            <input type="text" 
                                                   name="question_{{ question.pk }}"
                                                   class="input input-bordered w-full"
                                                   maxlength="500"
                                                   {% if question.required %}required{% endif %}
                                                   placeholder="Enter your answer...">
                                        
                                        {% elif question.type == 'LONG_TEXT' %}
                                            <textarea name="question_{{ question.pk }}"
                                                      class="textarea textarea-bordered w-full"
                                                      rows="4"
                                                      {% if question.required %}required{% endif %}
                                                      placeholder="Enter your answer..."></textarea>
                                        
                                        {% elif question.type == 'NUMBER' %}
                                            <input type="number" 
                                                   name="question_{{ question.pk }}"
                                                   class="input input-bordered w-full"
                                                   min="{{ question.scale_min }}"
                                                   max="{{ question.scale_max }}"
                                                   {% if question.required %}required{% endif %}
                                                   placeholder="Enter a number between {{ question.scale_min }} and {{ question.scale_max }}">
                                        
                                        {% elif question.type == 'DATE' %}
                                            <input type="date" 
                                                   name="question_{{ question.pk }}"
                                                   class="input input-bordered w-full"
                                                   {% if question.required %}required{% endif %}>
                                        
                                        {% elif question.type == 'RANK' %}
                                            <select name="question_{{ question.pk }}"
                                                    class="select select-bordered w-full"
                                                    {% if question.required %}required{% endif %}>
                                                <option value="">Select an option</option>
                                                {% for option in question.options %}
                                                    <option value="{{ option }}">{{ option }}</option>
                                                {% endfor %}
                                            </select>
                                        {% endif %}
                                        
                                        <!-- Anonymity-specific fields for text questions -->
                                        {% if question.type == 'SHORT_TEXT' or question.type == 'LONG_TEXT' %}
                                            {% if question.anonymity_mode == 'ESCROW' %}
                                                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                                                    <label class="flex items-center mb-3">
                                                        <input type="checkbox" 
                                                               name="question_{{ question.pk }}_followup"
                                                               class="checkbox checkbox-primary"
                                                               checked>
                                                        <span class="ml-2 text-sm">I'm open to follow-up questions about this answer</span>
                                                    </label>
                                                    <input type="text" 
                                                           name="question_{{ question.pk }}_contact"
                                                           class="input input-bordered w-full text-sm"
                                                           placeholder="Preferred contact method (optional)">
                                                </div>
                                            {% endif %}
                                            
                                            {% if question.anonymity_mode in 'ESCROW,SIGNED' %}
                                                <div class="mt-4 p-4 bg-green-50 rounded-lg">
                                                    <label class="flex items-center">
                                                        <input type="checkbox" 
                                                               name="question_{{ question.pk }}_signed"
                                                               class="checkbox checkbox-primary"
                                                               {% if question.anonymity_mode == 'SIGNED' %}checked{% endif %}>
                                                        <span class="ml-2 text-sm">Sign this answer with my name</span>
                                                    </label>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% endfor %}
        
        <!-- Final Comment Section -->
        <div class="card bg-white shadow-lg">
            <div class="card-body">
                                <h3 class="text-lg font-medium text-gray-800 mb-4">Additional Comments (Optional)</h3>
                                <textarea name="final_comment"
                                          class="textarea textarea-bordered w-full"
                                          rows="3"
                                          placeholder="Any additional thoughts or feedback..."></textarea>
                                
                                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                                    <label class="flex items-center mb-3">
                                        <input type="checkbox" 
                                               name="final_comment_signed"
                                               class="checkbox checkbox-primary">
                                        <span class="ml-2 text-sm">Sign this comment with my name</span>
                                    </label>
                                </div>
                            </div>
                        </div>
        
        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" class="btn btn-primary btn-lg">
                Submit Survey
            </button>
        </div>
    </form>
</div>

<script>
// Progress tracking
document.addEventListener('DOMContentLoaded', function() {
    const totalQuestions = {{ survey.sections.count }};
    const progressBar = document.getElementById('progress-bar');
    const currentQuestionSpan = document.getElementById('current-question');
    
    // Update progress as user scrolls
    function updateProgress() {
        const scrollTop = window.pageYOffset;
        const docHeight = document.body.offsetHeight - window.innerHeight;
        const scrollPercent = scrollTop / docHeight;
        const progress = Math.min(scrollPercent * totalQuestions, totalQuestions);
        
        progressBar.style.width = (progress / totalQuestions * 100) + '%';
        currentQuestionSpan.textContent = Math.max(1, Math.ceil(progress));
    }
    
    window.addEventListener('scroll', updateProgress);
    updateProgress();
    
    // Form validation
    const form = document.getElementById('survey-form');
    form.addEventListener('submit', function(e) {
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value) {
                isValid = false;
                field.classList.add('input-error');
            } else {
                field.classList.remove('input-error');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            alert('Please complete all required questions before submitting.');
        }
    });
});
</script>
{% endblock %}

```

### surveys/templates/surveys/results_index.html
```python
{% extends 'base.html' %}
{% block title %}{{ page_title }}{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">Survey Results</h1>
  {% if surveys %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for s in surveys %}
    <div class="card bg-white shadow">
      <div class="card-body">
        <h2 class="card-title">{{ s.title }}</h2>
        <a href="{% url 'surveys:survey_reports' s.pk %}" class="btn btn-outline btn-sm">Open</a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="opacity-70">No results available.</div>
  {% endif %}
</div>
{% endblock %}


```

### surveys/templates/surveys/my_invites.html
```python
{% extends 'base.html' %}
{% load humanize %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">My Survey Invites</h1>
        <a href="{% url 'surveys:list' %}" class="btn btn-ghost">Browse Surveys</a>
    </div>

    {% include 'surveys/partials/privacy_explainer.html' %}

    {% if invites %}
    <div class="space-y-4">
        {% for invite in invites %}
        <div class="card bg-white shadow">
            <div class="card-body">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="card-title">{{ invite.survey.title }}</h2>
                        <p class="text-sm opacity-70">Expires {{ invite.expires_at|naturaltime }}</p>
                    </div>
                    <div class="card-actions">
                        <a href="{% url 'surveys:take_with_token' invite.survey_id invite.token %}" class="btn btn-primary">Start</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 opacity-70">No pending invites.</div>
    {% endif %}
</div>
{% endblock %}



```

### surveys/templates/surveys/survey_list.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">Available Surveys</h1>
        <p class="text-lg text-gray-600">Share your feedback and help us improve</p>
    </div>

    {% if surveys %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for survey in surveys %}
                <div class="card bg-white shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div class="card-body">
                        <h2 class="card-title text-xl font-semibold text-gray-800">
                            {{ survey.title }}
                        </h2>
                        
                        {% if survey.description %}
                            <p class="text-gray-600 mb-4">{{ survey.description|truncatewords:20 }}</p>
                        {% endif %}
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            <div class="badge badge-primary">
                                {{ survey.sections_count }} section{{ survey.sections_count|pluralize }}
                            </div>
                            <div class="badge badge-secondary">
                                {{ survey.response_count }} response{{ survey.response_count|pluralize }}
                            </div>
                            {% if survey.is_active %}
                                <div class="badge badge-success">Active</div>
                            {% else %}
                                <div class="badge badge-warning">Inactive</div>
                            {% endif %}
                        </div>
                        
                        <div class="text-sm text-gray-500 mb-4">
                            <p><strong>Available:</strong> {{ survey.publish_start|date:"M j, Y" }} - {{ survey.publish_end|date:"M j, Y" }}</p>
                        </div>
                        
                        <div class="card-actions justify-end">
                            <a href="{% url 'surveys:detail' survey.pk %}" 
                               class="btn btn-primary">
                                View Details
                            </a>
                            {% if survey.is_active %}
                                <a href="{% url 'surveys:take' survey.pk %}" 
                                   class="btn btn-outline btn-primary">
                                    Take Survey
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📝</div>
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">No Surveys Available</h2>
            <p class="text-gray-600 mb-6">There are currently no active surveys to complete.</p>
            {% if user.is_staff %}
                <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-primary">
                    Manage Surveys
                </a>
            {% endif %}
        </div>
    {% endif %}
    
    {% if user.is_staff %}
        <div class="text-center mt-8">
            <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline btn-primary">
                Survey Administration
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

```

### surveys/templates/surveys/admin/survey_invites.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Manage Invites: {{ survey.title }}</h1>
        <p class="text-gray-600 mt-2">Send invitations and track survey participation</p>
    </div>

    <!-- Survey Status -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Survey Status</h2>
                    <div class="flex items-center gap-4 text-sm">
                        <span class="badge {% if survey.status == 'PUBLISHED' %}badge-success{% elif survey.status == 'DRAFT' %}badge-warning{% else %}badge-error{% endif %}">
                            {{ survey.status }}
                        </span>
                        <span class="text-gray-600">
                            Published: {{ survey.publish_start|date:"M j, Y" }} - {{ survey.publish_end|date:"M j, Y" }}
                        </span>
                    </div>
                </div>
                
                <div class="text-right">
                    <div class="text-2xl font-bold text-primary">{{ survey.response_count }}</div>
                    <div class="text-sm text-gray-500">Total Responses</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Invite Form -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Send Bulk Invitations</h2>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Invite Type</span>
                        </label>
                        <div class="space-y-3">
                            {% for choice in form.invite_type.field.choices %}
                                <label class="flex items-center">
                                    <input type="radio" name="{{ form.invite_type.name }}" 
                                           value="{{ choice.0 }}" 
                                           class="radio radio-primary"
                                           {% if choice.0 == form.invite_type.value %}checked{% endif %}>
                                    <span class="ml-2">{{ choice.1 }}</span>
                                </label>
                            {% endfor %}
                        </div>
                        {% if form.invite_type.errors %}
                            <div class="text-error text-sm mt-1">{{ form.invite_type.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Invite Expiration</span>
                        </label>
                        {{ form.expires_in_days }}
                        <label class="label">
                            <span class="label-text-alt">{{ form.expires_in_days.help_text }}</span>
                        </label>
                        {% if form.expires_in_days.errors %}
                            <div class="text-error text-sm mt-1">{{ form.expires_in_days.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Manual Email List -->
                <div id="manual-email-section" class="hidden">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Email Addresses</span>
                        </label>
                        {{ form.email_list }}
                        <label class="label">
                            <span class="label-text-alt">{{ form.email_list.help_text }}</span>
                        </label>
                        {% if form.email_list.errors %}
                            <div class="text-error text-sm mt-1">{{ form.email_list.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Group Selection -->
                <div id="group-selection-section" class="hidden">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Select Users</span>
                        </label>
                        {{ form.groups }}
                        {% if form.groups.errors %}
                            <div class="text-error text-sm mt-1">{{ form.groups.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                        Send Invitations
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Existing Invites -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Existing Invitations</h2>
            
            {% if invites %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Token</th>
                                <th>Status</th>
                                <th>Expires</th>
                                <th>Used</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for invite in invites %}
                                <tr>
                                    <td>
                                        {% if invite.email %}
                                            {{ invite.email }}
                                        {% else %}
                                            <span class="text-gray-500 italic">Anonymous</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <code class="text-xs bg-gray-100 px-2 py-1 rounded">
                                            {{ invite.token|slice:":8" }}...
                                        </code>
                                    </td>
                                    <td>
                                        {% if invite.is_expired %}
                                            <span class="badge badge-error">Expired</span>
                                        {% elif invite.is_used %}
                                            <span class="badge badge-warning">Used</span>
                                        {% else %}
                                            <span class="badge badge-success">Valid</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="text-sm">
                                            <div>{{ invite.expires_at|date:"M j, Y" }}</div>
                                            <div class="text-gray-500">{{ invite.expires_at|date:"g:i A" }}</div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if invite.used_at %}
                                            <div class="text-sm">
                                                <div>{{ invite.used_at|date:"M j, Y" }}</div>
                                                <div class="text-gray-500">{{ invite.used_at|date:"g:i A" }}</div>
                                            </div>
                                        {% else %}
                                            <span class="text-gray-500">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="flex gap-2">
                                            {% if not invite.is_used and not invite.is_expired %}
                                                <button class="btn btn-xs btn-outline" 
                                                        onclick="copyInviteLink('{{ invite.token }}')">
                                                    Copy Link
                                                </button>
                                                <button class="btn btn-xs btn-error" 
                                                        onclick="deleteInvite({{ invite.pk }})">
                                                    Delete
                                                </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Invite Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                    <div class="stat bg-gray-50 rounded-lg">
                        <div class="stat-title text-sm">Total Invites</div>
                        <div class="stat-value text-primary text-2xl">{{ invites.count }}</div>
                    </div>
                    
                    <div class="stat bg-green-50 rounded-lg">
                        <div class="stat-title text-sm">Valid</div>
                        <div class="stat-value text-success text-2xl">{{ invites|length|add:"0" }}</div>
                    </div>
                    
                    <div class="stat bg-yellow-50 rounded-lg">
                        <div class="stat-title text-sm">Used</div>
                        <div class="stat-value text-warning text-2xl">{{ invites|length|add:"0" }}</div>
                    </div>
                    
                    <div class="stat bg-red-50 rounded-lg">
                        <div class="stat-title text-sm">Expired</div>
                        <div class="stat-value text-error text-2xl">{{ invites|length|add:"0" }}</div>
                    </div>
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">📧</div>
                    <p class="text-gray-600">No invitations have been sent yet.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex justify-between items-center">
        <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline">
            ← Back to Surveys
        </a>
        
        <div class="flex gap-4">
            <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-outline btn-primary">
                Edit Survey
            </a>
            <a href="{% url 'surveys:survey_reports' survey.pk %}" class="btn btn-outline btn-secondary">
                View Reports
            </a>
        </div>
    </div>
</div>

<script>
// Show/hide sections based on invite type selection
document.addEventListener('DOMContentLoaded', function() {
    const inviteTypeRadios = document.querySelectorAll('input[name="invite_type"]');
    const manualEmailSection = document.getElementById('manual-email-section');
    const groupSelectionSection = document.getElementById('group-selection-section');
    
    function updateSections() {
        const selectedType = document.querySelector('input[name="invite_type"]:checked').value;
        
        manualEmailSection.classList.add('hidden');
        groupSelectionSection.classList.add('hidden');
        
        if (selectedType === 'manual_list') {
            manualEmailSection.classList.remove('hidden');
        } else if (selectedType === 'by_group') {
            groupSelectionSection.classList.remove('hidden');
        }
    }
    
    inviteTypeRadios.forEach(radio => {
        radio.addEventListener('change', updateSections);
    });
    
    // Initialize on page load
    updateSections();
});

function copyInviteLink(token) {
    const baseUrl = window.location.origin;
    const inviteUrl = `${baseUrl}/surveys/${surveyId}/response/${token}/`;
    
    navigator.clipboard.writeText(inviteUrl).then(function() {
        // Show success message
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('btn-success');
        button.classList.remove('btn-outline');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline');
        }, 2000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        alert('Failed to copy invite link. Please copy manually.');
    });
}

function deleteInvite(inviteId) {
    if (confirm('Are you sure you want to delete this invitation?')) {
        // This would typically be a POST request to delete the invite
        // For now, we'll just show a message
        alert('Invite deletion would be implemented here.');
    }
}

// Get survey ID from URL for the copy function
const surveyId = window.location.pathname.split('/')[2];
</script>
{% endblock %}

```

### surveys/templates/surveys/admin/survey_form.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<style>
    .drag-handle {
        cursor: move;
        color: #6b7280;
    }
    .drag-handle:hover {
        color: #374151;
    }
    .section-card, .question-card {
        transition: all 0.2s ease;
    }
    .section-card:hover, .question-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">{{ page_title }}</h1>
        <p class="text-gray-600 mt-2">Configure your survey settings and structure</p>
    </div>

    <form method="post" id="survey-form">
        {% csrf_token %}
        
        <!-- Survey Basic Info -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body">
                <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Survey Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Survey Title *</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <div class="text-error text-sm mt-1">{{ form.title.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">K-Anonymity Threshold *</span>
                        </label>
                        {{ form.k_threshold }}
                        <label class="label">
                            <span class="label-text-alt">Minimum cohort size for detailed reports</span>
                        </label>
                        {% if form.k_threshold.errors %}
                            <div class="text-error text-sm mt-1">{{ form.k_threshold.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-control mt-4">
                    <label class="label">
                        <span class="label-text font-medium">Description</span>
                    </label>
                    {{ form.description }}
                    {% if form.description.errors %}
                        <div class="text-error text-sm mt-1">{{ form.description.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Publish Start Date *</span>
                        </label>
                        {{ form.publish_start }}
                        {% if form.publish_start.errors %}
                            <div class="text-error text-sm mt-1">{{ form.publish_start.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Publish End Date *</span>
                        </label>
                        {{ form.publish_end }}
                        {% if form.publish_end.errors %}
                            <div class="text-error text-sm mt-1">{{ form.publish_end.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sections Management -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="card-title text-xl font-semibold text-gray-800">Survey Sections</h2>
                    <button type="button" class="btn btn-primary" onclick="addSection()">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Section
                    </button>
                </div>
                
                <div id="sections-container" class="space-y-4">
                    {% if survey %}
                        {% for section in survey.sections.all %}
                            <div class="section-card card bg-gray-50 border-2 border-dashed border-gray-300" data-section-id="{{ section.pk }}">
                                <div class="card-body">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <span class="drag-handle text-2xl">⋮⋮</span>
                                            <h3 class="text-lg font-medium">Section {{ forloop.counter }}</h3>
                                        </div>
                                        <button type="button" class="btn btn-sm btn-error" onclick="removeSection(this)">
                                            Remove
                                        </button>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text">Section Title</span>
                                            </label>
                                            <input type="text" name="section_{{ section.pk }}_title" 
                                                   value="{{ section.title }}" 
                                                   class="input input-bordered w-full" required>
                                        </div>
                                        
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text">Order</span>
                                            </label>
                                            <input type="number" name="section_{{ section.pk }}_order" 
                                                   value="{{ section.order }}" 
                                                   class="input input-bordered w-full" min="0" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-control mt-4">
                                        <label class="label">
                                            <span class="label-text">Description</span>
                                        </label>
                                        <textarea name="section_{{ section.pk }}_description" 
                                                  class="textarea textarea-bordered w-full" 
                                                  rows="2">{{ section.description }}</textarea>
                                    </div>
                                    
                                    <!-- Questions in this section -->
                                    <div class="mt-6">
                                        <div class="flex justify-between items-center mb-4">
                                            <h4 class="font-medium text-gray-700">Questions</h4>
                                            <button type="button" class="btn btn-sm btn-outline" onclick="addQuestion(this)">
                                                Add Question
                                            </button>
                                        </div>
                                        
                                        <div class="questions-container space-y-3">
                                            {% for question in section.questions.all %}
                                                <div class="question-card card bg-white border border-gray-200" data-question-id="{{ question.pk }}">
                                                    <div class="card-body p-4">
                                                        <div class="flex items-center justify-between mb-3">
                                                            <div class="flex items-center gap-3">
                                                                <span class="drag-handle text-xl">⋮⋮</span>
                                                                <span class="text-sm font-medium">Question {{ forloop.counter }}</span>
                                                            </div>
                                                            <button type="button" class="btn btn-xs btn-error" onclick="removeQuestion(this)">
                                                                Remove
                                                            </button>
                                                        </div>
                                                        
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Question Type</span>
                                                                </label>
                                                                <select name="question_{{ question.pk }}_type" class="select select-bordered w-full" required>
                                                                    <option value="LIKERT" {% if question.type == 'LIKERT' %}selected{% endif %}>Likert Scale</option>
                                                                    <option value="MULTI" {% if question.type == 'MULTI' %}selected{% endif %}>Multiple Choice</option>
                                                                    <option value="SINGLE" {% if question.type == 'SINGLE' %}selected{% endif %}>Single Choice</option>
                                                                    <option value="SHORT_TEXT" {% if question.type == 'SHORT_TEXT' %}selected{% endif %}>Short Text</option>
                                                                    <option value="LONG_TEXT" {% if question.type == 'LONG_TEXT' %}selected{% endif %}>Long Text</option>
                                                                    <option value="NPS" {% if question.type == 'NPS' %}selected{% endif %}>Net Promoter Score</option>
                                                                    <option value="NUMBER" {% if question.type == 'NUMBER' %}selected{% endif %}>Number</option>
                                                                    <option value="DATE" {% if question.type == 'DATE' %}selected{% endif %}>Date</option>
                                                                    <option value="RANK" {% if question.type == 'RANK' %}selected{% endif %}>Ranking</option>
                                                                </select>
                                                            </div>
                                                            
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Anonymity Mode</span>
                                                                </label>
                                                                <select name="question_{{ question.pk }}_anonymity" class="select select-bordered w-full" required>
                                                                    <option value="ANONYMOUS" {% if question.anonymity_mode == 'ANONYMOUS' %}selected{% endif %}>Anonymous</option>
                                                                    <option value="ESCROW" {% if question.anonymity_mode == 'ESCROW' %}selected{% endif %}>Private (Escrow)</option>
                                                                    <option value="SIGNED" {% if question.anonymity_mode == 'SIGNED' %}selected{% endif %}>Signed</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="form-control mt-4">
                                                            <label class="label">
                                                                <span class="label-text">Question Prompt *</span>
                                                            </label>
                                                            <textarea name="question_{{ question.pk }}_prompt" 
                                                                      class="textarea textarea-bordered w-full" 
                                                                      rows="2" required>{{ question.prompt }}</textarea>
                                                        </div>
                                                        
                                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Order</span>
                                                                </label>
                                                                <input type="number" name="question_{{ question.pk }}_order" 
                                                                       value="{{ question.order }}" 
                                                                       class="input input-bordered w-full" min="0" required>
                                                            </div>
                                                            
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Required</span>
                                                                </label>
                                                                <label class="label cursor-pointer">
                                                                    <input type="checkbox" name="question_{{ question.pk }}_required" 
                                                                           class="checkbox checkbox-primary" 
                                                                           {% if question.required %}checked{% endif %}>
                                                                    <span class="label-text ml-2">Required</span>
                                                                </label>
                                                            </div>
                                                            
                                                            <div class="form-control">
                                                                <label class="label">
                                                                    <span class="label-text">Help Text</span>
                                                                </label>
                                                                <input type="text" name="question_{{ question.pk }}_help" 
                                                                       value="{{ question.help_text }}" 
                                                                       class="input input-bordered w-full">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-between items-center">
            <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                {% if survey %}Update Survey{% else %}Create Survey{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
let sectionCounter = 0;
let questionCounter = 0;

function addSection() {
    sectionCounter++;
    const container = document.getElementById('sections-container');
    const sectionHtml = `
        <div class="section-card card bg-gray-50 border-2 border-dashed border-gray-300" data-section-id="new_${sectionCounter}">
            <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <span class="drag-handle text-2xl">⋮⋮</span>
                        <h3 class="text-lg font-medium">New Section</h3>
                    </div>
                    <button type="button" class="btn btn-sm btn-error" onclick="removeSection(this)">
                        Remove
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Section Title</span>
                        </label>
                        <input type="text" name="new_section_${sectionCounter}_title" 
                               class="input input-bordered w-full" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Order</span>
                        </label>
                        <input type="number" name="new_section_${sectionCounter}_order" 
                               value="${sectionCounter}" 
                               class="input input-bordered w-full" min="0" required>
                    </div>
                </div>
                
                <div class="form-control mt-4">
                    <label class="label">
                        <span class="label-text">Description</span>
                    </label>
                    <textarea name="new_section_${sectionCounter}_description" 
                              class="textarea textarea-bordered w-full" 
                              rows="2"></textarea>
                </div>
                
                <div class="mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-medium text-gray-700">Questions</h4>
                        <button type="button" class="btn btn-sm btn-outline" onclick="addQuestion(this)">
                            Add Question
                        </button>
                    </div>
                    
                    <div class="questions-container space-y-3">
                        <!-- Questions will be added here -->
                    </div>
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', sectionHtml);
}

function removeSection(button) {
    if (confirm('Are you sure you want to remove this section? All questions will be deleted.')) {
        button.closest('.section-card').remove();
    }
}

function addQuestion(button) {
    questionCounter++;
    const questionsContainer = button.closest('.card-body').querySelector('.questions-container');
    const questionHtml = `
        <div class="question-card card bg-white border border-gray-200" data-question-id="new_${questionCounter}">
            <div class="card-body p-4">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <span class="drag-handle text-xl">⋮⋮</span>
                        <span class="text-sm font-medium">New Question</span>
                    </div>
                    <button type="button" class="btn btn-xs btn-error" onclick="removeQuestion(this)">
                        Remove
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Question Type</span>
                        </label>
                        <select name="new_question_${questionCounter}_type" class="select select-bordered w-full" required>
                            <option value="LIKERT">Likert Scale</option>
                            <option value="MULTI">Multiple Choice</option>
                            <option value="SINGLE">Single Choice</option>
                            <option value="SHORT_TEXT">Short Text</option>
                            <option value="LONG_TEXT">Long Text</option>
                            <option value="NPS">Net Promoter Score</option>
                            <option value="NUMBER">Number</option>
                            <option value="DATE">Date</option>
                            <option value="RANK">Ranking</option>
                        </select>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Anonymity Mode</span>
                        </label>
                        <select name="new_question_${questionCounter}_anonymity" class="select select-bordered w-full" required>
                            <option value="ANONYMOUS">Anonymous</option>
                            <option value="ESCROW" selected>Private (Escrow)</option>
                            <option value="SIGNED">Signed</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-control mt-4">
                    <label class="label">
                        <span class="label-text">Question Prompt *</span>
                    </label>
                    <textarea name="new_question_${questionCounter}_prompt" 
                              class="textarea textarea-bordered w-full" 
                              rows="2" required placeholder="Enter your question here..."></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Order</span>
                        </label>
                        <input type="number" name="new_question_${questionCounter}_order" 
                               value="${questionCounter}" 
                               class="input input-bordered w-full" min="0" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Required</span>
                        </label>
                        <label class="label cursor-pointer">
                            <input type="checkbox" name="new_question_${questionCounter}_required" 
                                   class="checkbox checkbox-primary" checked>
                            <span class="label-text ml-2">Required</span>
                        </label>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Help Text</span>
                        </label>
                        <input type="text" name="new_question_${questionCounter}_help" 
                               class="input input-bordered w-full" placeholder="Optional help text">
                    </div>
                </div>
            </div>
        </div>
    `;
    questionsContainer.insertAdjacentHTML('beforeend', questionHtml);
}

function removeQuestion(button) {
    if (confirm('Are you sure you want to remove this question?')) {
        button.closest('.question-card').remove();
    }
}

// Initialize drag and drop functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add drag and drop for sections and questions
    // This would integrate with HTMX for server-side reordering
});
</script>
{% endblock %}

```

### surveys/templates/surveys/admin/survey_list.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">Survey Administration</h1>
            <p class="text-gray-600 mt-2">Create and manage company surveys</p>
        </div>
        <a href="{% url 'surveys:builder' %}" class="btn btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Create Survey
        </a>
    </div>

    {% if surveys %}
        <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Created By</th>
                        <th>Publish Dates</th>
                        <th>Responses</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for survey in surveys %}
                        <tr>
                            <td>
                                <div>
                                    <div class="font-semibold">{{ survey.title }}</div>
                                    {% if survey.description %}
                                        <div class="text-sm text-gray-500">{{ survey.description|truncatewords:10 }}</div>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if survey.status == 'DRAFT' %}
                                    <span class="badge badge-warning">Draft</span>
                                {% elif survey.status == 'PUBLISHED' %}
                                    {% if survey.is_active %}
                                        <span class="badge badge-success">Active</span>
                                    {% else %}
                                        <span class="badge badge-info">Published</span>
                                    {% endif %}
                                {% elif survey.status == 'CLOSED' %}
                                    <span class="badge badge-error">Closed</span>
                                {% else %}
                                    <span class="badge badge-neutral">Archived</span>
                                {% endif %}
                            </td>
                            <td>{{ survey.created_by.username }}</td>
                            <td>
                                <div class="text-sm">
                                    <div><strong>Start:</strong> {{ survey.publish_start|date:"M j, Y" }}</div>
                                    <div><strong>End:</strong> {{ survey.publish_end|date:"M j, Y" }}</div>
                                </div>
                            </td>
                            <td>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-primary">{{ survey.response_count }}</div>
                                    <div class="text-sm text-gray-500">responses</div>
                                </div>
                            </td>
                            <td>
                                <div class="flex flex-col gap-2">
                                    <a href="{% url 'surveys:survey_edit' survey.pk %}" 
                                       class="btn btn-sm btn-outline">
                                        Edit
                                    </a>
                                    
                                    <form method="post" action="{% url 'surveys:publish' survey.pk %}" 
                                          class="inline">
                                        {% csrf_token %}
                                        {% if survey.status == 'DRAFT' %}
                                            <button type="submit" name="action" value="publish" 
                                                    class="btn btn-sm btn-success">
                                                Publish
                                            </button>
                                        {% elif survey.status == 'PUBLISHED' %}
                                            <button type="submit" name="action" value="unpublish" 
                                                    class="btn btn-sm btn-warning">
                                                Unpublish
                                            </button>
                                            <button type="submit" name="action" value="close" 
                                                    class="btn btn-sm btn-error">
                                                Close
                                            </button>
                                        {% endif %}
                                    </form>
                                    
                                    <a href="{% url 'surveys:survey_invites' survey.pk %}" 
                                       class="btn btn-sm btn-outline btn-info">
                                        Invites
                                    </a>
                                    
                                    <a href="{% url 'surveys:survey_reports' survey.pk %}" 
                                       class="btn btn-sm btn-outline btn-secondary">
                                        Reports
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📊</div>
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">No Surveys Created Yet</h2>
            <p class="text-gray-600 mb-6">Get started by creating your first survey to collect feedback from your team.</p>
            <a href="{% url 'surveys:survey_create' %}" class="btn btn-primary btn-lg">
                Create Your First Survey
            </a>
        </div>
    {% endif %}
    
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-8">
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-primary">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Surveys</div>
            <div class="stat-value text-primary">{{ surveys.count }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-success">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Active Surveys</div>
            <div class="stat-value text-success">{{ surveys|length|add:"0" }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-info">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Responses</div>
            <div class="stat-value text-info">{{ surveys|length|add:"0" }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-warning">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Draft Surveys</div>
            <div class="stat-value text-warning">{{ surveys|length|add:"0" }}</div>
        </div>
    </div>
</div>
{% endblock %}

```

### surveys/templates/surveys/partials/privacy_explainer.html
```python
<div class="alert alert-info shadow mb-6">
  <div>
    <span class="font-semibold">Privacy & Anonymity</span>
    <div class="text-sm opacity-80 mt-2">
      <p class="mb-1"><span class="badge badge-warning mr-2">Anonymous</span> Never stores identity.</p>
      <p class="mb-1"><span class="badge badge-info mr-2">Private</span> Identity held privately (escrow); follow-up optional.</p>
      <p class="mb-1"><span class="badge badge-success mr-2">Signed</span> Name shown with answer.</p>
      <p class="mt-2">Reports hide small cohorts to protect privacy (k-anonymity threshold).</p>
      <p class="mt-1">We value candor and have a strict non-retaliation policy.</p>
    </div>
  </div>
</div>


```

### surveys/templates/surveys/reports/survey_reports.html
```python
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Survey Reports: {{ survey.title }}</h1>
        <p class="text-gray-600 mt-2">Analyze responses and generate insights</p>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-primary">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Responses</div>
            <div class="stat-value text-primary">{{ total_responses }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-success">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
            </div>
            <div class="stat-title">Response Rate</div>
            <div class="stat-value text-success">{{ response_rate|floatformat:1 }}%</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-info">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Sections</div>
            <div class="stat-value text-info">{{ survey.sections.count }}</div>
        </div>
        
        <div class="stat bg-white shadow-lg rounded-lg">
            <div class="stat-figure text-warning">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Questions</div>
            <div class="stat-value text-warning">{{ survey.sections.all|length }}</div>
        </div>
    </div>

    <!-- Report Generation Form -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Generate Report</h2>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Report Type</span>
                        </label>
                        <div class="space-y-2">
                            {% for choice in form.report_type.field.choices %}
                                <label class="flex items-center">
                                    <input type="radio" name="{{ form.report_type.name }}" 
                                           value="{{ choice.0 }}" 
                                           class="radio radio-primary"
                                           {% if choice.0 == form.report_type.value %}checked{% endif %}>
                                    <span class="ml-2">{{ choice.1 }}</span>
                                </label>
                            {% endfor %}
                        </div>
                        {% if form.report_type.errors %}
                            <div class="text-error text-sm mt-1">{{ form.report_type.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Export Format</span>
                        </label>
                        {{ form.export_format }}
                        {% if form.export_format.errors %}
                            <div class="text-error text-sm mt-1">{{ form.export_format.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Date Range (Optional)</span>
                        </label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="label">
                                    <span class="label-text text-sm">From</span>
                                </label>
                                {{ form.date_from }}
                            </div>
                            <div>
                                <label class="label">
                                    <span class="label-text text-sm">To</span>
                                </label>
                                {{ form.date_to }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Options</span>
                        </label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                {{ form.include_anonymous }}
                                <span class="ml-2 text-sm">{{ form.include_anonymous.label }}</span>
                            </label>
                        </div>
                        
                        <div class="mt-4">
                            <label class="label">
                                <span class="label-text text-sm">{{ form.min_cohort_size.help_text }}</span>
                            </label>
                            {{ form.min_cohort_size }}
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Generate Report
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Recent Responses -->
    <div class="card bg-white shadow-lg mb-8">
        <div class="card-body">
            <h2 class="card-title text-xl font-semibold text-gray-800 mb-4">Recent Responses</h2>
            
            {% if survey.responses.all %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>Respondent</th>
                                <th>Submitted</th>
                                <th>Answers</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for response in survey.responses.all|slice:":10" %}
                                <tr>
                                    <td>
                                        {% if response.identity_user %}
                                            <div class="flex items-center gap-3">
                                                <div class="avatar placeholder">
                                                    <div class="bg-neutral text-neutral-content rounded-full w-8">
                                                        <span class="text-xs">{{ response.identity_user.username|slice:":2"|upper }}</span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="font-medium">{{ response.identity_user.username }}</div>
                                                    <div class="text-sm text-gray-500">{{ response.identity_user.email }}</div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <span class="text-gray-500 italic">Anonymous</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ response.submitted_at|date:"M j, Y H:i" }}</td>
                                    <td>{{ response.answers.count }} answers</td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-outline">View Details</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if survey.responses.count > 10 %}
                    <div class="text-center mt-4">
                        <a href="#" class="btn btn-outline">View All {{ survey.responses.count }} Responses</a>
                    </div>
                {% endif %}
            {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">📝</div>
                    <p class="text-gray-600">No responses yet for this survey.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex justify-between items-center">
        <a href="{% url 'surveys:survey_admin_list' %}" class="btn btn-outline">
            ← Back to Surveys
        </a>
        
        <div class="flex gap-4">
            <a href="{% url 'surveys:survey_invites' survey.pk %}" class="btn btn-outline btn-info">
                Manage Invites
            </a>
            <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-outline btn-primary">
                Edit Survey
            </a>
        </div>
    </div>
</div>
{% endblock %}

```

### App: userprofile
### userprofile/models.py
```python
from django.db import models
from django.contrib.auth.models import User
from django.db.models.signals import post_save
from django.dispatch import receiver
from django.urls import reverse
from PIL import Image as PILImage
import os

class UserProfile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='profile')
    avatar = models.ImageField(upload_to='avatars/', blank=True, null=True, default='avatars/default.png')
    bio = models.TextField(max_length=500, blank=True, null=True)
    phone = models.CharField(max_length=20, blank=True, null=True)
    company = models.CharField(max_length=100, blank=True, null=True)
    position = models.CharField(max_length=100, blank=True, null=True)
    website = models.URLField(blank=True, null=True)
    location = models.CharField(max_length=100, blank=True, null=True)
    date_of_birth = models.DateField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return f"{self.user.username}'s Profile"

    def get_absolute_url(self):
        return reverse('userprofile:profile_view', kwargs={'pk': self.user.pk})

    def save(self, *args, **kwargs):
        super().save(*args, **kwargs)

        # Resize avatar if it exists and is not the default
        if self.avatar and self.avatar.name != 'avatars/default.png':
            self.resize_avatar()

    def resize_avatar(self):
        """Resize avatar to 300x300 pixels"""
        if self.avatar:
            try:
                with PILImage.open(self.avatar.path) as img:
                    # Convert to RGB if necessary
                    if img.mode != 'RGB':
                        img = img.convert('RGB')

                    # Resize image to 300x300 while maintaining aspect ratio
                    img.thumbnail((300, 300), PILImage.Resampling.LANCZOS)

                    # Save the resized image
                    img.save(self.avatar.path, 'JPEG', quality=85)
            except Exception as e:
                print(f"Error resizing avatar: {e}")

    @property
    def full_name(self):
        """Get user's full name"""
        if self.user.first_name and self.user.last_name:
            return f"{self.user.first_name} {self.user.last_name}"
        return self.user.username

    @property
    def initials(self):
        """Get user's initials for avatar placeholder"""
        if self.user.first_name and self.user.last_name:
            return f"{self.user.first_name[0]}{self.user.last_name[0]}".upper()
        return self.user.username[:2].upper()

    @property
    def has_avatar(self):
        """Check if user has a custom avatar"""
        return self.avatar and self.avatar.name != 'avatars/default.png'

# Signal to automatically create UserProfile when User is created
@receiver(post_save, sender=User)
def create_user_profile(sender, instance, created, **kwargs):
    if created:
        UserProfile.objects.create(user=instance)

@receiver(post_save, sender=User)
def save_user_profile(sender, instance, **kwargs):
    instance.profile.save()

```

### userprofile/views.py
```python
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from django.contrib.auth.models import User
from .models import UserProfile
from .forms import UserProfileForm, UserUpdateForm, PasswordChangeForm

@login_required
def profile_view(request, username=None):
    """View user profile"""
    if username:
        user = get_object_or_404(User, username=username)
    else:
        user = request.user
    
    # Get or create profile
    try:
        profile = user.profile
    except UserProfile.DoesNotExist:
        # Create profile if it doesn't exist
        profile = UserProfile.objects.create(user=user)
    
    # Get user's recent files and images
    recent_files = user.file_set.all().order_by('-uploaded_at')[:5] if hasattr(user, 'file_set') else []
    recent_images = user.image_set.all().order_by('-uploaded_at')[:5] if hasattr(user, 'image_set') else []
    
    context = {
        'profile_user': user,
        'profile': profile,
        'recent_files': recent_files,
        'recent_images': recent_images,
        'is_own_profile': user == request.user,
    }
    return render(request, 'userprofile/profile_view.html', context)

@login_required
def profile_edit(request):
    """Edit user profile"""
    # Get or create profile
    try:
        profile = request.user.profile
    except UserProfile.DoesNotExist:
        profile = UserProfile.objects.create(user=request.user)
    
    if request.method == 'POST':
        user_form = UserUpdateForm(request.POST, instance=request.user)
        profile_form = UserProfileForm(request.POST, request.FILES, instance=profile)
        
        if user_form.is_valid() and profile_form.is_valid():
            user_form.save()
            profile_form.save()
            messages.success(request, 'Your profile has been updated successfully!')
            return redirect('userprofile:profile_view')
    else:
        user_form = UserUpdateForm(instance=request.user)
        profile_form = UserProfileForm(instance=profile)
    
    context = {
        'user_form': user_form,
        'profile_form': profile_form,
    }
    return render(request, 'userprofile/profile_edit.html', context)

@login_required
def password_change(request):
    """Change user password"""
    if request.method == 'POST':
        form = PasswordChangeForm(request.user, request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Your password has been changed successfully!')
            return redirect('userprofile:profile_view')
    else:
        form = PasswordChangeForm(request.user)
    
    context = {
        'form': form,
    }
    return render(request, 'userprofile/password_change.html', context)

@login_required
def profile_list(request):
    """List all user profiles (admin only)"""
    if not request.user.is_staff:
        messages.error(request, "You don't have permission to view all profiles.")
        return redirect('userprofile:profile_view')
    
    profiles = UserProfile.objects.all().order_by('user__username')
    context = {
        'profiles': profiles,
    }
    return render(request, 'userprofile/profile_list.html', context)

@login_required
def avatar_remove(request):
    """Remove user avatar"""
    if request.method == 'POST':
        # Get or create profile
        try:
            profile = request.user.profile
        except UserProfile.DoesNotExist:
            profile = UserProfile.objects.create(user=request.user)
        
        if profile.avatar and profile.has_avatar:
            # Delete the old avatar file
            if profile.avatar:
                profile.avatar.delete(save=False)
            profile.avatar = 'avatars/default.png'
            profile.save()
            messages.success(request, 'Avatar removed successfully!')
        else:
            messages.info(request, 'No custom avatar to remove.')
    
    return redirect('userprofile:profile_edit')

```

### userprofile/urls.py
```python
from django.urls import path
from . import views

app_name = 'userprofile'

urlpatterns = [
    path('', views.profile_view, name='profile_view'),
    path('<str:username>/', views.profile_view, name='profile_view'),
    path('edit/', views.profile_edit, name='profile_edit'),
    path('password/', views.password_change, name='password_change'),
    path('list/', views.profile_list, name='profile_list'),
    path('avatar/remove/', views.avatar_remove, name='avatar_remove'),
] 
```

### userprofile/forms.py
```python
from django import forms
from django.contrib.auth.models import User
from django.contrib.auth.forms import UserChangeForm
from .models import UserProfile

class UserProfileForm(forms.ModelForm):
    class Meta:
        model = UserProfile
        fields = ['avatar', 'bio', 'phone', 'company', 'position', 'website', 'location', 'date_of_birth']
        widgets = {
            'avatar': forms.FileInput(attrs={'class': 'file-input file-input-bordered w-full'}),
            'bio': forms.Textarea(attrs={'class': 'textarea textarea-bordered w-full', 'rows': 4, 'placeholder': 'Tell us about yourself...'}),
            'phone': forms.TextInput(attrs={'class': 'input input-bordered w-full', 'placeholder': '+1 (555) 123-4567'}),
            'company': forms.TextInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'Your Company'}),
            'position': forms.TextInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'Your Position'}),
            'website': forms.URLInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'https://yourwebsite.com'}),
            'location': forms.TextInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'City, State/Country'}),
            'date_of_birth': forms.DateInput(attrs={'class': 'input input-bordered w-full', 'type': 'date'}),
        }
    
    def clean_avatar(self):
        avatar = self.cleaned_data.get('avatar')
        if avatar:
            # Check file size (max 5MB)
            if avatar.size > 5 * 1024 * 1024:
                raise forms.ValidationError("Avatar image must be under 5MB.")
            
            # Check file extension
            allowed_extensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp']
            import os
            ext = os.path.splitext(avatar.name)[1].lower()
            if ext not in allowed_extensions:
                raise forms.ValidationError(f"Avatar must be one of: {', '.join(allowed_extensions)}")
        
        return avatar

class UserUpdateForm(forms.ModelForm):
    class Meta:
        model = User
        fields = ['first_name', 'last_name', 'email']
        widgets = {
            'first_name': forms.TextInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'First Name'}),
            'last_name': forms.TextInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'Last Name'}),
            'email': forms.EmailInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'email@example.com'}),
        }
    
    def clean_email(self):
        email = self.cleaned_data.get('email')
        if email:
            # Check if email is already taken by another user
            if User.objects.filter(email=email).exclude(pk=self.instance.pk).exists():
                raise forms.ValidationError("This email address is already in use.")
        return email

class PasswordChangeForm(forms.Form):
    current_password = forms.CharField(
        widget=forms.PasswordInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'Current Password'}),
        label='Current Password'
    )
    new_password1 = forms.CharField(
        widget=forms.PasswordInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'New Password'}),
        label='New Password'
    )
    new_password2 = forms.CharField(
        widget=forms.PasswordInput(attrs={'class': 'input input-bordered w-full', 'placeholder': 'Confirm New Password'}),
        label='Confirm New Password'
    )
    
    def __init__(self, user, *args, **kwargs):
        self.user = user
        super().__init__(*args, **kwargs)
    
    def clean_current_password(self):
        current_password = self.cleaned_data.get('current_password')
        if not self.user.check_password(current_password):
            raise forms.ValidationError("Your current password is incorrect.")
        return current_password
    
    def clean_new_password2(self):
        password1 = self.cleaned_data.get('new_password1')
        password2 = self.cleaned_data.get('new_password2')
        
        if password1 and password2:
            if password1 != password2:
                raise forms.ValidationError("The two password fields didn't match.")
            
            # Check password strength
            if len(password1) < 8:
                raise forms.ValidationError("Password must be at least 8 characters long.")
        
        return password2
    
    def save(self, commit=True):
        self.user.set_password(self.cleaned_data['new_password1'])
        if commit:
            self.user.save()
        return self.user 
```

### userprofile/admin.py
```python
from django.contrib import admin
from .models import UserProfile

@admin.register(UserProfile)
class UserProfileAdmin(admin.ModelAdmin):
    list_display = ('user', 'full_name', 'company', 'position', 'location', 'created_at')
    list_filter = ('created_at', 'company', 'location')
    search_fields = ('user__username', 'user__first_name', 'user__last_name', 'user__email', 'company', 'position')
    readonly_fields = ('created_at', 'updated_at')
    date_hierarchy = 'created_at'
    
    def full_name(self, obj):
        return obj.full_name
    full_name.short_description = 'Full Name'

```

### userprofile/apps.py
```python
from django.apps import AppConfig


class UserprofileConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'userprofile'

```

### userprofile/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in userprofile
### userprofile/templates/userprofile/profile_edit.html
```python
{% extends "base.html" %}

{% block title %}Edit Profile - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'userprofile:profile_view' %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to Profile
                </a>
                <h1 class="text-3xl font-bold text-base-content">Edit Profile</h1>
            </div>
        </div>

        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="alert alert-{% if message.tags == 'error' %}error{% else %}success{% endif %} mb-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {% if message.tags == 'error' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            {% else %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            {% endif %}
                        </svg>
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Avatar Section -->
                <div class="lg:col-span-1">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-xl mb-4">Avatar</h2>
                            
                            <div class="text-center mb-6">
                                <div class="avatar mb-4">
                                    <div class="w-32 h-32 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                                        {% if user.profile.has_avatar %}
                                            <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}'s avatar" class="w-full h-full object-cover">
                                        {% else %}
                                            <div class="bg-primary text-primary-content flex items-center justify-center text-4xl font-bold">
                                                {{ user.profile.initials }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-semibold">Upload New Avatar</span>
                                    </label>
                                    {{ profile_form.avatar }}
                                    {% if profile_form.avatar.errors %}
                                        <label class="label">
                                            <span class="label-text-alt text-error">{{ profile_form.avatar.errors.0 }}</span>
                                        </label>
                                    {% endif %}
                                    <label class="label">
                                        <span class="label-text-alt text-base-content/60">
                                            Maximum 5MB. JPG, PNG, GIF, WEBP
                                        </span>
                                    </label>
                                </div>
                                
                                {% if user.profile.has_avatar %}
                                    <form method="post" action="{% url 'userprofile:avatar_remove' %}" class="mt-4">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-error btn-sm w-full">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                            </svg>
                                            Remove Avatar
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Information -->
                <div class="lg:col-span-2">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-xl mb-6">Profile Information</h2>
                            
                            {% if user_form.errors or profile_form.errors %}
                                <div class="alert alert-error mb-6">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>Please correct the errors below.</span>
                                </div>
                            {% endif %}

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Basic Information -->
                                <div class="space-y-4">
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">First Name *</span>
                                        </label>
                                        {{ user_form.first_name }}
                                        {% if user_form.first_name.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ user_form.first_name.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>

                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Last Name *</span>
                                        </label>
                                        {{ user_form.last_name }}
                                        {% if user_form.last_name.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ user_form.last_name.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>

                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Email *</span>
                                        </label>
                                        {{ user_form.email }}
                                        {% if user_form.email.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ user_form.email.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>

                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Phone</span>
                                        </label>
                                        {{ profile_form.phone }}
                                        {% if profile_form.phone.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ profile_form.phone.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Professional Information -->
                                <div class="space-y-4">
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Company</span>
                                        </label>
                                        {{ profile_form.company }}
                                        {% if profile_form.company.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ profile_form.company.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>

                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Position</span>
                                        </label>
                                        {{ profile_form.position }}
                                        {% if profile_form.position.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ profile_form.position.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>

                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Website</span>
                                        </label>
                                        {{ profile_form.website }}
                                        {% if profile_form.website.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ profile_form.website.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>

                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text font-semibold">Location</span>
                                        </label>
                                        {{ profile_form.location }}
                                        {% if profile_form.location.errors %}
                                            <label class="label">
                                                <span class="label-text-alt text-error">{{ profile_form.location.errors.0 }}</span>
                                            </label>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Bio and Date of Birth -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-semibold">Bio</span>
                                    </label>
                                    {{ profile_form.bio }}
                                    {% if profile_form.bio.errors %}
                                        <label class="label">
                                            <span class="label-text-alt text-error">{{ profile_form.bio.errors.0 }}</span>
                                        </label>
                                    {% endif %}
                                </div>

                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-semibold">Date of Birth</span>
                                    </label>
                                    {{ profile_form.date_of_birth }}
                                    {% if profile_form.date_of_birth.errors %}
                                        <label class="label">
                                            <span class="label-text-alt text-error">{{ profile_form.date_of_birth.errors.0 }}</span>
                                        </label>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="card-actions justify-end mt-8">
                                <a href="{% url 'userprofile:profile_view' %}" class="btn btn-outline">Cancel</a>
                                <button type="submit" class="btn btn-primary">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                    Save Changes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %} 
```

### userprofile/templates/userprofile/profile_view.html
```python
{% extends "base.html" %}

{% block title %}{{ profile_user.username }}'s Profile - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Profile Header -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <div class="flex flex-col lg:flex-row items-start lg:items-center gap-6">
                    <!-- Avatar -->
                    <div class="avatar">
                        <div class="w-32 h-32 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                            {% if profile.has_avatar %}
                                <img src="{{ profile.avatar.url }}" alt="{{ profile_user.username }}'s avatar" class="w-full h-full object-cover">
                            {% else %}
                                <div class="bg-primary text-primary-content flex items-center justify-center text-4xl font-bold">
                                    {{ profile.initials }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Profile Info -->
                    <div class="flex-1">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div>
                                <h1 class="text-3xl font-bold text-base-content">{{ profile.full_name }}</h1>
                                <p class="text-base-content/70 text-lg">@{{ profile_user.username }}</p>
                                
                                {% if profile.company or profile.position %}
                                    <div class="flex items-center gap-2 mt-2">
                                        <svg class="w-5 h-5 text-base-content/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                        </svg>
                                        <span class="text-base-content/80">
                                            {% if profile.position %}{{ profile.position }}{% endif %}
                                            {% if profile.company %}{% if profile.position %} at {% endif %}{{ profile.company }}{% endif %}
                                        </span>
                                    </div>
                                {% endif %}
                                
                                {% if profile.location %}
                                    <div class="flex items-center gap-2 mt-1">
                                        <svg class="w-5 h-5 text-base-content/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                        <span class="text-base-content/80">{{ profile.location }}</span>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Action Buttons -->
                            {% if is_own_profile %}
                                <div class="flex gap-2">
                                    <a href="{% url 'userprofile:profile_edit' %}" class="btn btn-primary">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                        </svg>
                                        Edit Profile
                                    </a>
                                    <a href="{% url 'userprofile:password_change' %}" class="btn btn-outline">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                                        </svg>
                                        Change Password
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Profile Details -->
            <div class="lg:col-span-1">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-xl mb-4">Profile Details</h2>
                        
                        {% if profile.bio %}
                            <div class="mb-6">
                                <h3 class="font-semibold mb-2">Bio</h3>
                                <p class="text-base-content/80">{{ profile.bio }}</p>
                            </div>
                        {% endif %}
                        
                        <div class="space-y-4">
                            {% if profile_user.email %}
                                <div>
                                    <label class="label">
                                        <span class="label-text font-semibold">Email</span>
                                    </label>
                                    <p class="text-base-content">{{ profile_user.email }}</p>
                                </div>
                            {% endif %}
                            
                            {% if profile.phone %}
                                <div>
                                    <label class="label">
                                        <span class="label-text font-semibold">Phone</span>
                                    </label>
                                    <p class="text-base-content">{{ profile.phone }}</p>
                                </div>
                            {% endif %}
                            
                            {% if profile.website %}
                                <div>
                                    <label class="label">
                                        <span class="label-text font-semibold">Website</span>
                                    </label>
                                    <a href="{{ profile.website }}" target="_blank" class="link link-primary">{{ profile.website }}</a>
                                </div>
                            {% endif %}
                            
                            {% if profile.date_of_birth %}
                                <div>
                                    <label class="label">
                                        <span class="label-text font-semibold">Date of Birth</span>
                                    </label>
                                    <p class="text-base-content">{{ profile.date_of_birth|date:"F d, Y" }}</p>
                                </div>
                            {% endif %}
                            
                            <div>
                                <label class="label">
                                    <span class="label-text font-semibold">Member Since</span>
                                </label>
                                <p class="text-base-content">{{ profile_user.date_joined|date:"F d, Y" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Recent Files -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-xl mb-4">
                                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                Recent Files
                            </h2>
                            
                            {% if recent_files %}
                                <div class="space-y-3">
                                    {% for file in recent_files %}
                                        <div class="flex items-center gap-3 p-3 bg-base-200 rounded-lg">
                                            <div class="avatar placeholder">
                                                <div class="bg-neutral text-neutral-content rounded-full w-8">
                                                    <span class="text-xs">
                                                        {% if file.is_image %}🖼️{% elif file.is_pdf %}📄{% elif file.is_document %}📝{% elif file.is_spreadsheet %}📊{% else %}📁{% endif %}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <p class="text-sm font-medium truncate">{{ file.title }}</p>
                                                <p class="text-xs text-base-content/60">{{ file.uploaded_at|date:"M d, Y" }}</p>
                                            </div>
                                            <a href="{% url 'files:file_detail' file.id %}" class="btn btn-ghost btn-xs">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                </svg>
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="mt-4">
                                    <a href="{% url 'files:file_list' %}" class="btn btn-outline btn-sm w-full">View All Files</a>
                                </div>
                            {% else %}
                                <div class="text-center py-8">
                                    <p class="text-base-content/60">No files uploaded yet.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Recent Images -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-xl mb-4">
                                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                Recent Images
                            </h2>
                            
                            {% if recent_images %}
                                <div class="space-y-3">
                                    {% for image in recent_images %}
                                        <div class="flex items-center gap-3 p-3 bg-base-200 rounded-lg">
                                            <div class="avatar">
                                                <div class="w-8 h-8 rounded">
                                                    {% if image.thumbnail %}
                                                        <img src="{{ image.thumbnail.url }}" alt="{{ image.title }}" class="w-full h-full object-cover">
                                                    {% else %}
                                                        <img src="{{ image.image.url }}" alt="{{ image.title }}" class="w-full h-full object-cover">
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <p class="text-sm font-medium truncate">{{ image.title }}</p>
                                                <p class="text-xs text-base-content/60">{{ image.uploaded_at|date:"M d, Y" }}</p>
                                            </div>
                                            <a href="{% url 'images:image_detail' image.id %}" class="btn btn-ghost btn-xs">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                </svg>
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="mt-4">
                                    <a href="{% url 'images:image_list' %}" class="btn btn-outline btn-sm w-full">View All Images</a>
                                </div>
                            {% else %}
                                <div class="text-center py-8">
                                    <p class="text-base-content/60">No images uploaded yet.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### userprofile/templates/userprofile/profile_list.html
```python
{% extends "base.html" %}

{% block title %}All Profiles - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'userprofile:profile_view' %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to Profile
                </a>
                <h1 class="text-3xl font-bold text-base-content">All User Profiles</h1>
            </div>
        </div>

        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="alert alert-{% if message.tags == 'error' %}error{% else %}success{% endif %} mb-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {% if message.tags == 'error' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            {% else %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            {% endif %}
                        </svg>
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Avatar</th>
                                <th>Full Name</th>
                                <th>Company</th>
                                <th>Position</th>
                                <th>Location</th>
                                <th>Member Since</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for profile in profiles %}
                                <tr>
                                    <td>
                                        <div class="flex items-center space-x-3">
                                            <div class="font-bold">@{{ profile.user.username }}</div>
                                            {% if profile.user.is_staff %}
                                                <div class="badge badge-primary">Staff</div>
                                            {% endif %}
                                            {% if profile.user.is_superuser %}
                                                <div class="badge badge-secondary">Admin</div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="avatar">
                                            <div class="w-12 h-12 rounded-full">
                                                {% if profile.has_avatar %}
                                                    <img src="{{ profile.avatar.url }}" alt="{{ profile.user.username }}'s avatar" class="w-full h-full object-cover">
                                                {% else %}
                                                    <div class="bg-primary text-primary-content flex items-center justify-center text-sm font-bold">
                                                        {{ profile.initials }}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ profile.full_name }}</td>
                                    <td>{{ profile.company|default:"-" }}</td>
                                    <td>{{ profile.position|default:"-" }}</td>
                                    <td>{{ profile.location|default:"-" }}</td>
                                    <td>{{ profile.user.date_joined|date:"M d, Y" }}</td>
                                    <td>
                                        <a href="{% url 'userprofile:profile_view' profile.user.username %}" class="btn btn-ghost btn-xs">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            </svg>
                                            View
                                        </a>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="8" class="text-center py-8">
                                        <p class="text-base-content/60">No profiles found.</p>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-8">
            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-primary">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                    </svg>
                </div>
                <div class="stat-title">Total Users</div>
                <div class="stat-value text-primary">{{ profiles.count }}</div>
            </div>

            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-secondary">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                </div>
                <div class="stat-title">Staff Members</div>
                <div class="stat-value text-secondary">{{ profiles|length|add:"0" }}</div>
            </div>

            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-accent">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div class="stat-title">With Avatars</div>
                <div class="stat-value text-accent">{{ profiles|length|add:"0" }}</div>
            </div>

            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-info">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                </div>
                <div class="stat-title">Active Profiles</div>
                <div class="stat-value text-info">{{ profiles|length|add:"0" }}</div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### userprofile/templates/userprofile/password_change.html
```python
{% extends "base.html" %}

{% block title %}Change Password - Kemco Engineering{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="mb-8">
            <div class="flex items-center mb-4">
                <a href="{% url 'userprofile:profile_view' %}" class="btn btn-ghost btn-sm mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Back to Profile
                </a>
                <h1 class="text-3xl font-bold text-base-content">Change Password</h1>
            </div>
        </div>

        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="alert alert-{% if message.tags == 'error' %}error{% else %}success{% endif %} mb-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {% if message.tags == 'error' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            {% else %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            {% endif %}
                        </svg>
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-xl mb-6">Update Your Password</h2>
                
                {% if form.errors %}
                    <div class="alert alert-error mb-6">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Please correct the errors below.</span>
                    </div>
                {% endif %}

                <form method="post">
                    {% csrf_token %}
                    
                    <div class="space-y-6">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">{{ form.current_password.label }} *</span>
                            </label>
                            {{ form.current_password }}
                            {% if form.current_password.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.current_password.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">{{ form.new_password1.label }} *</span>
                            </label>
                            {{ form.new_password1 }}
                            {% if form.new_password1.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.new_password1.errors.0 }}</span>
                                </label>
                            {% endif %}
                            <label class="label">
                                <span class="label-text-alt text-base-content/60">
                                    Password must be at least 8 characters long
                                </span>
                            </label>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">{{ form.new_password2.label }} *</span>
                            </label>
                            {{ form.new_password2 }}
                            {% if form.new_password2.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.new_password2.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>
                    </div>

                    <div class="card-actions justify-end mt-8">
                        <a href="{% url 'userprofile:profile_view' %}" class="btn btn-outline">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                            </svg>
                            Change Password
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Security Tips -->
        <div class="card bg-base-200 shadow-xl mt-6">
            <div class="card-body">
                <h3 class="card-title text-lg mb-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                    Password Security Tips
                </h3>
                <ul class="space-y-2 text-sm text-base-content/80">
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 mt-0.5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Use at least 8 characters
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 mt-0.5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Include uppercase and lowercase letters
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 mt-0.5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Add numbers and special characters
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 mt-0.5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Avoid common words or patterns
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 mt-0.5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Don't reuse passwords from other accounts
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
```

### App: main
### main/models.py
```python
from django.db import models

# Create your models here.

```

### main/views.py
```python
from django.shortcuts import render, redirect
from django.contrib.auth import login, authenticate
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from django.utils import timezone
from datetime import datetime, timedelta
from django.utils import timezone

# User registration view
def register(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)
            messages.success(request, 'Account created successfully!')
            return redirect('home')
    else:
        form = UserCreationForm()
    return render(request, 'registration/register.html', {'form': form})

@login_required
def home(request):
    # Get dashboard statistics
    stats = get_dashboard_stats(request.user)
    recent_activity = get_recent_activity(request.user)

    # Generate QR code for mobile testing
    import qrcode
    from io import BytesIO
    import base64
    import socket

    # Get the current server URL
    protocol = 'https' if request.is_secure() else 'http'

    # Get the actual IP address for mobile access
    try:
        # Get the local IP address
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        local_ip = s.getsockname()[0]
        s.close()
        server_url = f"{protocol}://{local_ip}:8000"
    except:
        # Fallback to request host
        host = request.get_host()
        server_url = f"{protocol}://{host}"

    # Generate QR code
    qr = qrcode.QRCode(
        version=1,
        error_correction=qrcode.constants.ERROR_CORRECT_L,
        box_size=10,
        border=4,
    )
    qr.add_data(server_url)
    qr.make(fit=True)

    # Create QR code image
    img = qr.make_image(fill_color="black", back_color="white")

    # Convert to base64 for embedding in HTML
    buffer = BytesIO()
    img.save(buffer, format='PNG')
    qr_image_base64 = base64.b64encode(buffer.getvalue()).decode()

    context = {
        'stats': stats,
        'recent_activity': recent_activity,
        'server_url': server_url,
        'qr_code_image': qr_image_base64,
        'year': datetime.now().year,
        'timestamp': timezone.now().timestamp(),  # For cache busting
    }
    return render(request, 'main/dashboard.html', context)

def home_public(request):
    """Public home page with QR code for mobile testing"""
    import qrcode
    from io import BytesIO
    import base64
    import socket

    # Get the current server URL
    protocol = 'https' if request.is_secure() else 'http'

    # Get the actual IP address for mobile access
    try:
        # Get the local IP address
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        local_ip = s.getsockname()[0]
        s.close()
        server_url = f"{protocol}://{local_ip}:8000"
    except:
        # Fallback to request host
        host = request.get_host()
        server_url = f"{protocol}://{host}"

    # Generate QR code
    qr = qrcode.QRCode(
        version=1,
        error_correction=qrcode.constants.ERROR_CORRECT_L,
        box_size=10,
        border=4,
    )
    qr.add_data(server_url)
    qr.make(fit=True)

    # Create QR code image
    img = qr.make_image(fill_color="black", back_color="white")

    # Convert to base64 for embedding in HTML
    buffer = BytesIO()
    img.save(buffer, format='PNG')
    qr_image_base64 = base64.b64encode(buffer.getvalue()).decode()

    context = {
        'server_url': server_url,
        'qr_code_image': qr_image_base64,
        'year': datetime.now().year,
    }
    return render(request, 'main/home.html', context)

def get_dashboard_stats(user):
    """Get statistics for all apps and models with user-specific data"""
    stats = []

    try:
        from django.apps import apps
        from django.db.models import Count, Sum
        from django.contrib.auth.models import User

        # Define stat configurations with icons and colors
        stat_configs = {
            'prompts': {
                'label': 'AI Prompts',
                'icon_bg': 'from-blue-500 to-indigo-600',
                'icon_path': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />',
                'model_name': 'prompt',
                'app_label': 'prompts',
                'user_field': 'author'
            },

            'subscriptions': {
                'label': 'Subscriptions',
                'icon_bg': 'from-purple-500 to-pink-600',
                'icon_path': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />',
                'model_name': 'subscription',
                'app_label': 'subscriptions',
                'user_field': 'user'
            },
            'files': {
                'label': 'Files',
                'icon_bg': 'from-orange-500 to-red-600',
                'icon_path': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />',
                'model_name': 'file',
                'app_label': 'files',
                'user_field': 'uploaded_by'
            },
            'images': {
                'label': 'Images',
                'icon_bg': 'from-green-500 to-emerald-600',
                'icon_path': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />',
                'model_name': 'image',
                'app_label': 'images',
                'user_field': 'uploaded_by'
            },
            'song_prompts': {
                'label': 'Song Prompts',
                'icon_bg': 'from-yellow-500 to-amber-600',
                'icon_path': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />',
                'model_name': 'songprompt',
                'app_label': 'suno_prompt_builder',
                'user_field': None
            }
        }

        # Get stats for each configured model
        for key, config in stat_configs.items():
            try:
                model = apps.get_model(config['app_label'], config['model_name'])

                # Get count (user-specific or global)
                if config['user_field']:
                    user_filter = {config['user_field']: user}
                    count = model.objects.filter(**user_filter).count()
                else:
                    # For models without user field, get global count
                    count = model.objects.count()

                # Get new this week count
                week_ago = timezone.now() - timedelta(days=7)
                if hasattr(model, 'created_at'):
                    if config['user_field']:
                        new_this_week = model.objects.filter(
                            **user_filter,
                            created_at__gte=week_ago
                        ).count()
                    else:
                        new_this_week = model.objects.filter(
                            created_at__gte=week_ago
                        ).count()
                elif hasattr(model, 'uploaded_at'):
                    if config['user_field']:
                        new_this_week = model.objects.filter(
                            **user_filter,
                            uploaded_at__gte=week_ago
                        ).count()
                    else:
                        new_this_week = model.objects.filter(
                            uploaded_at__gte=week_ago
                        ).count()
                else:
                    new_this_week = 0

                stats.append({
                    'label': config['label'],
                    'count': count,
                    'new_this_week': new_this_week if new_this_week > 0 else None,
                    'icon_bg': config['icon_bg'],
                    'icon_path': config['icon_path']
                })

            except Exception as e:
                print(f"Error getting stats for {key}: {e}")
                continue

    except Exception as e:
        print(f"Error in get_dashboard_stats: {e}")
        stats = []

    return stats

def get_recent_activity(user):
    """Get recent activity across all models for the specific user"""
    activities = []

    try:
        from django.apps import apps

        # Define models to track for activity
        activity_models = [
            {'app': 'prompts', 'model': 'prompt', 'user_field': 'author'},
            {'app': 'subscriptions', 'model': 'subscription', 'user_field': 'user'},
            {'app': 'files', 'model': 'file', 'user_field': 'uploaded_by'},
            {'app': 'images', 'model': 'image', 'user_field': 'uploaded_by'},
        ]

        for model_config in activity_models:
            try:
                model = apps.get_model(model_config['app'], model_config['model'])
                user_filter = {model_config['user_field']: user}

                # Get recent items for this user
                recent_items = None
                if hasattr(model, 'created_at'):
                    recent_items = model.objects.filter(**user_filter).order_by('-created_at')[:5]
                elif hasattr(model, 'uploaded_at'):
                    recent_items = model.objects.filter(**user_filter).order_by('-uploaded_at')[:5]
                elif hasattr(model, 'updated_at'):
                    recent_items = model.objects.filter(**user_filter).order_by('-updated_at')[:5]

                if recent_items:
                    for item in recent_items:
                        activity_time = None
                        if hasattr(item, 'created_at'):
                            activity_time = item.created_at
                        elif hasattr(item, 'uploaded_at'):
                            activity_time = item.uploaded_at
                        elif hasattr(item, 'updated_at'):
                            activity_time = item.updated_at

                        if activity_time:
                            activities.append({
                                'type': model_config['model'],
                                'app': model_config['app'],
                                'title': str(item),
                                'time': activity_time,
                                'id': item.pk,
                            })
            except Exception as e:
                print(f"Error getting activity for {model_config['app']}.{model_config['model']}: {e}")
                continue

    except Exception as e:
        print(f"Error in get_recent_activity: {e}")
        activities = []

    # Sort by time and return most recent 10
    activities.sort(key=lambda x: x['time'], reverse=True)
    return activities[:10]

```

### main/urls.py
```python
from django.urls import path, include
from main.views import home, home_public, search_api
from django.shortcuts import render

urlpatterns = [
    path('', home, name='home'),
    path('public/', home_public, name='home_public'),
    path('api/search/', search_api, name='search_api'),
    path('test-search/', lambda request: render(request, 'main/test_search.html'), name='test_search'),
]

```

### main/admin.py
```python
from django.contrib import admin

# Register your models here.

```

### main/apps.py
```python
from django.apps import AppConfig


class MainConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'main'

```

### main/tests.py
```python
from django.test import TestCase

# Create your tests here.

```

#### Templates in main
### main/templates/main/home.html
```python
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="hero min-h-screen bg-base-200">
    <div class="hero-content text-center max-w-4xl mx-auto">
        <div class="w-full">
            <!-- Header with icon -->
            <div class="flex items-center justify-center mb-6">
                <svg class="w-8 h-8 text-primary mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                <h1 class="text-5xl font-bold">Welcome!</h1>
            </div>
            
            <p class="py-6 text-lg">Beautiful auth with Tailwind &amp; DaisyUI + Heroicons!</p>
            
            <!-- QR Code Section for Mobile Testing -->
            {% if qr_code_image %}
            <div class="card bg-base-100 shadow-xl mb-8 max-w-md mx-auto">
                <div class="card-body items-center text-center">
                    <h2 class="card-title text-2xl mb-4">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                        Mobile Testing QR Code
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Scan this QR code with your iPhone to test the app on mobile</p>
                    <div class="bg-white p-4 rounded-lg shadow-inner">
                        <img src="data:image/png;base64,{{ qr_code_image }}" alt="QR Code for {{ server_url }}" class="w-48 h-48 mx-auto">
                    </div>
                    <p class="text-xs text-gray-500 mt-2 break-all">{{ server_url }}</p>
                    <div class="card-actions mt-4">
                        <button class="btn btn-primary btn-sm" onclick="copyToClipboard('{{ server_url }}')">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            Copy URL
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Icon examples section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 my-8">
                <!-- Card 1: User Profile -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body items-center text-center">
                        <svg class="w-8 h-8 text-primary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <h2 class="card-title">User Profile</h2>
                        <p>Manage your account settings and preferences</p>
                        <div class="card-actions">
                            <a href="{% url 'userprofile:profile_view' %}" class="btn btn-primary btn-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                View Profile
                            </a>
                        </div>
                    </div>
                </div>

                {% if SURVEYS_ENABLED and user.is_authenticated %}
                <!-- Card: Surveys -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body items-center text-center">
                        <svg class="w-8 h-8 text-secondary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6M7 7h10a2 2 0 012 2v8a2 2 0 01-2 2H7a2 2 0 01-2-2V9a2 2 0 012-2z"/>
                        </svg>
                        <h2 class="card-title">Surveys</h2>
                        <p class="text-sm opacity-70">
                            {% if survey_invites_count %}
                                You have {{ survey_invites_count }} pending survey{{ survey_invites_count|pluralize }}.
                            {% else %}
                                No pending invites.
                            {% endif %}
                        </p>
                        <div class="card-actions">
                            <a href="{% url 'surveys:my_invites' %}" class="btn btn-primary btn-sm">My Invites</a>
                            <a href="{% url 'surveys:list' %}" class="btn btn-outline btn-sm">Browse</a>
                            {% if perms.surveys.add_survey or user.is_superuser %}
                                <a href="{% url 'surveys:builder' %}" class="btn btn-secondary btn-sm">Create Survey</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Card 2: Settings -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body items-center text-center">
                        <svg class="w-8 h-8 text-secondary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <h2 class="card-title">Settings</h2>
                        <p>Configure your application preferences</p>
                        <div class="card-actions">
                            <button class="btn btn-secondary btn-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                </svg>
                                Configure
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Notifications -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body items-center text-center">
                        <svg class="w-8 h-8 text-accent mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4.19 4.19A2 2 0 004 6v10a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-1.81 1.19z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/>
                        </svg>
                        <h2 class="card-title">Notifications</h2>
                        <p>Stay updated with important alerts</p>
                        <div class="card-actions">
                            <button class="btn btn-accent btn-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4.19 4.19A2 2 0 004 6v10a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-1.81 1.19z"/>
                                </svg>
                                Check Alerts
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action buttons with icons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                {% if user.is_authenticated %}
                    <div class="flex flex-col sm:flex-row gap-4">
                        <a href="{% url 'files:file_list' %}" class="btn btn-secondary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Manage Files
                        </a>
                        <a href="{% url 'images:image_list' %}" class="btn btn-accent">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Image Gallery
                        </a>
                        <a href="{% url 'userprofile:profile_view' %}" class="btn btn-outline">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            My Profile
                        </a>
                        <a href="{% url 'prompts:prompt_list' %}" class="btn btn-secondary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                            AI Prompts
                        </a>
                        <a href="{% url 'logout' %}" class="btn btn-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                            Logout
                        </a>
                    </div>
                {% else %}
                    <a href="{% url 'login' %}" class="btn btn-primary">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                        </svg>
                        Get Started
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
        // Use the modern clipboard API
        navigator.clipboard.writeText(text).then(function() {
            showCopySuccess();
        }).catch(function(err) {
            console.error('Could not copy text: ', err);
            fallbackCopyTextToClipboard(text);
        });
    } else {
        // Fallback for older browsers
        fallbackCopyTextToClipboard(text);
    }
}

function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopySuccess();
        }
    } catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
    }
    
    document.body.removeChild(textArea);
}

function showCopySuccess() {
    // Create a temporary success message
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    
    button.innerHTML = `
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        Copied!
    `;
    button.classList.add('btn-success');
    button.classList.remove('btn-primary');
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.classList.remove('btn-success');
        button.classList.add('btn-primary');
    }, 2000);
}
</script>
{% endblock %}
```

### main/templates/main/dashboard.html
```python
{% extends "base.html" %}

{% block title %}Dashboard - Command Center{% endblock %}

{% block content %}

<!-- Hero Header Section -->
<div class="relative overflow-hidden bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white">
    <!-- Animated background elements -->
    <div class="absolute inset-0">
        <div class="absolute top-0 left-0 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
        <div class="absolute top-0 right-0 w-72 h-72 bg-yellow-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-8 left-20 w-72 h-72 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"></div>
    </div>

    <div class="relative z-10 px-6 py-12">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-white/10 backdrop-blur-lg rounded-2xl flex items-center justify-center border border-white/20">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-4xl font-bold bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">
                            Welcome back, {{ user.first_name|default:user.username }}! 👋
                        </h1>
                        <p class="text-purple-200 mt-2 text-sm md:text-base">Here's what's happening in your command center</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-3">
                    <div class="text-right">
                        <p class="text-sm text-purple-200">Last active</p>
                        <p class="font-semibold">{{ user.last_login|date:"M j, g:i A"|default:"Just now" }}</p>
                    </div>
                    <div class="w-12 h-12 bg-white/10 backdrop-blur-lg rounded-full flex items-center justify-center border border-white/20">
                        <span class="text-lg font-bold">{{ user.username|first|upper }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Dashboard Content -->
<div class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="max-w-7xl mx-auto px-6 py-8">

        <!-- Stats Overview Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            {% for stat in stats %}
            <a href="
                {% if stat.label == 'AI Prompts' %}{% url 'prompts:prompt_list' %}
                {% elif stat.label == 'Subscriptions' %}{% url 'subscriptions:subscription_list' %}
                {% elif stat.label == 'Files' %}{% url 'files:file_list' %}
                {% elif stat.label == 'Images' %}{% url 'images:image_list' %}
                {% elif stat.label == 'Song Prompts' %}{% url 'suno_prompt_builder:prompt_builder' %}
                {% else %}#{% endif %}
            " class="group bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-lg p-6 hover:scale-[1.02] hover:shadow-2xl transition-all duration-300 cursor-pointer block clickable-tile">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">{{ stat.label }}</p>
                        <p class="text-3xl font-bold text-gray-900" data-count="{{ stat.count }}">{{ stat.count }}</p>
                        {% if stat.new_this_week %}
                        <div class="flex items-center mt-2">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
                                </svg>
                                +{{ stat.new_this_week }} new
                            </span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-gradient-to-br {{ stat.icon_bg }} text-white shadow-lg group-hover:scale-110 transition-transform duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {% if stat.icon_path %}
                                {{ stat.icon_path|safe }}
                            {% else %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            {% endif %}
                        </svg>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>

        <!-- QR Code Section for Mobile Testing -->
        {% if qr_code_image %}
        <div class="bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-lg p-6 mb-8">
            <div class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 text-white shadow-lg">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Mobile Testing QR Code</h3>
                        <p class="text-sm text-gray-600">Scan with your iPhone to test the app on mobile</p>
                    </div>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-inner">
                    <img src="data:image/png;base64,{{ qr_code_image }}" alt="QR Code for {{ server_url }}" class="w-16 h-16">
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-2 break-all text-center sm:text-left">{{ server_url }}</p>
        </div>
        {% endif %}

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column: AI Tools & Creative Content -->
            <div class="lg:col-span-2 space-y-8">

                <!-- Your AI Tools Section -->
                <div class="bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <a href="{% url 'prompts:prompt_list' %}" class="flex items-center space-x-3 hover:opacity-80 transition-opacity cursor-pointer">
                            <div class="w-10 h-10 flex items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 text-white shadow-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900">Your AI Tools</h2>
                        </a>
                        <a href="{% url 'prompts:prompt_list' %}" class="text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center hover:scale-105 transition-transform">
                            View all
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </a>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <a href="{% url 'prompts:prompt_list' %}" class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100 hover:shadow-md transition-shadow cursor-pointer block clickable-tile">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">Prompts</h3>
                                    <p class="text-sm text-gray-600">
                                        {% for stat in stats %}
                                            {% if stat.label == 'AI Prompts' %}
                                                {{ stat.count }}
                                            {% endif %}
                                        {% endfor %} total
                                    </p>
                                </div>
                            </div>
                        </a>

                        <a href="{% url 'suno_prompt_builder:prompt_builder' %}" class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 border border-yellow-100 hover:shadow-md transition-shadow cursor-pointer block">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-yellow-500 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">Song Prompts</h3>
                                    <p class="text-sm text-gray-600">
                                        {% for stat in stats %}
                                            {% if stat.label == 'Song Prompts' %}
                                                {{ stat.count }}
                                            {% endif %}
                                        {% endfor %} created
                                    </p>
                                </div>
                            </div>
                        </a>

                        <a href="{% url 'subscriptions:subscription_list' %}" class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-100 hover:shadow-md transition-shadow cursor-pointer block">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">Subscriptions</h3>
                                    <p class="text-sm text-gray-600">
                                        {% for stat in stats %}
                                            {% if stat.label == 'Subscriptions' %}
                                                {{ stat.count }}
                                            {% endif %}
                                        {% endfor %} active
                                    </p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Creative Content Section -->
                <div class="bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <a href="{% url 'images:image_list' %}" class="flex items-center space-x-3 hover:opacity-80 transition-opacity cursor-pointer">
                            <div class="w-10 h-10 flex items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 text-white shadow-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-10 0a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900">Creative Content</h2>
                        </a>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <a href="{% url 'images:image_list' %}" class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100 hover:shadow-md transition-shadow cursor-pointer block">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">Images</h3>
                                    <p class="text-sm text-gray-600">
                                        {% for stat in stats %}
                                            {% if stat.label == 'Images' %}
                                                {{ stat.count }}
                                            {% endif %}
                                        {% endfor %} uploaded
                                    </p>
                                </div>
                            </div>
                        </a>

                        <a href="{% url 'files:file_list' %}" class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-4 border border-orange-100 hover:shadow-md transition-shadow cursor-pointer block">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">Files</h3>
                                    <p class="text-sm text-gray-600">
                                        {% for stat in stats %}
                                            {% if stat.label == 'Files' %}
                                                {{ stat.count }}
                                            {% endif %}
                                        {% endfor %} stored
                                    </p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Right Column: Recent Activity -->
            <div class="space-y-8">
                <div class="bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-xl bg-gradient-to-br from-yellow-500 to-orange-600 text-white shadow-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900">Recent Activity</h2>
                        </div>
                    </div>

                    <div class="space-y-4">
                        {% for activity in recent_activity|slice:":5" %}
                        <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                            <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate">{{ activity.title }}</p>
                                <p class="text-xs text-gray-500">{{ activity.time|timesince }} ago</p>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                </svg>
                            </div>
                            <p class="text-gray-500 text-sm">No recent activity</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="mt-12">
            <div class="bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-lg p-6">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-10 h-10 flex items-center justify-center rounded-xl bg-gradient-to-br from-pink-500 to-rose-600 text-white shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">⚡ Quick Actions</h2>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    <a href="{% url 'prompts:prompt_create' %}" class="group bg-gradient-to-br from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 border border-blue-200 rounded-xl p-4 text-center transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-1">Create Prompt</h3>
                        <p class="text-sm text-gray-600">Build a new AI prompt</p>
                    </a>

                    <a href="{% url 'suno_prompt_builder:prompt_builder' %}" class="group bg-gradient-to-br from-yellow-50 to-amber-50 hover:from-yellow-100 hover:to-amber-100 border border-yellow-200 rounded-xl p-4 text-center transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <div class="w-12 h-12 bg-yellow-500 rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-1">Suno Builder</h3>
                        <p class="text-sm text-gray-600">Create song prompts</p>
                    </a>

                    <a href="{% url 'subscriptions:subscription_create' %}" class="group bg-gradient-to-br from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 border border-purple-200 rounded-xl p-4 text-center transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-1">Add Subscription</h3>
                        <p class="text-sm text-gray-600">Track a new service</p>
                    </a>

                    <a href="{% url 'files:file_upload' %}" class="group bg-gradient-to-br from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 border border-green-200 rounded-xl p-4 text-center transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-1">Upload File</h3>
                        <p class="text-sm text-gray-600">Store a document</p>
                    </a>

                    <a href="{% url 'images:image_upload' %}" class="group bg-gradient-to-br from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 border border-orange-200 rounded-xl p-4 text-center transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-1">Upload Image</h3>
                        <p class="text-sm text-gray-600">Add a photo</p>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for animations -->
<style>
    @keyframes blob {
        0% {
            transform: translate(0px, 0px) scale(1);
        }
        33% {
            transform: translate(30px, -50px) scale(1.1);
        }
        66% {
            transform: translate(-20px, 20px) scale(0.9);
        }
        100% {
            transform: translate(0px, 0px) scale(1);
        }
    }

    .animate-blob {
        animation: blob 7s infinite;
    }

    .animation-delay-2000 {
        animation-delay: 2s;
    }

    .animation-delay-4000 {
        animation-delay: 4s;
    }
</style>

<!-- CountUp.js for animated counters -->
<script src="https://cdn.jsdelivr.net/npm/countup.js@2.6.0/dist/countUp.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animate counters
        const counters = document.querySelectorAll('[data-count]');
        counters.forEach(counter => {
            try {
                const count = parseInt(counter.getAttribute('data-count'));
                if (!isNaN(count) && count > 0) {
                    const countUp = new CountUp(counter, count, {
                        duration: 2.5,
                        useEasing: true,
                        useGrouping: true,
                        separator: ',',
                        decimal: '.'
                    });
                    countUp.start();
                }
            } catch (error) {
                console.log('CountUp error:', error);
                // Fallback: just show the number
                const count = counter.getAttribute('data-count');
                if (count) {
                    counter.textContent = count;
                }
            }
        });
    });
</script>

<!-- QR Code Copy Functionality -->
<script>
function copyToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
        // Use the modern clipboard API
        navigator.clipboard.writeText(text).then(function() {
            showCopySuccess();
        }).catch(function(err) {
            console.error('Could not copy text: ', err);
            fallbackCopyTextToClipboard(text);
        });
    } else {
        // Fallback for older browsers
        fallbackCopyTextToClipboard(text);
    }
}

function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopySuccess();
        }
    } catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
    }

    document.body.removeChild(textArea);
}

function showCopySuccess() {
    // Create a temporary success message
    const button = event.target.closest('button');
    const originalText = button.innerHTML;

    button.innerHTML = `
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        Copied!
    `;
    button.classList.add('btn-success');
    button.classList.remove('btn-primary');

    setTimeout(() => {
        button.innerHTML = originalText;
        button.classList.remove('btn-success');
        button.classList.add('btn-primary');
    }, 2000);
}
</script>
{% endblock %}
```

