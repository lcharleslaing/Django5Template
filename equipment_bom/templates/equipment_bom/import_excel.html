{% extends 'base.html' %}
{% load static %}

{% block title %}Import Excel - Equipment BOM{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Import Excel Data</h1>
            <p class="text-gray-600 text-lg">Upload your Excel file to import equipment BOM data</p>
        </div>

        <!-- Import Form Card -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" class="space-y-6">
                    {% csrf_token %}
                    
                    <!-- File Upload -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Excel File *</span>
                        </label>
                        <input type="file" name="excel_file" accept=".xlsx,.xls" 
                               class="file-input file-input-bordered w-full" required>
                        <div class="label">
                            <span class="label-text-alt text-gray-500">
                                Supported formats: .xlsx, .xls (Max size: 10MB)
                            </span>
                        </div>
                    </div>

                    <!-- Equipment Type Selection -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Equipment Type *</span>
                        </label>
                        <select name="equipment_type" class="select select-bordered w-full" required>
                            <option value="">Select Equipment Type</option>
                            {% for eq_type in equipment_types %}
                            <option value="{{ eq_type.name }}">{{ eq_type.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="label">
                            <span class="label-text-alt text-gray-500">
                                Choose the type of equipment data in your Excel file
                            </span>
                        </div>
                    </div>

                    <!-- Import Instructions -->
                    <div class="alert alert-info">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h3 class="font-bold">Import Instructions</h3>
                            <div class="text-sm">
                                <p class="mb-2">Your Excel file should contain the following sheets based on equipment type:</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li><strong>Import Heater:</strong> Sheet named "Import Heater"</li>
                                    <li><strong>Import Tank:</strong> Sheet named "Import Tank"</li>
                                    <li><strong>Pump:</strong> Sheet named "Pump"</li>
                                    <li><strong>Stack Economizer:</strong> Sheet named "Stack Economizer"</li>
                                </ul>
                                <p class="mt-2">The system will automatically detect and process the appropriate sheet.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Preview -->
                    <div class="collapse collapse-arrow bg-base-200">
                        <input type="checkbox" /> 
                        <div class="collapse-title text-xl font-medium">
                            Expected Data Structure
                        </div>
                        <div class="collapse-content"> 
                            <div class="overflow-x-auto">
                                <table class="table table-zebra w-full">
                                    <thead>
                                        <tr>
                                            <th>Column</th>
                                            <th>Description</th>
                                            <th>Example</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Item Number</td>
                                            <td>Unique identifier for the item</td>
                                            <td>35284-01</td>
                                        </tr>
                                        <tr>
                                            <td>Description</td>
                                            <td>Item description</td>
                                            <td>HEATER, FAB, 42X12, RM, 316</td>
                                        </tr>
                                        <tr>
                                            <td>BOM</td>
                                            <td>Bill of Materials reference</td>
                                            <td>35284-01-000</td>
                                        </tr>
                                        <tr>
                                            <td>Product Type</td>
                                            <td>Type of product</td>
                                            <td>FG FAB, Sub Assy</td>
                                        </tr>
                                        <tr>
                                            <td>Dimensions</td>
                                            <td>Various dimension columns</td>
                                            <td>304, 42, 12, 9.5, 7, 1</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6">
                        <button type="submit" class="btn btn-primary flex-1">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                            </svg>
                            Start Import
                        </button>
                        
                        <a href="{% url 'equipment_bom:dashboard' %}" class="btn btn-outline flex-1">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Recent Imports -->
        <div class="mt-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Recent Imports</h2>
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <div class="overflow-x-auto">
                        <table class="table table-zebra w-full">
                            <thead>
                                <tr>
                                    <th>File</th>
                                    <th>Equipment Type</th>
                                    <th>Status</th>
                                    <th>Records</th>
                                    <th>Imported By</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for import_log in recent_imports %}
                                <tr>
                                    <td>
                                        <div class="font-medium">{{ import_log.file_name|truncatechars:30 }}</div>
                                    </td>
                                    <td>
                                        <span class="badge badge-outline">{{ import_log.equipment_type.name }}</span>
                                    </td>
                                    <td>
                                        <span class="badge badge-{{ import_log.status|yesno:'success,warning,error' }}">
                                            {{ import_log.status|title }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="text-sm">
                                            <div>Processed: {{ import_log.records_processed }}</div>
                                            <div>Created: {{ import_log.records_created }}</div>
                                            <div>Updated: {{ import_log.records_updated }}</div>
                                        </div>
                                    </td>
                                    <td>{{ import_log.imported_by.username }}</td>
                                    <td>{{ import_log.import_date|date:"M d, H:i" }}</td>
                                    <td>
                                        <a href="{% url 'equipment_bom:import_log_detail' import_log.id %}" 
                                           class="btn btn-ghost btn-xs">View Details</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center py-4 text-gray-500">
                                        No imports yet. Upload your first Excel file to get started!
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% if recent_imports %}
                    <div class="card-actions justify-end mt-4">
                        <a href="{% url 'equipment_bom:import_logs' %}" class="btn btn-primary btn-sm">
                            View All Imports
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Help Section -->
        <div class="mt-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Need Help?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title">File Format Requirements</h3>
                        <ul class="list-disc list-inside space-y-2 text-sm">
                            <li>Excel files (.xlsx or .xls)</li>
                            <li>Maximum file size: 10MB</li>
                            <li>Sheet names must match equipment type</li>
                            <li>First row should contain column headers</li>
                            <li>Data should start from the second row</li>
                        </ul>
                    </div>
                </div>
                
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title">Supported Equipment Types</h3>
                        <ul class="list-disc list-inside space-y-2 text-sm">
                            <li><strong>Import Heater:</strong> Industrial heating equipment</li>
                            <li><strong>Import Tank:</strong> Storage and process tanks</li>
                            <li><strong>Pump:</strong> Various pump types and configurations</li>
                            <li><strong>Stack Economizer:</strong> Heat recovery equipment</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
